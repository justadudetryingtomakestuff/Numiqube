<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Numiqube üßä ‚Äî Math Study App</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Nunito:wght@400;600;700;900&display=swap" rel="stylesheet">
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
:root{
  --bg:#0f0e17;--bg2:#13121f;--card:#1a1830;--card2:#201e38;--card3:#252340;
  --accent:#ff6b35;--a2:#ffd166;--a3:#06d6a0;--a4:#118ab2;--a5:#c77dff;--a6:#f72585;
  --text:#fffffe;--muted:#a7a9be;--border:#ffffff0f;
  --correct:#06d6a0;--wrong:#ef476f;
  --shadow:0 8px 32px rgba(0,0,0,0.4);
}
.light-mode{
  --bg:#f7f3ee;--bg2:#efe9e0;--card:#ffffff;--card2:#f5efe8;--card3:#ece4d9;
  --text:#1a1830;--muted:#7a6e62;--border:#0000000f;
  --shadow:0 8px 32px rgba(0,0,0,0.08);
}
*{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{font-family:'Nunito',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;transition:background 0.3s,color 0.3s;}

/* ‚îÄ‚îÄ‚îÄ LOADING SCREEN ‚îÄ‚îÄ‚îÄ */
#loader{position:fixed;inset:0;background:var(--bg);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:28px;transition:opacity 0.6s ease,visibility 0.6s ease;}
#loader.hidden{opacity:0;visibility:hidden;pointer-events:none;}
.loader-title{font-family:'Space Mono',monospace;font-size:1.6rem;font-weight:700;background:linear-gradient(135deg,#4cc9f0,#c77dff,#f72585);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:2px;}
.loader-sub{color:var(--muted);font-size:0.8rem;letter-spacing:1px;}

/* 3D Cube */
.cube-scene{width:100px;height:100px;perspective:350px;}
.cube{width:100%;height:100%;position:relative;transform-style:preserve-3d;animation:spinCube 3s linear infinite;}
@keyframes spinCube{
  0%  {transform:rotateX(-20deg) rotateY(0deg);}
  100%{transform:rotateX(-20deg) rotateY(360deg);}
}
.cube-face{position:absolute;width:100px;height:100px;display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);gap:3px;padding:3px;border-radius:4px;}
.cube-face .cell{border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:0;font-weight:900;}
/* Face positions */
.face-front {transform:translateZ(50px);}
.face-back  {transform:rotateY(180deg) translateZ(50px);}
.face-right {transform:rotateY(90deg)  translateZ(50px);}
.face-left  {transform:rotateY(-90deg) translateZ(50px);}
.face-top   {transform:rotateX(90deg)  translateZ(50px);}
.face-bottom{transform:rotateX(-90deg) translateZ(50px);}
/* Rubik colors per face */
.face-front  .cell{background:#ff6b35;}
.face-back   .cell{background:#ffd166;}
.face-right  .cell{background:#06d6a0;}
.face-left   .cell{background:#118ab2;}
.face-top    .cell{background:#c77dff;}
.face-bottom .cell{background:#f72585;}
/* Center cell of front face gets the x¬≥ label */
.face-front .cell.center{background:#fff;color:#ff6b35;font-size:1rem;font-weight:900;font-family:'Space Mono',monospace;}
.face-front .cell.center sup{font-size:0.6rem;vertical-align:super;}

/* Subtle rotating color effect on each cell with staggered delay */
.cube-face .cell{animation:cellPulse 3s ease-in-out infinite;}
.cube-face .cell:nth-child(1){animation-delay:0s}
.cube-face .cell:nth-child(2){animation-delay:.1s}
.cube-face .cell:nth-child(3){animation-delay:.2s}
.cube-face .cell:nth-child(4){animation-delay:.3s}
.cube-face .cell:nth-child(5){animation-delay:.4s}
.cube-face .cell:nth-child(6){animation-delay:.5s}
.cube-face .cell:nth-child(7){animation-delay:.6s}
.cube-face .cell:nth-child(8){animation-delay:.7s}
.cube-face .cell:nth-child(9){animation-delay:.8s}
@keyframes cellPulse{0%,100%{filter:brightness(1)}50%{filter:brightness(1.25)}}

.loader-bar-wrap{width:160px;height:4px;background:var(--card3);border-radius:99px;overflow:hidden;}
.loader-bar{height:100%;width:0%;background:linear-gradient(90deg,#4cc9f0,#c77dff);border-radius:99px;animation:loaderFill 1.8s ease forwards;}
@keyframes loaderFill{0%{width:0%}60%{width:85%}100%{width:100%}}


#stars-bg{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:0;overflow:hidden;}
.star{position:absolute;border-radius:50%;background:white;animation:twinkle var(--d,3s) infinite var(--delay,0s);}
@keyframes twinkle{0%,100%{opacity:var(--lo,.1)}50%{opacity:var(--hi,.8)}}
.light-mode #stars-bg{display:none;}

/* ‚îÄ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ */
#nav{position:fixed;top:0;left:0;right:0;z-index:200;
  background:rgba(15,14,23,0.95);backdrop-filter:blur(16px);
  border-bottom:1px solid var(--border);
  display:none;align-items:center;justify-content:space-between;
  padding:0 16px;height:52px;gap:8px;}
.light-mode #nav{background:rgba(240,242,248,0.97);}
.nav-logo{font-family:'Space Mono',monospace;font-size:1rem;font-weight:700;
  background:linear-gradient(135deg,#4cc9f0,#c77dff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.nav-tabs{display:flex;gap:2px;}
.nav-tab{padding:5px 12px;border-radius:8px;font-size:0.75rem;font-weight:700;cursor:pointer;border:none;
  background:none;color:var(--muted);font-family:'Nunito',sans-serif;transition:all 0.2s;}
.nav-tab:hover,.nav-tab.active{background:rgba(255,107,53,0.15);color:var(--accent);}
.nav-right{display:flex;align-items:center;gap:8px;}
#nav-timer{font-family:'Space Mono',monospace;font-size:0.85rem;color:var(--a2);font-weight:700;}
#nav-xp{font-size:0.75rem;color:var(--a3);font-weight:700;}
#nav-streak{font-size:0.8rem;color:var(--accent);font-weight:700;}
#nav-lvl{background:linear-gradient(135deg,#7b2ff7,#f107a3);padding:2px 8px;border-radius:99px;font-size:0.68rem;font-weight:700;color:white;}
.nav-icon-btn{background:none;border:1px solid var(--border);color:var(--muted);width:30px;height:30px;border-radius:8px;cursor:pointer;font-size:0.9rem;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
.nav-icon-btn:hover{background:var(--card2);color:var(--text);}

/* ‚îÄ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ‚îÄ */
.page{display:none;position:relative;z-index:1;padding-top:56px;min-height:100vh;}
.page.active{display:block;}
.container{max-width:820px;margin:0 auto;padding:20px 16px;}

/* ‚îÄ‚îÄ‚îÄ START SCREEN ‚îÄ‚îÄ‚îÄ */
#page-home{display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:100vh;text-align:center;gap:22px;padding:20px;}
.rocket-anim{font-size:5rem;animation:float 3s ease-in-out infinite;display:block;}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-16px)}}
.home-title{font-size:clamp(2.2rem,6vw,3.5rem);font-weight:900;letter-spacing:-1.5px;
  background:linear-gradient(135deg,#4cc9f0,#c77dff,#f72585);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.home-motto{font-size:1rem;font-style:italic;color:var(--a2);font-weight:700;margin-bottom:4px;letter-spacing:0.2px;}
.home-sub{color:var(--muted);font-size:1rem;max-width:440px;line-height:1.6;}
.onboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;width:100%;max-width:600px;}
.onboard-card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 12px;text-align:center;}
.onboard-card .oc-icon{font-size:1.8rem;display:block;margin-bottom:6px;}
.onboard-card strong{display:block;font-size:0.88rem;color:var(--text);}
.onboard-card span{font-size:0.75rem;color:var(--muted);}
.name-input-wrap{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;}
#username-input{background:var(--card);border:1.5px solid var(--border);color:var(--text);
  font-family:'Nunito',sans-serif;font-size:1rem;padding:11px 16px;border-radius:12px;outline:none;
  transition:border-color 0.2s;width:220px;}
#username-input:focus{border-color:var(--accent);}
.btn-primary{background:linear-gradient(135deg,var(--accent),#ff9a3c);border:none;color:white;
  font-family:'Nunito',sans-serif;font-size:1.05rem;font-weight:900;padding:12px 36px;
  border-radius:99px;cursor:pointer;box-shadow:0 0 24px rgba(255,107,53,0.35);transition:transform 0.2s,box-shadow 0.2s;}
.btn-primary:hover{transform:scale(1.04);box-shadow:0 0 36px rgba(255,107,53,0.55);}
.btn-secondary{background:var(--card2);border:1px solid var(--border);color:var(--text);
  font-family:'Nunito',sans-serif;font-size:0.9rem;font-weight:700;padding:10px 24px;
  border-radius:99px;cursor:pointer;transition:all 0.2s;}
.btn-secondary:hover{background:var(--card3);}

/* ‚îÄ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ‚îÄ */
.section-title{font-size:0.75rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);margin-bottom:12px;font-weight:700;}
.dash-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-bottom:20px;}
.dash-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;text-align:center;transition:transform 0.2s;}
.dash-card:hover{transform:translateY(-2px);}
.dc-icon{font-size:1.6rem;display:block;margin-bottom:6px;}
.dc-num{font-family:'Space Mono',monospace;font-size:1.5rem;font-weight:700;}
.dc-label{font-size:0.75rem;color:var(--muted);margin-top:2px;text-transform:uppercase;letter-spacing:0.5px;}
.goal-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:12px;}
.goal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.goal-title{font-size:0.85rem;font-weight:700;}
.goal-pct{font-family:'Space Mono',monospace;font-size:0.8rem;color:var(--a3);}
.goal-bar-wrap{height:8px;background:var(--card3);border-radius:99px;overflow:hidden;}
.goal-bar-fill{height:100%;border-radius:99px;transition:width 0.6s;}
.goal-sub{font-size:0.72rem;color:var(--muted);margin-top:6px;}
.activity-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;margin-top:8px;}
.act-cell{aspect-ratio:1;border-radius:3px;background:var(--card3);cursor:default;transition:box-shadow 0.2s,filter 0.2s;display:flex;align-items:center;justify-content:center;font-size:0.5rem;font-weight:700;color:rgba(255,255,255,0.5);}
.act-cell:hover{filter:brightness(1.5);box-shadow:0 0 6px rgba(6,214,160,0.4);}
.act-0{background:var(--card3);}
.act-1{background:rgba(6,214,160,0.3);}
.act-2{background:rgba(6,214,160,0.55);}
.act-3{background:rgba(6,214,160,0.8);}
.act-4{background:var(--a3);}
.streak-calendar{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:12px;}
.week-row{display:flex;gap:4px;flex-wrap:wrap;}
.day-dot{width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:0.65rem;font-weight:700;color:var(--muted);}
.day-done{background:var(--a3);color:#000;}
.day-today{background:var(--accent);color:white;}
.day-missed{background:var(--card3);color:var(--muted);}

/* ‚îÄ‚îÄ‚îÄ STUDY PAGE ‚îÄ‚îÄ‚îÄ */
#topic-selector-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;}
.topic-tab{padding:5px 12px;border-radius:99px;font-size:0.74rem;font-weight:700;cursor:pointer;
  border:1.5px solid var(--border);background:none;color:var(--muted);font-family:'Nunito',sans-serif;transition:all 0.15s;}
.topic-tab:hover{border-color:var(--accent);color:var(--text);}
.topic-tab.active{background:var(--accent);border-color:var(--accent);color:white;}
.study-toolbar{display:flex;gap:6px;align-items:center;margin-bottom:12px;}
.tool-btn{background:var(--card2);border:1px solid var(--border);color:var(--muted);font-family:'Nunito',sans-serif;
  font-size:0.74rem;padding:5px 11px;border-radius:99px;cursor:pointer;transition:all 0.2s;}
.tool-btn:hover{background:var(--card3);color:var(--text);}
.tool-btn.active-tool{background:rgba(255,107,53,0.2);border-color:var(--accent);color:var(--accent);}

/* More button */
.more-btn{background:var(--card2);border:1px solid var(--border);color:var(--text);font-family:'Nunito',sans-serif;
  font-size:0.82rem;font-weight:700;padding:6px 14px;border-radius:99px;cursor:pointer;
  display:flex;align-items:center;gap:6px;transition:all 0.2s;}
.more-btn:hover{background:var(--card3);border-color:var(--accent);color:var(--accent);}

/* Side panel */
#more-panel-overlay{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,0);pointer-events:none;transition:background 0.3s;}
#more-panel-overlay.open{background:rgba(0,0,0,0.5);pointer-events:all;}
#more-panel{position:fixed;top:0;right:0;bottom:0;width:260px;background:var(--card);
  border-left:1px solid var(--border);z-index:301;padding:20px 16px;
  transform:translateX(100%);transition:transform 0.32s cubic-bezier(0.4,0,0.2,1);
  display:flex;flex-direction:column;gap:6px;overflow-y:auto;}
#more-panel.open{transform:translateX(0);}
.panel-title{font-size:0.7rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);
  font-weight:700;margin:10px 0 4px;padding-top:10px;border-top:1px solid var(--border);}
.panel-title:first-child{margin-top:0;padding-top:0;border-top:none;}
.panel-btn{background:var(--card2);border:1px solid var(--border);color:var(--text);font-family:'Nunito',sans-serif;
  font-size:0.88rem;font-weight:700;padding:10px 14px;border-radius:12px;cursor:pointer;
  text-align:left;transition:all 0.18s;display:flex;align-items:center;gap:10px;}
.panel-btn:hover{background:var(--card3);border-color:var(--accent);color:var(--accent);}
.panel-btn.active-tool{background:rgba(255,107,53,0.12);border-color:var(--accent);color:var(--accent);}
.panel-close{background:none;border:1px solid var(--border);color:var(--muted);width:30px;height:30px;
  border-radius:8px;cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;align-self:flex-end;margin-bottom:6px;}
.panel-close:hover{background:var(--card2);color:var(--text);}

/* Compact daily challenge */
#daily-compact{display:flex;align-items:center;gap:10px;padding:7px 12px;
  background:rgba(199,125,255,0.08);border:1px solid rgba(199,125,255,0.2);
  border-radius:10px;margin-bottom:10px;}
#daily-compact-label{font-size:0.76rem;font-weight:700;color:var(--a5);white-space:nowrap;}
#daily-compact-bar-wrap{flex:1;height:4px;background:var(--card3);border-radius:99px;overflow:hidden;}
#daily-compact-bar{height:100%;background:var(--a5);border-radius:99px;width:0%;transition:width 0.4s;}
#daily-compact-count{font-family:'Space Mono',monospace;font-size:0.72rem;color:var(--muted);white-space:nowrap;}
#session-prog-wrap{margin-bottom:12px;}
#session-prog-label{display:flex;justify-content:space-between;font-size:0.7rem;color:var(--muted);margin-bottom:4px;}
.thin-bar{height:5px;background:var(--card3);border-radius:99px;overflow:hidden;}
.thin-bar-fill{height:100%;background:linear-gradient(90deg,var(--a4),var(--a5));border-radius:99px;transition:width 0.5s;}
.question-meta{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:6px;}
#topic-badge{background:linear-gradient(135deg,var(--a4),var(--a3));padding:4px 12px;border-radius:99px;font-size:0.74rem;font-weight:700;letter-spacing:0.5px;text-transform:uppercase;}
#q-counter{color:var(--muted);font-size:0.78rem;font-family:'Space Mono',monospace;}
#score-display{color:var(--a2);font-size:0.84rem;font-weight:700;}

/* ‚îÄ‚îÄ‚îÄ QUESTION CARD ‚îÄ‚îÄ‚îÄ */
#question-card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:24px;margin-bottom:14px;
  position:relative;animation:slideIn 0.3s ease;box-shadow:var(--shadow);}
@keyframes slideIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
#question-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;
  background:linear-gradient(90deg,var(--accent),var(--a2),var(--a3),var(--a5));}
#diff-tag{font-size:0.72rem;font-weight:700;padding:3px 9px;border-radius:99px;display:inline-block;margin-bottom:10px;text-transform:uppercase;letter-spacing:0.5px;}
.d-easy{background:rgba(6,214,160,0.18);color:var(--a3);}
.d-medium{background:rgba(255,209,102,0.18);color:var(--a2);}
.d-hard{background:rgba(239,71,111,0.18);color:var(--wrong);}
.d-competition{background:rgba(17,138,178,0.18);color:var(--a4);}
#question-text{font-size:1.05rem;line-height:1.78;margin-bottom:18px;color:var(--text);min-height:3em;word-wrap:break-word;overflow-wrap:break-word;}

/* Speed timer ring */
#speed-ring-wrap{display:none;float:right;margin:-4px 0 8px 12px;}
#speed-ring{width:48px;height:48px;}
#speed-num{font-family:'Space Mono',monospace;font-size:0.75rem;color:var(--a2);text-anchor:middle;dominant-baseline:middle;}

#options-grid{display:grid;grid-template-columns:1fr 1fr;gap:9px;margin-bottom:14px;}
.opt-btn{background:rgba(255,255,255,0.035);border:1.5px solid var(--border);border-radius:11px;
  color:var(--text);font-family:'Nunito',sans-serif;font-size:0.88rem;font-weight:600;
  padding:11px 12px;text-align:left;cursor:pointer;transition:all 0.15s;display:flex;align-items:center;gap:8px;}
.opt-btn:hover:not(:disabled){background:rgba(255,107,53,0.1);border-color:var(--accent);transform:translateX(2px);}
.opt-lbl{background:rgba(255,255,255,0.08);width:24px;height:24px;border-radius:5px;display:flex;align-items:center;justify-content:center;font-family:'Space Mono',monospace;font-size:0.68rem;flex-shrink:0;}
.opt-btn.correct{background:rgba(6,214,160,0.13);border-color:var(--correct);}
.opt-btn.correct .opt-lbl{background:var(--correct);color:#000;}
.opt-btn.wrong{background:rgba(239,71,111,0.13);border-color:var(--wrong);}
.opt-btn.wrong .opt-lbl{background:var(--wrong);color:#fff;}
.opt-btn:disabled{cursor:default;}
#free-wrap{display:none;margin-bottom:12px;}
#free-input{width:100%;background:var(--card2);border:1.5px solid var(--border);border-radius:11px;color:var(--text);
  font-family:'Nunito',sans-serif;font-size:0.98rem;padding:11px 14px;outline:none;transition:border-color 0.2s;}
#free-input:focus{border-color:var(--accent);}
#submit-free{margin-top:8px;background:var(--accent);border:none;color:white;font-family:'Nunito',sans-serif;font-size:0.88rem;font-weight:700;padding:9px 22px;border-radius:99px;cursor:pointer;}

/* hint */
#hint-section{margin-bottom:10px;display:flex;align-items:flex-start;gap:8px;flex-wrap:wrap;}
#hint-btn{background:none;border:1px solid var(--border);color:var(--muted);font-family:'Nunito',sans-serif;font-size:0.76rem;padding:4px 12px;border-radius:99px;cursor:pointer;transition:all 0.2s;flex-shrink:0;}
#hint-btn:hover{border-color:var(--a2);color:var(--a2);}
#hint-text{display:none;flex:1;padding:9px 12px;background:rgba(255,209,102,0.07);border-left:3px solid var(--a2);
  border-radius:0 8px 8px 0;font-size:0.83rem;color:var(--a2);line-height:1.55;}

/* feedback */
#feedback-box{display:none;border-radius:12px;padding:12px 15px;margin-bottom:12px;font-size:0.87rem;line-height:1.65;animation:fadeIn 0.25s;}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
#feedback-box.fb-correct{background:rgba(6,214,160,0.09);border:1px solid var(--correct);}
#feedback-box.fb-wrong{background:rgba(239,71,111,0.09);border:1px solid var(--wrong);}
.fb-step{margin-top:8px;padding:8px 10px;background:rgba(255,255,255,0.04);border-radius:8px;font-size:0.82rem;color:var(--muted);}
.fb-step strong{color:var(--a2);display:block;font-size:0.72rem;text-transform:uppercase;margin-bottom:2px;}

#next-btn{display:none;width:100%;background:linear-gradient(135deg,var(--accent),#ff9a3c);border:none;color:white;
  font-family:'Nunito',sans-serif;font-size:0.92rem;font-weight:800;padding:12px;border-radius:11px;cursor:pointer;transition:opacity 0.2s,transform 0.1s;}
#next-btn:hover{opacity:0.9;transform:translateY(-1px);}

/* stats mini row */
#stats-row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px;}
.stat-mini{flex:1;min-width:72px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px 10px;text-align:center;}
.snum{font-family:'Space Mono',monospace;font-size:1.2rem;font-weight:700;}
.slabel{color:var(--muted);font-size:0.72rem;margin-top:2px;text-transform:uppercase;letter-spacing:0.4px;}

/* ‚îÄ‚îÄ‚îÄ PROGRESS PAGE ‚îÄ‚îÄ‚îÄ */
.topic-bar-row{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.tb-label{width:110px;font-size:0.78rem;color:var(--muted);flex-shrink:0;}
.tb-bar-wrap{flex:1;height:9px;background:var(--card3);border-radius:99px;overflow:hidden;}
.tb-bar-fill{height:100%;border-radius:99px;transition:width 0.7s;}
.tb-pct{width:30px;text-align:right;font-size:0.72rem;font-family:'Space Mono',monospace;}
.ach-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(115px,1fr));gap:8px;margin-top:8px;}
.ach-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center;transition:transform 0.2s;}
.ach-card.earned{border-color:var(--a5);background:rgba(199,125,255,0.07);}
.ach-card:hover{transform:translateY(-2px);}
.ach-icon{font-size:1.65rem;}
.ach-name{font-size:0.78rem;font-weight:700;margin-top:4px;}
.ach-desc{font-size:0.68rem;color:var(--muted);margin-top:2px;}
.history-list{display:flex;flex-direction:column;gap:8px;margin-top:8px;max-height:300px;overflow-y:auto;}
.hist-item{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:10px 14px;display:flex;align-items:center;justify-content:space-between;gap:8px;font-size:0.8rem;}
.hist-correct{color:var(--correct);font-family:'Space Mono',monospace;font-size:0.75rem;}
.hist-wrong{color:var(--wrong);font-family:'Space Mono',monospace;font-size:0.75rem;}
.wrong-list{display:flex;flex-direction:column;gap:8px;margin-top:8px;}
.wrong-item{background:rgba(239,71,111,0.07);border:1px solid rgba(239,71,111,0.25);border-radius:11px;padding:12px 14px;font-size:0.82rem;cursor:pointer;transition:background 0.2s;}
.wrong-item:hover{background:rgba(239,71,111,0.12);}
.wrong-q{font-weight:600;margin-bottom:4px;}
.wrong-a{color:var(--muted);font-size:0.75rem;}
.wrong-correct{color:var(--correct);}

/* ‚îÄ‚îÄ‚îÄ GOALS PAGE ‚îÄ‚îÄ‚îÄ */
.goal-form{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:16px;}
.goal-form label{font-size:0.78rem;color:var(--muted);display:block;margin-bottom:4px;}
.goal-input{background:var(--card2);border:1.5px solid var(--border);color:var(--text);font-family:'Nunito',sans-serif;
  font-size:0.92rem;padding:9px 13px;border-radius:10px;outline:none;width:100%;transition:border-color 0.2s;margin-bottom:10px;}
.goal-input:focus{border-color:var(--accent);}
.goal-item{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 16px;margin-bottom:10px;position:relative;}
.goal-item-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.goal-item-title{font-size:0.9rem;font-weight:700;}
.goal-badge{font-size:0.7rem;padding:2px 8px;border-radius:99px;font-weight:700;}
.gb-active{background:rgba(6,214,160,0.2);color:var(--a3);}
.gb-done{background:rgba(255,209,102,0.2);color:var(--a2);}
.goal-del{position:absolute;top:10px;right:10px;background:none;border:none;color:var(--muted);cursor:pointer;font-size:1.1rem;}
.goal-del:hover{color:var(--wrong);}
.tab-row{display:flex;gap:6px;margin-bottom:16px;border-bottom:1px solid var(--border);padding-bottom:10px;}
.tab-pill{padding:6px 14px;border-radius:8px;font-size:0.78rem;font-weight:700;cursor:pointer;border:none;background:none;color:var(--muted);font-family:'Nunito',sans-serif;transition:all 0.2s;}
.tab-pill.active{background:rgba(255,107,53,0.15);color:var(--accent);}

/* ‚îÄ‚îÄ‚îÄ LEADERBOARD ‚îÄ‚îÄ‚îÄ */
.lb-row{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px 16px;
  display:flex;align-items:center;gap:12px;margin-bottom:8px;transition:background 0.2s,border-color 0.2s;}
.lb-row:hover{background:var(--card2);}
.lb-rank{font-family:'Space Mono',monospace;font-size:0.9rem;width:24px;text-align:center;color:var(--muted);}
.lb-rank.gold{color:#ffd700;font-weight:700;}
.lb-rank.silver{color:#c0c0c0;font-weight:700;}
.lb-rank.bronze{color:#cd7f32;font-weight:700;}
.lb-avatar{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0;}
.lb-name{font-weight:700;font-size:0.88rem;flex:1;}
.lb-xp{font-family:'Space Mono',monospace;font-size:0.8rem;color:var(--a3);}
.lb-me{border-color:var(--accent)!important;background:rgba(255,107,53,0.07)!important;}

/* ‚îÄ‚îÄ‚îÄ FORMULA MODAL ‚îÄ‚îÄ‚îÄ */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:400;overflow-y:auto;padding:16px;}
.modal-box{background:var(--card);border-radius:20px;max-width:700px;margin:auto;padding:24px;border:1px solid var(--a5);position:relative;box-shadow:var(--shadow);}
.modal-close{position:absolute;top:12px;right:12px;background:none;border:1px solid var(--border);color:var(--muted);font-size:1rem;width:30px;height:30px;border-radius:8px;cursor:pointer;transition:all 0.2s;}
.modal-close:hover{color:var(--text);background:var(--card2);}
.formula-section h3{font-size:0.68rem;text-transform:uppercase;letter-spacing:1px;color:var(--a5);margin:14px 0 7px;}
.formula-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;}
.formula-card{background:var(--card2);border-radius:9px;padding:9px 11px;font-size:0.78rem;}
.formula-card strong{display:block;color:var(--a2);font-size:0.68rem;margin-bottom:2px;}
.fn{font-family:'Space Mono',monospace;font-size:0.75rem;color:var(--a3);}

/* ‚îÄ‚îÄ‚îÄ ONBOARDING PAGE ‚îÄ‚îÄ‚îÄ */
#page-onboarding{display:none;position:relative;z-index:1;min-height:100vh;
  display:none;flex-direction:column;align-items:center;justify-content:center;
  padding:24px 16px;gap:0;}
#page-onboarding.active{display:flex;}
.onb-card{background:var(--card);border:1px solid var(--border);border-radius:24px;
  padding:28px 24px;width:100%;max-width:500px;box-shadow:var(--shadow);}
.onb-steps{display:flex;gap:6px;justify-content:center;margin-bottom:24px;}
.onb-step-dot{width:8px;height:8px;border-radius:50%;background:var(--card3);transition:all 0.3s;}
.onb-step-dot.active{background:var(--accent);width:24px;border-radius:99px;}
.onb-step-dot.done{background:var(--a3);}
.onb-step{display:none;}
.onb-step.active{display:block;animation:pageFadeIn 0.3s ease both;}
.onb-google-avatar{width:72px;height:72px;border-radius:50%;border:3px solid var(--accent);
  display:block;margin:0 auto 12px;}
.onb-google-avatar-placeholder{width:72px;height:72px;border-radius:50%;border:3px solid var(--accent);
  background:linear-gradient(135deg,var(--accent),var(--a5));display:flex;align-items:center;
  justify-content:center;font-size:2rem;margin:0 auto 12px;}
.onb-title{font-size:1.4rem;font-weight:900;text-align:center;margin-bottom:6px;}
.onb-sub{font-size:0.85rem;color:var(--muted);text-align:center;margin-bottom:20px;line-height:1.6;}
.onb-label{font-size:0.78rem;color:var(--muted);display:block;margin-bottom:5px;font-weight:700;}
.onb-input{width:100%;background:var(--card2);border:1.5px solid var(--border);color:var(--text);
  font-family:'Nunito',sans-serif;font-size:1rem;padding:10px 14px;border-radius:11px;
  outline:none;transition:border-color 0.2s;margin-bottom:14px;}
.onb-input:focus{border-color:var(--accent);}
.onb-next-btn{width:100%;background:linear-gradient(135deg,var(--accent),#ff9a3c);border:none;
  color:white;font-family:'Nunito',sans-serif;font-size:1rem;font-weight:900;padding:13px;
  border-radius:12px;cursor:pointer;transition:opacity 0.2s,transform 0.1s;margin-top:4px;}
.onb-next-btn:hover{opacity:0.9;transform:translateY(-1px);}
.onb-skip{background:none;border:none;color:var(--muted);font-family:'Nunito',sans-serif;
  font-size:0.78rem;cursor:pointer;margin-top:10px;display:block;width:100%;text-align:center;
  text-decoration:underline;transition:color 0.2s;}
.onb-skip:hover{color:var(--text);}
.avatar-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin-bottom:16px;}
.avatar-opt{font-size:1.6rem;width:100%;aspect-ratio:1;border-radius:10px;border:2px solid var(--border);
  background:var(--card2);cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all 0.15s;}
.avatar-opt:hover{border-color:var(--accent);transform:scale(1.08);}
.avatar-opt.selected{border-color:var(--accent);background:rgba(255,107,53,0.12);}
.topic-onb-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px;}
.topic-onb-btn{background:var(--card2);border:2px solid var(--border);border-radius:12px;
  padding:10px 12px;cursor:pointer;text-align:left;transition:all 0.15s;display:flex;align-items:center;gap:8px;}
.topic-onb-btn:hover{border-color:var(--accent);}
.topic-onb-btn.selected{border-color:var(--accent);background:rgba(255,107,53,0.1);}
.topic-onb-btn .t-icon{font-size:1.2rem;}
.topic-onb-btn .t-name{font-size:0.8rem;font-weight:700;}
.onb-feature-list{display:flex;flex-direction:column;gap:10px;margin-bottom:20px;}
.onb-feature{display:flex;align-items:flex-start;gap:12px;padding:10px 12px;
  background:var(--card2);border-radius:10px;}
.onb-feature-icon{font-size:1.4rem;flex-shrink:0;}
.onb-feature-text strong{display:block;font-size:0.88rem;margin-bottom:2px;}
.onb-feature-text span{font-size:0.76rem;color:var(--muted);}


.google-btn{display:flex;align-items:center;justify-content:center;gap:10px;
  background:white;border:1.5px solid #ddd;border-radius:99px;color:#333;
  font-family:'Nunito',sans-serif;font-size:0.95rem;font-weight:700;
  padding:11px 28px;cursor:pointer;transition:all 0.2s;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.google-btn:hover{box-shadow:0 4px 16px rgba(0,0,0,0.15);transform:translateY(-1px);}
.google-btn img{width:20px;height:20px;}
.auth-divider{display:flex;align-items:center;gap:10px;margin:14px 0;color:var(--muted);font-size:0.78rem;}
.auth-divider::before,.auth-divider::after{content:'';flex:1;height:1px;background:var(--border);}
.auth-user-bar{display:none;align-items:center;gap:10px;background:var(--card);border:1px solid var(--border);
  border-radius:12px;padding:10px 14px;margin-bottom:12px;}
.auth-user-bar.show{display:flex;}
.auth-avatar{width:32px;height:32px;border-radius:50%;object-fit:cover;}
.auth-name{font-size:0.88rem;font-weight:700;flex:1;}
.auth-signout{background:none;border:1px solid var(--border);color:var(--muted);font-family:'Nunito',sans-serif;
  font-size:0.74rem;padding:4px 10px;border-radius:99px;cursor:pointer;transition:all 0.2s;}
.auth-signout:hover{border-color:var(--wrong);color:var(--wrong);}
.auth-status{font-size:0.72rem;color:var(--a3);margin-top:2px;}
.email-signup-box{background:linear-gradient(135deg,rgba(76,201,240,0.1),rgba(199,125,255,0.08));
  border:1px solid rgba(76,201,240,0.25);border-radius:16px;padding:18px 20px;margin-top:12px;}
.email-signup-box h4{font-size:0.95rem;font-weight:900;margin-bottom:4px;}
.email-signup-box p{font-size:0.8rem;color:var(--muted);margin-bottom:12px;line-height:1.5;}
.email-row{display:flex;gap:8px;flex-wrap:wrap;}
.email-input{flex:1;min-width:180px;background:var(--card2);border:1.5px solid var(--border);
  color:var(--text);font-family:'Nunito',sans-serif;font-size:0.9rem;padding:9px 13px;
  border-radius:10px;outline:none;transition:border-color 0.2s;}
.email-input:focus{border-color:#4cc9f0;}
.email-btn{background:linear-gradient(135deg,#4cc9f0,#c77dff);border:none;color:white;
  font-family:'Nunito',sans-serif;font-size:0.88rem;font-weight:800;padding:9px 20px;
  border-radius:10px;cursor:pointer;white-space:nowrap;transition:opacity 0.2s;}
.email-btn:hover{opacity:0.88;}
.email-success{font-size:0.82rem;color:var(--a3);font-weight:700;margin-top:8px;display:none;}

/* Name step that appears after email submit */
.name-step{display:none;animation:pageFadeIn 0.3s ease both;}
.name-step h4{font-size:0.95rem;font-weight:900;margin-bottom:3px;}
.name-step p{font-size:0.8rem;color:var(--muted);margin-bottom:12px;line-height:1.5;}
.name-fields{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;}
.name-fields .email-input{flex:1;min-width:120px;}
.name-submit-btn{background:linear-gradient(135deg,#4cc9f0,#c77dff);border:none;color:white;
  font-family:'Nunito',sans-serif;font-size:0.88rem;font-weight:800;padding:9px 20px;
  border-radius:10px;cursor:pointer;width:100%;transition:opacity 0.2s;}
.name-submit-btn:hover{opacity:0.88;}
.name-skip{background:none;border:none;color:var(--muted);font-family:'Nunito',sans-serif;
  font-size:0.75rem;cursor:pointer;margin-top:6px;text-decoration:underline;display:block;
  text-align:center;transition:color 0.2s;}
.name-skip:hover{color:var(--text);}


#q-streak-banner{display:none;align-items:center;gap:8px;padding:8px 14px;
  background:linear-gradient(135deg,rgba(255,107,53,0.15),rgba(255,154,60,0.1));
  border:1px solid rgba(255,107,53,0.3);border-radius:10px;margin-bottom:10px;
  animation:streakPop 0.4s cubic-bezier(0.34,1.56,0.64,1);}
@keyframes streakPop{from{opacity:0;transform:scale(0.88)}to{opacity:1;transform:scale(1)}}
#q-streak-banner.show{display:flex;}
.qs-fire{font-size:1.2rem;}
.qs-label{font-size:0.8rem;font-weight:700;color:var(--accent);}
.qs-num{font-family:'Space Mono',monospace;font-size:1.1rem;font-weight:700;color:var(--a2);}
.qs-sub{font-size:0.72rem;color:var(--muted);margin-left:auto;}

/* Nav question streak pill */
#nav-qstreak{font-size:0.75rem;color:var(--a2);font-weight:700;display:none;}


#ach-toast{position:fixed;bottom:16px;right:16px;background:var(--card2);border:1px solid var(--a5);
  border-radius:14px;padding:12px 15px;z-index:500;transform:translateX(160%);
  transition:transform 0.45s cubic-bezier(0.34,1.56,0.64,1);max-width:240px;box-shadow:var(--shadow);}
#ach-toast.show{transform:translateX(0);}
.toast-badge{font-size:0.62rem;color:var(--a5);text-transform:uppercase;letter-spacing:1px;font-weight:700;}
.toast-title2{font-size:0.92rem;font-weight:800;margin-top:2px;}
.toast-desc2{font-size:0.73rem;color:var(--muted);margin-top:2px;}

/* ‚îÄ‚îÄ‚îÄ XP POP ‚îÄ‚îÄ‚îÄ */
.xp-pop{position:fixed;font-family:'Space Mono',monospace;font-size:1rem;font-weight:700;
  pointer-events:none;z-index:600;animation:xpFloat 1.3s ease forwards;}
@keyframes xpFloat{0%{opacity:1;transform:translateY(0) scale(1)}70%{opacity:1}100%{opacity:0;transform:translateY(-60px) scale(1.15)}}

/* ‚îÄ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ‚îÄ */
.setting-row{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px 16px;
  display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.setting-label{font-size:0.88rem;font-weight:700;}
.setting-sub{font-size:0.72rem;color:var(--muted);margin-top:2px;}
.toggle{width:44px;height:24px;border-radius:99px;background:var(--card3);border:none;cursor:pointer;position:relative;transition:background 0.2s;flex-shrink:0;}
.toggle::after{content:'';position:absolute;width:18px;height:18px;border-radius:50%;background:white;top:3px;left:3px;transition:left 0.2s;}
.toggle.on{background:var(--a3);}
.toggle.on::after{left:23px;}
.select-input{background:var(--card2);border:1px solid var(--border);color:var(--text);font-family:'Nunito',sans-serif;font-size:0.82rem;padding:5px 10px;border-radius:8px;outline:none;cursor:pointer;}
.danger-btn{background:rgba(239,71,111,0.15);border:1px solid rgba(239,71,111,0.3);color:var(--wrong);font-family:'Nunito',sans-serif;font-size:0.85rem;font-weight:700;padding:9px 20px;border-radius:10px;cursor:pointer;transition:all 0.2s;}
.danger-btn:hover{background:rgba(239,71,111,0.25);}

/* ‚îÄ‚îÄ‚îÄ MISC ‚îÄ‚îÄ‚îÄ */
.card-section{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:14px;}
.card-section h3{font-size:0.92rem;font-weight:700;margin-bottom:12px;}
.chip{padding:3px 10px;border-radius:99px;font-size:0.7rem;font-weight:700;}
.chip-blue{background:rgba(17,138,178,0.2);color:var(--a4);}
.chip-green{background:rgba(6,214,160,0.2);color:var(--a3);}
.chip-purple{background:rgba(199,125,255,0.2);color:var(--a5);}
.chip-red{background:rgba(239,71,111,0.2);color:var(--wrong);}
.tag-wrap{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;}

/* ‚îÄ‚îÄ‚îÄ ROADMAP PAGE ‚îÄ‚îÄ‚îÄ */
.roadmap-item{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px 18px;margin-bottom:10px;display:flex;gap:14px;align-items:flex-start;}
.rm-num{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:0.9rem;flex-shrink:0;}
.rm-title{font-size:0.9rem;font-weight:700;margin-bottom:3px;}
.rm-desc{font-size:0.78rem;color:var(--muted);line-height:1.5;}
.phase-label{font-size:0.68rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--a5);font-weight:700;margin:18px 0 8px;}
.effort-chip{display:inline-block;font-size:0.65rem;padding:2px 8px;border-radius:99px;margin-left:6px;font-weight:700;}
.e-low{background:rgba(6,214,160,0.2);color:var(--a3);}
.e-med{background:rgba(255,209,102,0.2);color:var(--a2);}
.e-high{background:rgba(239,71,111,0.2);color:var(--wrong);}
.tech-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:8px;margin-top:8px;}
.tech-card{background:var(--card2);border-radius:10px;padding:10px 12px;font-size:0.78rem;}
.tech-card strong{display:block;color:var(--text);margin-bottom:2px;}
.tech-card span{color:var(--muted);font-size:0.7rem;}

/* ‚îÄ‚îÄ‚îÄ SMOOTHER GLOBAL ANIMATIONS ‚îÄ‚îÄ‚îÄ */
*{transition-timing-function:cubic-bezier(0.4,0,0.2,1);}
.page{animation:pageFadeIn 0.28s ease both;}
@keyframes pageFadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.opt-btn{transition:background 0.18s,border-color 0.18s,transform 0.15s,box-shadow 0.18s;}
.opt-btn:hover:not(:disabled){transform:translateX(3px) scale(1.01);box-shadow:0 4px 16px rgba(255,107,53,0.15);}
.dash-card{transition:transform 0.2s,box-shadow 0.2s;}
.dash-card:hover{transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,0.3);}
.ach-card{transition:transform 0.2s,box-shadow 0.2s,border-color 0.2s;}
.ach-card:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(199,125,255,0.15);}
.modal-box{animation:modalPop 0.3s cubic-bezier(0.34,1.56,0.64,1) both;}
@keyframes modalPop{from{opacity:0;transform:scale(0.92) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}
#question-card{transition:box-shadow 0.3s;}
.numpad-btn{transition:background 0.1s,transform 0.1s,border-color 0.15s;}
.tool-btn{transition:background 0.18s,color 0.18s,border-color 0.18s,transform 0.1s;}
.tool-btn:hover{transform:translateY(-1px);}
.topic-card-item{transition:transform 0.2s,border-color 0.2s,box-shadow 0.2s,background 0.2s;}
.topic-card-item:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.3);}
.shop-item{transition:transform 0.2s,border-color 0.2s,box-shadow 0.2s;}
.shop-item:hover{transform:translateY(-2px);}

/* ‚îÄ‚îÄ‚îÄ TOPIC PICKER BUTTON ‚îÄ‚îÄ‚îÄ */
.btn-topic-pick{background:var(--card);border:1.5px solid var(--border);color:var(--text);
  font-family:'Nunito',sans-serif;font-size:0.88rem;font-weight:700;padding:8px 14px;
  border-radius:12px;cursor:pointer;display:flex;align-items:center;gap:8px;
  transition:border-color 0.2s,background 0.2s,transform 0.15s;}
.btn-topic-pick:hover{border-color:var(--accent);background:var(--card2);transform:translateY(-1px);}

/* ‚îÄ‚îÄ‚îÄ TOPIC MODAL CARDS ‚îÄ‚îÄ‚îÄ */
.topic-card-item{background:var(--card2);border:1.5px solid var(--border);border-radius:14px;
  padding:14px 12px;cursor:pointer;text-align:center;position:relative;}
.topic-card-item.selected{border-color:var(--accent);background:rgba(255,107,53,0.08);}
.topic-card-item.active-topic{border-color:var(--a3);}
.tci-check{position:absolute;top:8px;right:8px;width:18px;height:18px;border-radius:5px;border:2px solid var(--border);background:var(--card3);display:flex;align-items:center;justify-content:center;font-size:0.65rem;transition:all 0.15s;}
.topic-card-item.selected .tci-check{background:var(--accent);border-color:var(--accent);color:white;}
.tci-icon{font-size:1.6rem;display:block;margin-bottom:5px;}
.tci-name{font-size:0.78rem;font-weight:700;display:block;margin-bottom:3px;}
.tci-acc{font-size:0.65rem;color:var(--muted);}
.tci-bar{height:3px;background:var(--card3);border-radius:99px;overflow:hidden;margin-top:5px;}
.tci-bar-fill{height:100%;border-radius:99px;transition:width 0.6s;}

/* ‚îÄ‚îÄ‚îÄ SHOP ‚îÄ‚îÄ‚îÄ */
.shop-item{background:var(--card2);border:1.5px solid var(--border);border-radius:14px;padding:14px 12px;text-align:center;cursor:pointer;}
.shop-item.owned{border-color:var(--a3);background:rgba(6,214,160,0.06);cursor:default;}
.shop-item.equipped{border-color:var(--a5);background:rgba(199,125,255,0.08);}
.shop-item.locked{opacity:0.6;}
.shop-icon{font-size:1.8rem;display:block;margin-bottom:5px;}
.shop-name{font-size:0.74rem;font-weight:700;display:block;margin-bottom:3px;}
.shop-cost{font-size:0.7rem;color:var(--a2);font-family:'Space Mono',monospace;font-weight:700;}
.shop-status{font-size:0.65rem;margin-top:4px;font-weight:700;}

/* ‚îÄ‚îÄ‚îÄ STUDY / TEST MODE BANNER ‚îÄ‚îÄ‚îÄ */
#mode-banner{display:none;background:rgba(17,138,178,0.12);border:1px solid rgba(17,138,178,0.3);border-radius:10px;padding:8px 14px;margin-bottom:10px;font-size:0.78rem;color:var(--a4);}
#mode-banner.visible{display:flex;align-items:center;justify-content:space-between;}
#concepts-content p{font-size:0.88rem;line-height:1.7;color:var(--text);}

.numpad-btn{background:var(--card2);border:1.5px solid var(--border);border-radius:12px;color:var(--text);
  font-family:'Space Mono',monospace;font-size:1.2rem;font-weight:700;padding:14px 8px;cursor:pointer;
  transition:all 0.12s;user-select:none;-webkit-user-select:none;}
.numpad-btn:active{transform:scale(0.93);background:var(--card3);}
.numpad-btn:hover{background:var(--card3);border-color:var(--accent);}
.numpad-clear{background:rgba(239,71,111,0.1);border-color:rgba(239,71,111,0.3);color:var(--wrong);}
.numpad-submit{background:linear-gradient(135deg,var(--a3),#05b889);border-color:var(--a3);color:#000;}
.numpad-submit:hover{opacity:0.9;}

/* ‚îÄ‚îÄ‚îÄ SELECT INPUT ‚îÄ‚îÄ‚îÄ */
.select-input{background:var(--card2);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-family:'Nunito',sans-serif;cursor:pointer;appearance:none;-webkit-appearance:none;}
.select-input:focus{outline:none;border-color:var(--accent);}


.sort-item{background:var(--card2);border:1.5px solid var(--border);border-radius:10px;padding:11px 14px;
  font-size:1rem;font-weight:700;cursor:grab;display:flex;align-items:center;gap:10px;
  transition:transform 0.15s,border-color 0.15s;user-select:none;}
.sort-item:active{cursor:grabbing;transform:scale(1.02);border-color:var(--accent);}
.sort-item.drag-over{border-color:var(--a3);background:rgba(6,214,160,0.08);}
.sort-item.selected{border-color:var(--accent);background:rgba(255,107,53,0.08);}


.inline-frac{display:inline-flex;flex-direction:column;align-items:center;vertical-align:middle;font-size:0.85em;line-height:1.1;margin:0 2px;}
.inline-frac sup,.inline-frac sub{font-size:1em;line-height:1;}
sup{font-size:0.7em;vertical-align:super;line-height:0;}
sub{font-size:0.7em;vertical-align:sub;line-height:0;}
.sqrt-wrap{display:inline-flex;align-items:center;gap:0;}
.sqrt-inner{border-top:1.5px solid currentColor;padding:0 2px;display:inline-block;}
.opt-btn sup,.opt-btn sub{font-size:0.72em;}
#question-text sup,#question-text sub{font-size:0.72em;}


.pro-badge{background:linear-gradient(135deg,#ffd166,#ff9a3c);color:#000;font-size:0.65rem;font-weight:900;padding:2px 7px;border-radius:99px;letter-spacing:0.5px;text-transform:uppercase;vertical-align:middle;}
.upgrade-btn{background:linear-gradient(135deg,#ffd166,#ff9a3c);border:none;color:#000;font-family:'Nunito',sans-serif;font-size:0.72rem;font-weight:900;padding:4px 12px;border-radius:99px;cursor:pointer;transition:all 0.2s;white-space:nowrap;}
.upgrade-btn:hover{transform:scale(1.05);box-shadow:0 0 16px rgba(255,209,102,0.5);}
.pro-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:500;overflow-y:auto;padding:16px;align-items:center;justify-content:center;}
.pro-modal-overlay.show{display:flex;}
.pro-modal{background:var(--card);border-radius:24px;max-width:500px;width:100%;padding:28px 24px;border:1.5px solid rgba(255,209,102,0.4);box-shadow:0 0 60px rgba(255,209,102,0.15);position:relative;margin:auto;}
.pro-modal-close{position:absolute;top:14px;right:14px;background:none;border:1px solid var(--border);color:var(--muted);width:30px;height:30px;border-radius:8px;cursor:pointer;font-size:1rem;}
.pro-title{font-size:1.6rem;font-weight:900;text-align:center;margin-bottom:4px;background:linear-gradient(135deg,#ffd166,#ff9a3c);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.pro-sub{text-align:center;color:var(--muted);font-size:0.85rem;margin-bottom:20px;}
.pro-tier-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;}
.pro-tier{border-radius:16px;padding:18px 16px;border:1.5px solid var(--border);background:var(--card2);}
.pro-tier.highlight{border-color:rgba(255,209,102,0.5);background:rgba(255,209,102,0.05);}
.pt-label{font-size:0.65rem;text-transform:uppercase;letter-spacing:1px;color:var(--muted);font-weight:700;}
.pt-name{font-size:1.1rem;font-weight:900;margin:4px 0;}
.pt-price{font-family:'Space Mono',monospace;font-size:1.3rem;font-weight:700;color:var(--a2);}
.pt-period{font-size:0.72rem;color:var(--muted);}
.pt-features{margin-top:12px;font-size:0.78rem;color:var(--muted);line-height:1.8;}
.pt-features li{list-style:none;padding-left:0;}
.pt-features li::before{content:'‚úì ';color:var(--a3);font-weight:700;}
.pt-cta{width:100%;margin-top:14px;padding:10px;border-radius:10px;font-family:'Nunito',sans-serif;font-size:0.88rem;font-weight:700;cursor:pointer;border:none;transition:all 0.2s;}
.pt-cta-free{background:var(--card3);color:var(--muted);}
.pt-cta-pro{background:linear-gradient(135deg,#ffd166,#ff9a3c);color:#000;}
.pt-cta-pro:hover{transform:translateY(-1px);box-shadow:0 4px 20px rgba(255,209,102,0.4);}
.lifetime-row{background:linear-gradient(135deg,rgba(199,125,255,0.1),rgba(17,138,178,0.1));border:1px solid rgba(199,125,255,0.3);border-radius:14px;padding:16px;margin-bottom:16px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;}
.lt-info strong{font-size:1rem;}
.lt-info p{font-size:0.75rem;color:var(--muted);margin-top:2px;}
.lt-price{font-family:'Space Mono',monospace;font-size:1.4rem;font-weight:700;color:var(--a5);}

@media(max-width:520px){
  #options-grid{grid-template-columns:1fr;}
  .formula-grid{grid-template-columns:1fr;}
  .nav-tabs{display:none;}
  .onboard-grid{grid-template-columns:1fr 1fr;}
}


</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     LOADING SCREEN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="loader">
  <div class="cube-scene">
    <div class="cube">
      <!-- Front face: has x¬≥ in center -->
      <div class="cube-face face-front">
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell center">x<sup>3</sup></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
      </div>
      <!-- Back -->
      <div class="cube-face face-back">
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
      </div>
      <!-- Right -->
      <div class="cube-face face-right">
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
      </div>
      <!-- Left -->
      <div class="cube-face face-left">
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
      </div>
      <!-- Top -->
      <div class="cube-face face-top">
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
      </div>
      <!-- Bottom -->
      <div class="cube-face face-bottom">
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <div class="cell"></div><div class="cell"></div><div class="cell"></div>
      </div>
    </div>
  </div>
  <div class="loader-title">NUMIQUBE</div>
  <div class="loader-bar-wrap"><div class="loader-bar"></div></div>
  <div class="loader-sub">Loading your math world...</div>
</div>

<!-- Stars -->
<div id="stars-bg"></div>

<!-- Achievement Toast -->
<div id="ach-toast">
  <div class="toast-badge">üèÖ Achievement Unlocked!</div>
  <div class="toast-title2" id="toast-name2">‚Äì</div>
  <div class="toast-desc2" id="toast-desc2">‚Äì</div>
</div>

<!-- Formula Modal -->
<div class="modal-overlay" id="formula-modal">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModal('formula-modal')">‚úï</button>
    <h2 style="font-size:1.2rem;margin-bottom:2px;">üìã Formula Sheet</h2>
    <p style="font-size:0.75rem;color:var(--muted);margin-bottom:4px;">Everything you need ‚Äî bookmark this!</p>
    <div class="formula-section"><h3>Quadratics</h3><div class="formula-grid">
      <div class="formula-card"><strong>Quadratic Formula</strong><span class="fn">x=(‚àíb¬±‚àö(b¬≤‚àí4ac))/2a</span></div>
      <div class="formula-card"><strong>Discriminant Rules</strong><span class="fn">&gt;0: 2 roots ¬∑ =0: 1 root ¬∑ &lt;0: none</span></div>
      <div class="formula-card"><strong>Vertex Form</strong><span class="fn">y=a(x‚àíh)¬≤+k, vertex=(h,k)</span></div>
      <div class="formula-card"><strong>Vieta's</strong><span class="fn">sum=‚àíb/a ¬∑ product=c/a</span></div>
    </div></div>
    <div class="formula-section"><h3>Algebra & Sequences</h3><div class="formula-grid">
      <div class="formula-card"><strong>Slope</strong><span class="fn">m=(y‚ÇÇ‚àíy‚ÇÅ)/(x‚ÇÇ‚àíx‚ÇÅ)</span></div>
      <div class="formula-card"><strong>Slope-Intercept</strong><span class="fn">y=mx+b</span></div>
      <div class="formula-card"><strong>Arithmetic Seq</strong><span class="fn">a‚Çô=a‚ÇÅ+(n‚àí1)d</span></div>
      <div class="formula-card"><strong>Geometric Seq</strong><span class="fn">a‚Çô=a‚ÇÅ¬∑r‚Åø‚Åª¬π</span></div>
      <div class="formula-card"><strong>Sum 1 to n</strong><span class="fn">n(n+1)/2</span></div>
      <div class="formula-card"><strong>Arith. Series</strong><span class="fn">n(a‚ÇÅ+a‚Çô)/2</span></div>
      <div class="formula-card"><strong>Geo. Series</strong><span class="fn">a‚ÇÅ(r‚Åø‚àí1)/(r‚àí1)</span></div>
      <div class="formula-card"><strong>Absolute Value</strong><span class="fn">|x|=a ‚Üí x=¬±a</span></div>
    </div></div>
    <div class="formula-section"><h3>Geometry</h3><div class="formula-grid">
      <div class="formula-card"><strong>Pythagorean</strong><span class="fn">a¬≤+b¬≤=c¬≤</span></div>
      <div class="formula-card"><strong>Circle</strong><span class="fn">A=œÄr¬≤ ¬∑ C=2œÄr</span></div>
      <div class="formula-card"><strong>Triangle Area</strong><span class="fn">A=¬Ωbh</span></div>
      <div class="formula-card"><strong>Trapezoid</strong><span class="fn">A=¬Ω(b‚ÇÅ+b‚ÇÇ)h</span></div>
      <div class="formula-card"><strong>Equilateral ‚ñ≥</strong><span class="fn">A=(‚àö3/4)s¬≤</span></div>
      <div class="formula-card"><strong>30-60-90</strong><span class="fn">x ¬∑ x‚àö3 ¬∑ 2x</span></div>
      <div class="formula-card"><strong>45-45-90</strong><span class="fn">x ¬∑ x ¬∑ x‚àö2</span></div>
      <div class="formula-card"><strong>Cylinder</strong><span class="fn">V=œÄr¬≤h</span></div>
      <div class="formula-card"><strong>Sphere</strong><span class="fn">V=(4/3)œÄr¬≥</span></div>
      <div class="formula-card"><strong>Interior ‚à† sum</strong><span class="fn">(n‚àí2)√ó180¬∞</span></div>
      <div class="formula-card"><strong>Diagonals</strong><span class="fn">n(n‚àí3)/2</span></div>
      <div class="formula-card"><strong>Arc Length</strong><span class="fn">(Œ∏/360)¬∑2œÄr</span></div>
    </div></div>
    <div class="formula-section"><h3>Number Theory & Combinatorics</h3><div class="formula-grid">
      <div class="formula-card"><strong>Permutations</strong><span class="fn">P(n,r)=n!/(n‚àír)!</span></div>
      <div class="formula-card"><strong>Combinations</strong><span class="fn">C(n,r)=n!/[r!(n‚àír)!]</span></div>
      <div class="formula-card"><strong>LCM√óGCD</strong><span class="fn">LCM¬∑GCD=a¬∑b</span></div>
      <div class="formula-card"><strong>Trailing zeros n!</strong><span class="fn">‚åän/5‚åã+‚åän/25‚åã+‚Ä¶</span></div>
      <div class="formula-card"><strong>Inclusion-Exclusion</strong><span class="fn">|A‚à™B|=|A|+|B|‚àí|A‚à©B|</span></div>
      <div class="formula-card"><strong>Circular Perms</strong><span class="fn">(n‚àí1)!</span></div>
    </div></div>
    <div class="formula-section"><h3>Probability & Stats</h3><div class="formula-grid">
      <div class="formula-card"><strong>Probability</strong><span class="fn">P=favorable/total</span></div>
      <div class="formula-card"><strong>Complement</strong><span class="fn">P(not A)=1‚àíP(A)</span></div>
      <div class="formula-card"><strong>Independent</strong><span class="fn">P(A‚à©B)=P(A)¬∑P(B)</span></div>
      <div class="formula-card"><strong>Mean</strong><span class="fn">xÃÑ=Œ£x/n</span></div>
    </div></div>
    <p style="color:var(--muted);font-size:0.7rem;margin-top:12px;">Press Esc or click outside to close.</p>
  </div>
</div>

<!-- PRO UPGRADE MODAL -->
<div class="pro-modal-overlay" id="pro-modal">
  <div class="pro-modal">
    <button class="pro-modal-close" onclick="closeProModal()">‚úï</button>
    <div class="pro-title">Numiqube Pro ‚≠ê</div>
    <p class="pro-sub">Unlock everything and blast through your goals faster.</p>

    <div class="pro-tier-grid">
      <div class="pro-tier">
        <div class="pt-label">Current Plan</div>
        <div class="pt-name">Free</div>
        <div class="pt-price">$0</div>
        <div class="pt-period">forever</div>
        <ul class="pt-features">
          <li>9 topics</li>
          <li>Progress tracking</li>
          <li>Achievements</li>
          <li>Leaderboard</li>
        </ul>
        <button class="pt-cta pt-cta-free" disabled>Current Plan</button>
      </div>
      <div class="pro-tier highlight">
        <div class="pt-label">üî• Most Popular</div>
        <div class="pt-name">Pro Monthly</div>
        <div class="pt-price">$2.99</div>
        <div class="pt-period">per month</div>
        <ul class="pt-features">
          <li>All 12 topics</li>
          <li>Hard + Extreme modes</li>
          <li>Unlimited goals</li>
          <li>Speed Mode unlocked</li>
          <li>No ads (ever)</li>
          <li>Priority new content</li>
        </ul>
        <button class="pt-cta pt-cta-pro" onclick="showComingSoon()">Get Pro Monthly</button>
      </div>
    </div>

    <div class="lifetime-row">
      <div class="lt-info">
        <strong>Lifetime Access üöÄ</strong>
        <p>One-time payment, own it forever. Best deal.</p>
      </div>
      <div>
        <div class="lt-price">$14.99</div>
        <button class="pt-cta pt-cta-pro" style="width:auto;padding:8px 20px;font-size:0.8rem;margin-top:6px;" onclick="showComingSoon()">Get Lifetime</button>
      </div>
    </div>

    <p style="text-align:center;font-size:0.72rem;color:var(--muted);">Payments coming soon via Stripe ¬∑ Cancel anytime ¬∑ No hidden fees</p>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     CONCEPTS MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="concepts-modal" style="align-items:flex-start;padding-top:70px;">
  <div class="modal-box" style="max-width:580px;">
    <button class="modal-close" onclick="closeModal('concepts-modal')">‚úï</button>
    <div id="concepts-content"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     REPORT QUESTION MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="report-modal">
  <div class="modal-box" style="max-width:420px;">
    <button class="modal-close" onclick="closeModal('report-modal')">‚úï</button>
    <h2 style="font-size:1.1rem;font-weight:900;margin-bottom:4px;">üö© Report This Question</h2>
    <p style="font-size:0.78rem;color:var(--muted);margin-bottom:14px;">Something wrong with this question? Let me know.</p>
    <div id="report-q-preview" style="background:var(--card2);border-radius:10px;padding:10px 12px;font-size:0.8rem;margin-bottom:12px;color:var(--muted);border-left:3px solid var(--wrong);"></div>
    <label style="font-size:0.78rem;color:var(--muted);display:block;margin-bottom:4px;">What's the issue?</label>
    <select id="report-type" class="select-input" style="width:100%;padding:9px 12px;font-size:0.85rem;margin-bottom:10px;">
      <option value="wrong_answer">Wrong answer / incorrect solution</option>
      <option value="confusing">Question is confusing or unclear</option>
      <option value="too_easy">Too easy for this difficulty</option>
      <option value="too_hard">Too hard for this difficulty</option>
      <option value="typo">Typo or formatting issue</option>
      <option value="other">Other</option>
    </select>
    <label style="font-size:0.78rem;color:var(--muted);display:block;margin-bottom:4px;">Extra details (optional)</label>
    <textarea id="report-details" style="width:100%;background:var(--card2);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-family:'Nunito',sans-serif;font-size:0.85rem;padding:9px 12px;resize:vertical;min-height:70px;outline:none;margin-bottom:14px;" placeholder="Anything else you want to add..."></textarea>
    <button class="btn-primary" style="width:100%;font-size:0.9rem;padding:10px;" onclick="submitReport()">Send Report ‚Üí</button>
  </div>
</div>


‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="topic-modal" style="align-items:flex-start;padding-top:70px;">
  <div class="modal-box" style="max-width:600px;">
    <button class="modal-close" onclick="closeModal('topic-modal')">‚úï</button>
    <h2 style="font-size:1.1rem;font-weight:900;margin-bottom:2px;">üìö Choose Topics</h2>
    <p style="font-size:0.75rem;color:var(--muted);margin-bottom:12px;">Select one or more ‚Äî questions will be mixed from everything you pick.</p>
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;background:var(--card2);border-radius:10px;padding:10px 14px;">
      <span style="font-size:0.82rem;font-weight:700;" id="selected-count-label">All 12 selected</span>
      <button id="toggle-all-btn" onclick="toggleAllTopics()" style="background:var(--accent);border:none;color:white;font-family:'Nunito',sans-serif;font-size:0.75rem;font-weight:700;padding:5px 14px;border-radius:99px;cursor:pointer;">Deselect All</button>
    </div>
    <div id="topic-card-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin-bottom:14px;"></div>
    <button class="btn-primary" style="width:100%;font-size:0.9rem;" onclick="confirmTopicSelection()">Study Selected Topics ‚Üí</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PRINT WORKSHEET MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="print-modal">
  <div class="modal-box" style="max-width:480px;">
    <button class="modal-close" onclick="closeModal('print-modal')">‚úï</button>
    <h2 style="font-size:1.1rem;font-weight:900;margin-bottom:4px;">üñ®Ô∏è Print a Worksheet</h2>
    <p style="font-size:0.78rem;color:var(--muted);margin-bottom:16px;">Generates a clean, ink-friendly sheet you can print and take anywhere.</p>
    <label style="font-size:0.78rem;color:var(--muted);display:block;margin-bottom:4px;">Topic</label>
    <select id="print-topic-sel" class="select-input" style="width:100%;margin-bottom:10px;padding:9px 12px;font-size:0.88rem;">
    </select>
    <label style="font-size:0.78rem;color:var(--muted);display:block;margin-bottom:4px;">Number of Questions</label>
    <select id="print-count-sel" class="select-input" style="width:100%;margin-bottom:10px;padding:9px 12px;font-size:0.88rem;">
      <option value="10">10 questions</option>
      <option value="15" selected>15 questions</option>
      <option value="20">20 questions</option>
    </select>
    <label style="font-size:0.78rem;color:var(--muted);display:block;margin-bottom:4px;">Difficulty</label>
    <select id="print-diff-sel" class="select-input" style="width:100%;margin-bottom:16px;padding:9px 12px;font-size:0.88rem;">
      <option value="all">All difficulties</option>
      <option value="easy">Easy only</option>
      <option value="medium">Medium only</option>
      <option value="hard">Hard only</option>
    </select>
    <button class="btn-primary" style="width:100%;" onclick="generateWorksheet()">üñ®Ô∏è Generate & Print</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     XP REWARDS SHOP MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="shop-modal">
  <div class="modal-box" style="max-width:540px;">
    <button class="modal-close" onclick="closeModal('shop-modal')">‚úï</button>
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;">
      <h2 style="font-size:1.1rem;font-weight:900;">üõçÔ∏è XP Rewards Shop</h2>
      <span style="font-family:'Space Mono',monospace;font-size:0.9rem;color:var(--a2);font-weight:700;" id="shop-xp-display">0 XP</span>
    </div>
    <p style="font-size:0.75rem;color:var(--muted);margin-bottom:16px;">Spend your XP on cosmetic rewards. Can't be bought, only earned.</p>
    <div id="shop-items-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;"></div>
  </div>
</div>

<!-- NAV -->
<nav id="nav">
  <div class="nav-logo" onclick="goHome()" style="cursor:pointer;" title="Back to Home">üßä Numiqube</div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showPage('study')">üìö Study</button>
    <button class="nav-tab" onclick="showPage('dashboard')">üè† Dashboard</button>
    <button class="nav-tab" onclick="showPage('progress')">üìä Progress</button>
    <button class="nav-tab" onclick="showPage('goals')">üéØ Goals</button>
    <button class="nav-tab" onclick="showPage('settings')">‚öôÔ∏è Settings</button>
  </div>
  <div class="nav-right">
    <button class="upgrade-btn" onclick="openProModal()">‚≠ê Upgrade</button>
    <span id="nav-streak">üî•0</span>
    <span id="nav-qstreak">‚ö°0</span>
    <div id="nav-auth-bar" class="auth-user-bar" style="margin-bottom:0;padding:5px 10px;">
      <img id="nav-auth-avatar" class="auth-avatar" src="" alt="" style="width:24px;height:24px;"/>
      <span id="nav-auth-name" style="font-size:0.78rem;"></span>
      <button class="auth-signout" onclick="signOut()">Sign out</button>
    </div>
    <span id="nav-lvl">LVL 1</span>
    <span id="nav-xp">0 XP</span>
    <span id="nav-timer">00:00</span>
    <button class="nav-icon-btn" onclick="openShop()" title="XP Shop" style="font-size:0.75rem;font-weight:700;width:auto;padding:0 8px;">üõçÔ∏è Shop</button>
    <button class="nav-icon-btn" onclick="openModal('formula-modal')" title="Formula Sheet">üìã</button>
    <button class="nav-icon-btn" onclick="toggleLight()" title="Theme" id="theme-btn">‚òÄÔ∏è</button>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     WHY US MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="whyus-modal">
  <div class="modal-box" style="max-width:560px;border-color:rgba(76,201,240,0.3);">
    <button class="modal-close" onclick="closeModal('whyus-modal')">‚úï</button>
    <h2 style="font-size:1.3rem;font-weight:900;margin-bottom:4px;background:linear-gradient(135deg,#4cc9f0,#c77dff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">Why Numiqube?</h2>
    <p style="color:var(--muted);font-size:0.78rem;margin-bottom:18px;">Straight from the person who built it.</p>

    <div style="font-size:0.9rem;line-height:1.85;color:var(--text);">
      <p style="margin-bottom:14px;">I'm the solo creator of this website. The main reason I started it is because I needed somewhere I could study everything I had to practice ‚Äî all in one place, quick and easy, without having to give all my information to big companies. Before this, I just printed out worksheets. It was boring, and it wasted a lot of ink. Ink costs money, so I thought: <em style="color:var(--a2);">"Why not make something that's digital, doesn't use ink, and actually helps?"</em> That's the reason Numiqube exists, and I really think you ‚Äî whoever is reading this ‚Äî will like it.</p>

      <p style="margin-bottom:14px;">There are a lot of math websites out there. Most of them are great at one thing, but stop being useful after a certain level. I wanted something that goes <strong style="color:var(--a2);">all the way</strong> ‚Äî from literally counting apples, to competition-level hard problems ‚Äî in one place.</p>

      <p style="margin-bottom:14px;">Here's what I think makes this different:</p>

      <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:16px;">
        <div style="background:var(--card2);border-radius:10px;padding:12px 14px;border-left:3px solid var(--a3);">
          <strong style="font-size:0.85rem;">Every wrong answer teaches you something.</strong>
          <p style="color:var(--muted);font-size:0.78rem;margin-top:3px;">Every single question has a step-by-step breakdown. Not just "wrong, try again." You actually learn why you got it wrong.</p>
        </div>
        <div style="background:var(--card2);border-radius:10px;padding:12px 14px;border-left:3px solid var(--a5);">
          <strong style="font-size:0.85rem;">Your XP actually means something.</strong>
          <p style="color:var(--muted);font-size:0.78rem;margin-top:3px;">Earn XP and spend it on real rewards ‚Äî unlock new themes, profile titles, and avatar icons. Not just a number that sits there doing nothing.</p>
        </div>
        <div style="background:var(--card2);border-radius:10px;padding:12px 14px;border-left:3px solid var(--a4);">
          <strong style="font-size:0.85rem;">Study anywhere ‚Äî even offline, on paper.</strong>
          <p style="color:var(--muted);font-size:0.78rem;margin-top:3px;">Print a custom worksheet from any topic, any difficulty. Real questions, clean format, no ink wasted on ads or logos.</p>
        </div>
        <div style="background:var(--card2);border-radius:10px;padding:12px 14px;border-left:3px solid var(--a2);">
          <strong style="font-size:0.85rem;">No ads. No "sign up to see the answer." No nonsense.</strong>
          <p style="color:var(--muted);font-size:0.78rem;margin-top:3px;">The free version is genuinely free. I hate when websites hide the useful stuff behind a paywall, so I didn't do that.</p>
        </div>
        <div style="background:var(--card2);border-radius:10px;padding:12px 14px;border-left:3px solid var(--accent);">
          <strong style="font-size:0.85rem;">Built by a student, not a corporation.</strong>
          <p style="color:var(--muted);font-size:0.78rem;margin-top:3px;">I'm not a company. I'm someone who needed a better tool and decided to build it. Every update comes from real feedback from real people using it.</p>
        </div>
      </div>

      <p style="color:var(--muted);font-size:0.8rem;">If you like it ‚Äî share it with a friend. That's genuinely the biggest thing you can do. üôè</p>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     HOME / ONBOARDING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-home">
  <!-- ? button top right -->
  <button onclick="openModal('whyus-modal')" style="position:fixed;top:16px;right:16px;width:36px;height:36px;border-radius:50%;background:var(--card);border:1.5px solid var(--border);color:var(--muted);font-size:1rem;font-weight:700;cursor:pointer;z-index:10;transition:all 0.2s;" onmouseover="this.style.borderColor='#4cc9f0';this.style.color='#4cc9f0'" onmouseout="this.style.borderColor='';this.style.color=''">?</button>

  <span class="rocket-anim">üßä</span>
  <h1 class="home-title">Numiqube</h1>
  <p class="home-motto">"We have a lot. From counting, to calculus."</p>
  <p class="home-sub">The math study app that actually makes sense ‚Äî for everyone.</p>

  <div class="onboard-grid">
    <div class="onboard-card"><span class="oc-icon">üìê</span><strong>12 Topics</strong><span>Counting ‚Üí Calculus</span></div>
    <div class="onboard-card"><span class="oc-icon">üèÜ</span><strong>Achievements</strong><span>20+ to unlock</span></div>
    <div class="onboard-card"><span class="oc-icon">üõçÔ∏è</span><strong>XP Shop</strong><span>Spend XP on rewards</span></div>
    <div class="onboard-card"><span class="oc-icon">üî•</span><strong>Streaks</strong><span>Study every day</span></div>
  </div>

  <!-- Google sign in -->
  <button class="google-btn" onclick="signInWithGoogle()">
    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google"/>
    Continue with Google
  </button>

  <div class="auth-divider">or</div>

  <!-- Guest / name entry -->
  <div class="name-input-wrap">
    <input id="username-input" placeholder="Your name (e.g. Alex)" maxlength="20"/>
    <button class="btn-primary" onclick="beginApp()">Let's go ‚Üí</button>
  </div>
  <p style="color:var(--muted);font-size:0.75rem;margin-top:8px;">Guest progress saves in this browser only. Sign in with Google to sync everywhere.</p>

  <!-- Email signup -->
  <div class="email-signup-box" style="max-width:460px;width:100%;margin-top:8px;">
    <div id="home-step-email">
      <h4>üì¨ Stay in the loop</h4>
      <p>Get notified when new topics, features, and improvements drop. No spam, ever.</p>
      <div class="email-row">
        <input class="email-input" id="home-email-input" type="email" placeholder="your@email.com"/>
        <button class="email-btn" onclick="submitEmail('home')">Notify me ‚Üí</button>
      </div>
    </div>
    <div class="name-step" id="home-step-name">
      <h4>üëã Nice! One more thing‚Ä¶</h4>
      <p>What should we call you? (Last name is optional)</p>
      <div class="name-fields">
        <input class="email-input" id="home-first-name" placeholder="First name" maxlength="20"/>
        <input class="email-input" id="home-last-name" placeholder="Last name (optional)" maxlength="30"/>
      </div>
      <button class="name-submit-btn" onclick="submitName('home')">Let's go üöÄ</button>
      <button class="name-skip" onclick="skipName('home')">Skip for now</button>
    </div>
    <div class="email-success" id="home-email-success">‚úÖ You're all set! Welcome to Numiqube.</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     GOOGLE ONBOARDING PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-onboarding">
  <div class="onb-card">
    <!-- Step dots -->
    <div class="onb-steps">
      <div class="onb-step-dot active" id="onb-dot-0"></div>
      <div class="onb-step-dot" id="onb-dot-1"></div>
      <div class="onb-step-dot" id="onb-dot-2"></div>
      <div class="onb-step-dot" id="onb-dot-3"></div>
    </div>

    <!-- Step 0: Welcome + what is Numiqube -->
    <div class="onb-step active" id="onb-step-0">
      <div id="onb-avatar-wrap" class="onb-google-avatar-placeholder">üßä</div>
      <h2 class="onb-title" id="onb-welcome-title">Welcome to Numiqube! üëã</h2>
      <p class="onb-sub">The math app that goes from counting to calculus ‚Äî all in one place.</p>
      <div class="onb-feature-list">
        <div class="onb-feature">
          <span class="onb-feature-icon">üéØ</span>
          <div class="onb-feature-text"><strong>Questions with real explanations</strong><span>Every wrong answer teaches you exactly what went wrong, step by step.</span></div>
        </div>
        <div class="onb-feature">
          <span class="onb-feature-icon">‚≠ê</span>
          <div class="onb-feature-text"><strong>Earn XP & unlock rewards</strong><span>Spend XP in the shop on themes, titles, and avatars.</span></div>
        </div>
        <div class="onb-feature">
          <span class="onb-feature-icon">üî•</span>
          <div class="onb-feature-text"><strong>Daily streaks & challenges</strong><span>Build a habit. Come back every day and watch your streak grow.</span></div>
        </div>
        <div class="onb-feature">
          <span class="onb-feature-icon">‚òÅÔ∏è</span>
          <div class="onb-feature-text"><strong>Your progress syncs everywhere</strong><span>Signed in with Google ‚Äî your XP, streak and achievements follow you.</span></div>
        </div>
      </div>
      <button class="onb-next-btn" onclick="onbNext(1)">Let's set up your profile ‚Üí</button>
    </div>

    <!-- Step 1: Name confirmation -->
    <div class="onb-step" id="onb-step-1">
      <h2 class="onb-title">What's your name?</h2>
      <p class="onb-sub">This is how you'll appear in Numiqube. You can change it anytime in Settings.</p>
      <label class="onb-label">Display name</label>
      <input class="onb-input" id="onb-name-input" placeholder="e.g. Alex" maxlength="20"/>
      <button class="onb-next-btn" onclick="onbSaveName()">Continue ‚Üí</button>
    </div>

    <!-- Step 2: Avatar picker -->
    <div class="onb-step" id="onb-step-2">
      <h2 class="onb-title">Pick your avatar</h2>
      <p class="onb-sub">Choose an icon that represents you!</p>
      <div class="avatar-grid" id="onb-avatar-grid"></div>
      <button class="onb-next-btn" onclick="onbNext(3)">Continue ‚Üí</button>
      <button class="onb-skip" onclick="onbNext(3)">Skip for now</button>
    </div>

    <!-- Step 3: Pick starting topic -->
    <div class="onb-step" id="onb-step-3">
      <h2 class="onb-title">What do you want to study?</h2>
      <p class="onb-sub">Pick a topic to start with. You can always switch later.</p>
      <div class="topic-onb-grid" id="onb-topic-grid"></div>
      <button class="onb-next-btn" onclick="onbFinish()">Start learning üöÄ</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MORE SIDE PANEL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="more-panel-overlay" onclick="closeMorePanel()"></div>
<div id="more-panel">
  <button class="panel-close" onclick="closeMorePanel()">‚úï</button>

  <div class="panel-title">Study Tools</div>
  <button class="panel-btn" onclick="openModal('formula-modal');closeMorePanel()">üìã Formula Sheet</button>
  <button class="panel-btn" onclick="openModal('concepts-modal');loadConcept();closeMorePanel()">üìñ Learn First</button>
  <button class="panel-btn" onclick="shuffleTopic();closeMorePanel()">üé≤ Random Topic</button>
  <button class="panel-btn" onclick="skipQ();closeMorePanel()">‚è≠ Skip Question</button>

  <div class="panel-title">Mode</div>
  <button class="panel-btn" id="panel-studymode-btn" onclick="toggleStudyMode()">üìö Study Mode: Off</button>
  <button class="panel-btn" id="panel-mode-btn" onclick="toggleMode()">üéØ Normal Mode</button>
  <button class="panel-btn" id="panel-sr-btn" onclick="toggleSR()">üß† Spaced Rep: Off</button>
  <button class="panel-btn" id="panel-pause-btn" onclick="togglePause()">‚è∏ Pause</button>

  <div class="panel-title">Other</div>
  <button class="panel-btn" onclick="openPrintModal();closeMorePanel()">üñ®Ô∏è Print Worksheet</button>
  <button class="panel-btn" onclick="showPage('progress');closeMorePanel()">üìä My Progress</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     STUDY PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-study" class="page">
<div class="container">

  <!-- Compact daily challenge -->
  <div id="daily-compact">
    <span id="daily-compact-label">‚ö° Daily</span>
    <div id="daily-compact-bar-wrap"><div id="daily-compact-bar"></div></div>
    <span id="daily-compact-count">0/10</span>
  </div>

  <!-- Topic selector -->
  <div id="topic-selector-row" style="margin-bottom:10px;">
    <div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:6px;">
      <button class="btn-topic-pick" id="topic-pick-btn" onclick="openTopicModal()">
        <span id="topic-pick-icon">üìê</span>
        <span id="topic-pick-name">Quadratics</span>
        <span style="color:var(--muted);font-size:0.8rem;">‚ñæ</span>
      </button>
      <span id="topic-pick-acc" style="font-size:0.72rem;color:var(--muted);"></span>
    </div>
  </div>

  <!-- Study mode banner -->
  <div id="mode-banner">
    <span>üìù <strong>Test Mode</strong> ‚Äî hints hidden, explanations shown at end</span>
    <span id="test-score-live" style="font-family:'Space Mono',monospace;font-size:0.72rem;"></span>
  </div>

  <!-- Slim toolbar: just More button + a couple quick actions -->
  <div class="study-toolbar">
    <button class="more-btn" onclick="openMorePanel()">‚ò∞ More</button>
    <button class="tool-btn" id="pause-btn" onclick="togglePause()">‚è∏ Pause</button>
    <button class="tool-btn" onclick="skipQ()">‚è≠ Skip</button>
    <!-- Hidden elements still needed for JS references -->
    <button style="display:none" id="studymode-btn"></button>
    <button style="display:none" id="mode-btn"></button>
    <button style="display:none" id="sr-btn"></button>
  </div>

  <div id="session-prog-wrap">
    <div id="session-prog-label"><span id="session-prog-text">Session Goal: 0 / 20</span><span id="session-goal-badge" style="color:var(--a3);font-size:0.7rem;">üéØ Keep going!</span></div>
    <div class="thin-bar"><div class="thin-bar-fill" id="session-prog-fill" style="width:0%"></div></div>
  </div>

  <div class="question-meta">
    <div id="topic-badge">Quadratics</div>
    <div id="q-counter">Q 1</div>
    <div id="score-display">0 / 0</div>
  </div>

  <!-- Question streak banner -->
  <div id="q-streak-banner">
    <span class="qs-fire">üî•</span>
    <span class="qs-label">Answer Streak</span>
    <span class="qs-num" id="q-streak-num">0</span>
    <span class="qs-sub" id="q-streak-sub">in a row!</span>
  </div>

  <div id="question-card">
    <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:6px;margin-bottom:8px;">
      <div id="diff-tag" class="d-easy">Easy</div>
      <div id="speed-ring-wrap">
        <svg id="speed-ring" viewBox="0 0 48 48">
          <circle cx="24" cy="24" r="20" fill="none" stroke="#ffffff15" stroke-width="4"/>
          <circle id="speed-arc" cx="24" cy="24" r="20" fill="none" stroke="var(--a2)" stroke-width="4"
            stroke-dasharray="125.6" stroke-dashoffset="0" stroke-linecap="round" transform="rotate(-90 24 24)"/>
          <text id="speed-num" x="24" y="25" text-anchor="middle" dominant-baseline="middle" font-family="Space Mono" font-size="11" fill="var(--a2)">15</text>
        </svg>
      </div>
    </div>
    <div id="question-text">Loading...</div>
    <div id="hint-section">
      <button id="hint-btn" onclick="showHint()">üí° Hint</button>
      <div id="hint-text"></div>
    </div>
    <div id="options-grid"></div>
    <div id="free-wrap">
      <input type="text" id="free-input" placeholder="Type your answer‚Ä¶" onkeydown="if(event.key==='Enter')submitFree()"/>
      <br><button id="submit-free" onclick="submitFree()">Submit ‚Üí</button>
    </div>
    <!-- Number Pad Input -->
    <div id="numpad-wrap" style="display:none;">
      <div id="numpad-display" style="background:var(--card2);border:2px solid var(--border);border-radius:12px;padding:14px 18px;font-family:'Space Mono',monospace;font-size:1.8rem;font-weight:700;text-align:right;margin-bottom:10px;min-height:56px;color:var(--text);letter-spacing:2px;">_</div>
      <div id="numpad-keys" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;">
        <button class="numpad-btn" onclick="numpadPress('1')">1</button>
        <button class="numpad-btn" onclick="numpadPress('2')">2</button>
        <button class="numpad-btn" onclick="numpadPress('3')">3</button>
        <button class="numpad-btn" onclick="numpadPress('4')">4</button>
        <button class="numpad-btn" onclick="numpadPress('5')">5</button>
        <button class="numpad-btn" onclick="numpadPress('6')">6</button>
        <button class="numpad-btn" onclick="numpadPress('7')">7</button>
        <button class="numpad-btn" onclick="numpadPress('8')">8</button>
        <button class="numpad-btn" onclick="numpadPress('9')">9</button>
        <button class="numpad-btn numpad-clear" onclick="numpadClear()">‚å´</button>
        <button class="numpad-btn" onclick="numpadPress('0')">0</button>
        <button class="numpad-btn numpad-submit" onclick="submitNumpad()">‚úì</button>
      </div>
    </div>
    <!-- Sort / Order Input -->
    <div id="sort-wrap" style="display:none;">
      <p style="font-size:0.78rem;color:var(--muted);margin-bottom:8px;">Drag to reorder, or tap to move:</p>
      <div id="sort-list" style="display:flex;flex-direction:column;gap:6px;"></div>
      <button class="numpad-btn numpad-submit" style="width:100%;margin-top:10px;border-radius:10px;" onclick="submitSort()">‚úì Submit Order</button>
    </div>
    <div id="feedback-box"></div>
    <button id="next-btn" onclick="nextQ()">Next ‚Üí</button>
    <div style="text-align:right;margin-top:8px;">
      <button onclick="openReportModal()" style="background:none;border:none;color:var(--muted);font-size:0.7rem;cursor:pointer;padding:2px 6px;border-radius:6px;transition:color 0.2s;" onmouseover="this.style.color='var(--wrong)'" onmouseout="this.style.color='var(--muted)'">üö© Report question</button>
    </div>
  </div>

  <div id="stats-row">
    <div class="stat-mini"><div class="snum" id="st-correct" style="color:var(--correct)">0</div><div class="slabel">Correct</div></div>
    <div class="stat-mini"><div class="snum" id="st-wrong" style="color:var(--wrong)">0</div><div class="slabel">Wrong</div></div>
    <div class="stat-mini"><div class="snum" id="st-streak" style="color:var(--accent)">0</div><div class="slabel">Best Streak</div></div>
    <div class="stat-mini"><div class="snum" id="st-acc" style="color:var(--a2)">--%</div><div class="slabel">Accuracy</div></div>
    <div class="stat-mini"><div class="snum" id="st-time" style="color:var(--a4)">--s</div><div class="slabel">Avg Time</div></div>
    <div class="stat-mini"><div class="snum" id="st-xp" style="color:var(--a5)">0</div><div class="slabel">Session XP</div></div>
  </div>

  <!-- Wrong answers review -->
  <div class="card-section" id="review-section" style="display:none;">
    <h3>üìå Questions You Got Wrong ‚Äî Review These!</h3>
    <div class="wrong-list" id="wrong-list"></div>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     DASHBOARD PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-dashboard" class="page">
<div class="container">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:8px;">
    <div>
      <h2 style="font-size:1.4rem;font-weight:900;">Welcome back, <span id="dash-name" style="color:var(--accent);">Student</span>! üëã</h2>
      <p style="color:var(--muted);font-size:0.82rem;" id="dash-subtitle">What are we learning today?</p>
    </div>
    <div id="dash-level-badge" style="background:linear-gradient(135deg,#7b2ff7,#f107a3);padding:8px 16px;border-radius:99px;font-weight:900;font-size:1rem;">LVL 1</div>
  </div>

  <p class="section-title">Overall Stats</p>
  <div class="dash-grid" id="dash-stats-grid"></div>

  <div class="card-section">
    <h3>üóìÔ∏è Study Activity (Last 28 Days)</h3>
    <div class="activity-grid" id="activity-grid"></div>
    <div style="display:flex;align-items:center;gap:6px;margin-top:8px;">
      <div style="width:10px;height:10px;border-radius:2px;background:var(--card3);"></div><span style="font-size:0.68rem;color:var(--muted);">None</span>
      <div style="width:10px;height:10px;border-radius:2px;background:rgba(6,214,160,0.35);"></div><span style="font-size:0.68rem;color:var(--muted);">Low</span>
      <div style="width:10px;height:10px;border-radius:2px;background:var(--a3);"></div><span style="font-size:0.68rem;color:var(--muted);">High</span>
    </div>
  </div>

  <div class="card-section">
    <h3>üî• Current Streak</h3>
    <div class="week-row" id="week-row"></div>
    <p style="color:var(--muted);font-size:0.78rem;margin-top:8px;" id="streak-msg">Study today to keep your streak alive!</p>
  </div>

  <p class="section-title" style="margin-top:4px;">Active Goals</p>
  <div id="dash-goals"></div>

  <div class="card-section">
    <h3>üí° Daily Tip</h3>
    <p id="daily-tip" style="font-size:0.85rem;color:var(--muted);line-height:1.6;"></p>
  </div>

  <button class="btn-primary" onclick="showPage('study')" style="width:100%;margin-top:4px;">üìö Start Studying Now</button>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     PROGRESS PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-progress" class="page">
<div class="container">
  <h2 style="font-size:1.3rem;font-weight:900;margin-bottom:14px;">üìä My Progress</h2>

  <div class="tab-row">
    <button class="tab-pill active" onclick="progressTab(this,'prog-accuracy')">üéØ Accuracy</button>
    <button class="tab-pill" onclick="progressTab(this,'prog-history')">üìú History</button>
    <button class="tab-pill" onclick="progressTab(this,'prog-review')">‚ùå Review Wrongs</button>
    <button class="tab-pill" onclick="progressTab(this,'prog-ach')">üèÖ Achievements</button>
  </div>

  <div id="prog-accuracy">
    <div class="card-section">
      <h3>Topic Accuracy</h3>
      <div id="topic-acc-bars"></div>
    </div>
    <div class="card-section">
      <h3>üìà Speed Analysis</h3>
      <div id="speed-analysis"></div>
    </div>
  </div>
  <div id="prog-history" style="display:none;">
    <div class="card-section">
      <h3>Session History</h3>
      <div class="history-list" id="history-list"></div>
    </div>
  </div>
  <div id="prog-review" style="display:none;">
    <div class="card-section">
      <h3>‚ùå Questions You Got Wrong ‚Äî Study These!</h3>
      <p style="font-size:0.78rem;color:var(--muted);margin-bottom:12px;">Tap any card to see the full explanation.</p>
      <div id="prog-wrong-list" class="wrong-list"></div>
    </div>
  </div>
  <div id="prog-ach" style="display:none;">
    <div class="card-section">
      <h3>üèÖ Achievements (<span id="ach-count">0</span> / <span id="ach-total">0</span>)</h3>
      <div class="ach-grid" id="ach-grid"></div>
    </div>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     GOALS PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-goals" class="page">
<div class="container">
  <h2 style="font-size:1.3rem;font-weight:900;margin-bottom:14px;">üéØ My Goals</h2>

  <div class="card-section">
    <h3>‚ûï Add New Goal</h3>
    <label style="font-size:0.78rem;color:var(--muted);display:block;margin-bottom:4px;">Goal Title</label>
    <input class="goal-input" id="goal-title-in" placeholder="e.g. Answer 50 quadratic questions this week"/>
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <div style="flex:1;min-width:120px;">
        <label style="font-size:0.78rem;color:var(--muted);display:block;margin-bottom:4px;">Type</label>
        <select class="goal-input" id="goal-type-in">
          <option value="questions">Total Questions</option>
          <option value="correct">Correct Answers</option>
          <option value="xp">XP Earned</option>
          <option value="streak">Day Streak</option>
          <option value="topic">Topic Mastery (80%+ acc)</option>
        </select>
      </div>
      <div style="flex:1;min-width:100px;">
        <label style="font-size:0.78rem;color:var(--muted);display:block;margin-bottom:4px;">Target</label>
        <input class="goal-input" id="goal-target-in" type="number" placeholder="50" min="1"/>
      </div>
    </div>
    <button class="btn-primary" style="margin-top:10px;padding:10px 24px;font-size:0.9rem;" onclick="addGoal()">Add Goal</button>
  </div>

  <p class="section-title">Active Goals</p>
  <div id="goals-list"></div>

  <p class="section-title" style="margin-top:18px;">Completed Goals üéâ</p>
  <div id="goals-done"></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     LEADERBOARD PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     ROADMAP / GO BIG PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-roadmap" class="page">
<div class="container">
  <h2 style="font-size:1.3rem;font-weight:900;margin-bottom:4px;">üó∫Ô∏è How to Go BIG</h2>
  <p style="color:var(--muted);font-size:0.82rem;margin-bottom:18px;">Your step-by-step guide to turning Numiqube into a real, published app.</p>

  <div class="card-section">
    <h3>üõ†Ô∏è Tech Stack We'd Use</h3>
    <div class="tech-grid">
      <div class="tech-card"><strong>React Native</strong><span>iOS + Android from one codebase</span></div>
      <div class="tech-card"><strong>Expo</strong><span>Fast development & publishing</span></div>
      <div class="tech-card"><strong>Firebase</strong><span>Auth, database, leaderboard</span></div>
      <div class="tech-card"><strong>Supabase</strong><span>Alt: Postgres + auth + real-time</span></div>
      <div class="tech-card"><strong>Next.js</strong><span>Web version + landing page</span></div>
      <div class="tech-card"><strong>Vercel</strong><span>Free hosting for the web app</span></div>
      <div class="tech-card"><strong>GitHub</strong><span>Version control + open source</span></div>
      <div class="tech-card"><strong>RevenueCat</strong><span>Subscriptions & in-app purchases</span></div>
    </div>
  </div>

  <div class="phase-label">Phase 1 ‚Äî Get It on GitHub (Free, This Weekend)</div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(6,214,160,0.2);color:var(--a3);">1</div>
    <div><div class="rm-title">Create a GitHub account <span class="effort-chip e-low">15 min</span></div>
    <div class="rm-desc">Go to github.com ‚Üí Sign up ‚Üí Create a new repository called "numiqube". This is where all your code lives.</div></div></div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(6,214,160,0.2);color:var(--a3);">2</div>
    <div><div class="rm-title">Upload this HTML file <span class="effort-chip e-low">10 min</span></div>
    <div class="rm-desc">Go to your repo ‚Üí "Add file" ‚Üí "Upload files" ‚Üí drag this .html file in. Commit it. Your app is now version-controlled.</div></div></div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(6,214,160,0.2);color:var(--a3);">3</div>
    <div><div class="rm-title">Deploy with GitHub Pages (free website!) <span class="effort-chip e-low">5 min</span></div>
    <div class="rm-desc">Settings ‚Üí Pages ‚Üí Source: main branch ‚Üí index.html. Your app will be live at username.github.io/numiqube ‚Äî share this link with friends!</div></div></div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(6,214,160,0.2);color:var(--a3);">4</div>
    <div><div class="rm-title">Add a README.md <span class="effort-chip e-low">20 min</span></div>
    <div class="rm-desc">Write what Numiqube is, who it's for, screenshots. A good README makes people take your project seriously. Use Claude to help write it!</div></div></div>

  <div class="phase-label">Phase 2 ‚Äî Make It a Real Web App (1-2 Months)</div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(255,209,102,0.2);color:var(--a2);">5</div>
    <div><div class="rm-title">Learn React.js basics <span class="effort-chip e-med">2‚Äì3 weeks</span></div>
    <div class="rm-desc">React is the #1 framework for building web apps. Free resources: react.dev official tutorial, freeCodeCamp, or just ask Claude to teach you step by step.</div>
    <div class="tag-wrap"><span class="chip chip-blue">react.dev</span><span class="chip chip-blue">freeCodeCamp</span><span class="chip chip-green">Claude tutoring</span></div></div></div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(255,209,102,0.2);color:var(--a2);">6</div>
    <div><div class="rm-title">Set up Firebase (real data storage) <span class="effort-chip e-med">1 week</span></div>
    <div class="rm-desc">Firebase is free for small apps. Add: Google authentication (sign in with Google), Firestore (cloud database to save progress), and Firebase Hosting.</div>
    <div class="tag-wrap"><span class="chip chip-blue">firebase.google.com</span><span class="chip chip-green">Free tier generous</span></div></div></div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(255,209,102,0.2);color:var(--a2);">7</div>
    <div><div class="rm-title">Add a real leaderboard <span class="effort-chip e-med">3 days</span></div>
    <div class="rm-desc">With Firebase, you can show real XP from real users worldwide. Add school-based leaderboards ‚Äî students compete with their classmates!</div></div></div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(255,209,102,0.2);color:var(--a2);">8</div>
    <div><div class="rm-title">Expand the question bank with AI <span class="effort-chip e-low">Ongoing</span></div>
    <div class="rm-desc">Use Claude's API to generate new questions dynamically. Never run out of problems. Each question auto-tagged with topic, difficulty, and step-by-step solution.</div>
    <div class="tag-wrap"><span class="chip chip-purple">Anthropic API</span><span class="chip chip-green">Infinite questions</span></div></div></div>

  <div class="phase-label">Phase 3 ‚Äî iOS & Android App (2‚Äì4 Months)</div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(239,71,111,0.2);color:var(--wrong);">9</div>
    <div><div class="rm-title">Convert to React Native + Expo <span class="effort-chip e-high">3‚Äì4 weeks</span></div>
    <div class="rm-desc">React Native lets you write once and ship to iPhone AND Android. Expo makes it much easier. Your React skills carry over directly.</div>
    <div class="tag-wrap"><span class="chip chip-blue">expo.dev</span><span class="chip chip-blue">reactnative.dev</span></div></div></div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(239,71,111,0.2);color:var(--wrong);">10</div>
    <div><div class="rm-title">Submit to Apple App Store <span class="effort-chip e-high">$99/year + 1 week</span></div>
    <div class="rm-desc">You need an Apple Developer Account ($99/year). The review process takes 1‚Äì3 days. You'll need a Mac or use a cloud Mac service like MacStadium. Be 17+ or have parent help.</div></div></div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(239,71,111,0.2);color:var(--wrong);">11</div>
    <div><div class="rm-title">Submit to Google Play Store <span class="effort-chip e-med">$25 one-time + 3 days</span></div>
    <div class="rm-desc">Google Play is cheaper ($25 one-time fee) and easier to get approved. Great place to launch first.</div></div></div>

  <div class="phase-label">Phase 4 ‚Äî Make Money & Grow (6+ Months)</div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(199,125,255,0.2);color:var(--a5);">12</div>
    <div><div class="rm-title">Add a "Pro" subscription <span class="effort-chip e-med">1 week</span></div>
    <div class="rm-desc">Free tier: 9 topics, progress tracking. Pro ($2.99/month): AI-generated problems, no ads, study schedule, parent dashboard. Use RevenueCat to handle payments.</div></div></div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(199,125,255,0.2);color:var(--a5);">13</div>
    <div><div class="rm-title">Partner with schools & MATHCOUNTS teams <span class="effort-chip e-high">Ongoing</span></div>
    <div class="rm-desc">Contact your school's math teacher. Offer free teacher accounts. Schools can assign Numiqube as homework. This is how you get hundreds of users fast. Make a short demo video and email it.</div></div></div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(199,125,255,0.2);color:var(--a5);">14</div>
    <div><div class="rm-title">Post on social media <span class="effort-chip e-low">1 hour</span></div>
    <div class="rm-desc">Post on Reddit (r/learnmath, r/mathcounts, r/teenagers), TikTok (show your streak, achievements), Instagram. "Built my own math app at 13" is a compelling story!</div>
    <div class="tag-wrap"><span class="chip chip-blue">r/learnmath</span><span class="chip chip-blue">r/mathcounts</span><span class="chip chip-green">TikTok / IG</span></div></div></div>
  <div class="roadmap-item"><div class="rm-num" style="background:rgba(199,125,255,0.2);color:var(--a5);">15</div>
    <div><div class="rm-title">Apply to hackathons & competitions <span class="effort-chip e-med">Several weekends</span></div>
    <div class="rm-desc">Competitions like Congressional App Challenge, FBLA, DECA, Regeneron STS all love apps that solve real problems. Numiqube is exactly that. Winning or placing can get you college attention and sometimes prize money.</div>
    <div class="tag-wrap"><span class="chip chip-purple">Congressional App Challenge</span><span class="chip chip-purple">FBLA</span><span class="chip chip-purple">Regeneron</span></div></div></div>

  <div class="card-section" style="margin-top:18px;">
    <h3>üí∞ Realistic Revenue Projection</h3>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-top:8px;">
      <div style="background:var(--card2);border-radius:10px;padding:12px;text-align:center;">
        <div style="font-family:'Space Mono',monospace;font-size:1.2rem;color:var(--a3);font-weight:700;">$0</div>
        <div style="font-size:0.72rem;color:var(--muted);margin-top:3px;">Month 1 (GitHub Pages free)</div>
      </div>
      <div style="background:var(--card2);border-radius:10px;padding:12px;text-align:center;">
        <div style="font-family:'Space Mono',monospace;font-size:1.2rem;color:var(--a2);font-weight:700;">$50‚Äì200</div>
        <div style="font-size:0.72rem;color:var(--muted);margin-top:3px;">Month 6 (Pro subscriptions)</div>
      </div>
      <div style="background:var(--card2);border-radius:10px;padding:12px;text-align:center;">
        <div style="font-family:'Space Mono',monospace;font-size:1.2rem;color:var(--accent);font-weight:700;">$500+</div>
        <div style="font-size:0.72rem;color:var(--muted);margin-top:3px;">Month 12 (School partnerships)</div>
      </div>
    </div>
  </div>

  <div class="card-section">
    <h3>üöÄ Your First Step (Do This Today!)</h3>
    <p style="font-size:0.85rem;color:var(--muted);line-height:1.7;">1. Make a GitHub account at <strong style="color:var(--accent);">github.com</strong><br>2. Create a repo called <strong style="color:var(--a2);">numiqube</strong><br>3. Upload this HTML file and enable GitHub Pages<br>4. Share the link with 5 friends and your math teacher<br>5. Watch people actually use something <em>you</em> built üî•</p>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SETTINGS PAGE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="page-settings" class="page">
<div class="container">
  <h2 style="font-size:1.3rem;font-weight:900;margin-bottom:16px;">‚öôÔ∏è Settings</h2>

  <p class="section-title">Appearance</p>
  <div class="setting-row">
    <div><div class="setting-label">Light Mode</div><div class="setting-sub">Switch between dark and light theme</div></div>
    <button class="toggle" id="light-toggle" onclick="toggleLight()"></button>
  </div>

  <p class="section-title" style="margin-top:14px;">Study Preferences</p>
  <div class="setting-row">
    <div><div class="setting-label">Session Goal</div><div class="setting-sub">Questions per session</div></div>
    <select class="select-input" id="goal-select" onchange="updateSessionGoal()">
      <option value="10">10 questions</option>
      <option value="20" selected>20 questions</option>
      <option value="30">30 questions</option>
      <option value="50">50 questions</option>
    </select>
  </div>
  <div class="setting-row">
    <div><div class="setting-label">Speed Mode Timer</div><div class="setting-sub">Seconds per question in speed mode</div></div>
    <select class="select-input" id="speed-timer-select" onchange="saveSettings()">
      <option value="10">10 seconds</option>
      <option value="15" selected>15 seconds</option>
      <option value="20">20 seconds</option>
      <option value="30">30 seconds</option>
    </select>
  </div>
  <div class="setting-row">
    <div><div class="setting-label">Sound Effects</div><div class="setting-sub">Play sounds on correct/wrong answers</div></div>
    <button class="toggle on" id="sound-toggle" onclick="toggleSetting('sound')"></button>
  </div>
  <div class="setting-row">
    <div><div class="setting-label">Confetti on Achievements</div><div class="setting-sub">Celebrate big wins!</div></div>
    <button class="toggle on" id="confetti-toggle" onclick="toggleSetting('confetti')"></button>
  </div>

  <p class="section-title" style="margin-top:14px;">Profile</p>
  <div class="setting-row">
    <div><div class="setting-label">Display Name</div><div class="setting-sub" id="current-name-display">‚Äì</div></div>
    <button class="btn-secondary" style="font-size:0.78rem;padding:7px 14px;" onclick="changeName()">Change</button>
  </div>

  <p class="section-title" style="margin-top:14px;">Data</p>
  <div class="setting-row">
    <div><div class="setting-label">Export Progress</div><div class="setting-sub">Download your stats as JSON</div></div>
    <button class="btn-secondary" style="font-size:0.78rem;padding:7px 14px;" onclick="exportData()">Export</button>
  </div>
  <div class="setting-row">
    <div><div class="setting-label" style="color:var(--wrong);">Reset All Data</div><div class="setting-sub">Delete all progress permanently</div></div>
    <button class="danger-btn" onclick="resetData()">Reset</button>
  </div>

  <p class="section-title" style="margin-top:14px;">Newsletter</p>
  <div class="email-signup-box">
    <div id="settings-step-email">
      <h4>üì¨ Stay updated</h4>
      <p>Get notified when new topics, features, and improvements drop. No spam, ever.</p>
      <div class="email-row">
        <input class="email-input" id="settings-email-input" type="email" placeholder="your@email.com"/>
        <button class="email-btn" onclick="submitEmail('settings')">Notify me ‚Üí</button>
      </div>
    </div>
    <div class="name-step" id="settings-step-name">
      <h4>üëã Nice! One more thing‚Ä¶</h4>
      <p>What should we call you? (Last name is optional)</p>
      <div class="name-fields">
        <input class="email-input" id="settings-first-name" placeholder="First name" maxlength="20"/>
        <input class="email-input" id="settings-last-name" placeholder="Last name (optional)" maxlength="30"/>
      </div>
      <button class="name-submit-btn" onclick="submitName('settings')">Save üöÄ</button>
      <button class="name-skip" onclick="skipName('settings')">Skip for now</button>
    </div>
    <div class="email-success" id="settings-email-success">‚úÖ You're all set! Welcome to Numiqube.</div>
  </div>

  <div class="card-section" style="margin-top:16px;">
    <h3>‚å®Ô∏è Keyboard Shortcuts</h3>
    <div style="background:rgba(76,201,240,0.08);border:1px solid rgba(76,201,240,0.2);border-radius:10px;padding:10px 12px;margin-bottom:12px;font-size:0.78rem;color:var(--muted);">
      üí° <strong style="color:#4cc9f0;">iPad or tablet?</strong> Connect a Bluetooth keyboard to use all shortcuts below. Go to Settings ‚Üí Bluetooth on your device.
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:8px;font-size:0.78rem;">
      <div style="background:var(--card2);border-radius:8px;padding:8px 10px;"><strong style="font-family:'Space Mono',monospace;">1/2/3/4</strong> ‚Äî Select answer</div>
      <div style="background:var(--card2);border-radius:8px;padding:8px 10px;"><strong style="font-family:'Space Mono',monospace;">A/B/C/D</strong> ‚Äî Select answer</div>
      <div style="background:var(--card2);border-radius:8px;padding:8px 10px;"><strong style="font-family:'Space Mono',monospace;">Enter</strong> ‚Äî Next question</div>
      <div style="background:var(--card2);border-radius:8px;padding:8px 10px;"><strong style="font-family:'Space Mono',monospace;">H</strong> ‚Äî Show/hide hint</div>
      <div style="background:var(--card2);border-radius:8px;padding:8px 10px;"><strong style="font-family:'Space Mono',monospace;">R</strong> ‚Äî Random topic</div>
      <div style="background:var(--card2);border-radius:8px;padding:8px 10px;"><strong style="font-family:'Space Mono',monospace;">Esc</strong> ‚Äî Close modals</div>
    </div>
  </div>

  <div style="text-align:center;margin-top:20px;color:var(--muted);font-size:0.72rem;">
    Numiqube v1.0 ¬∑ Built with ‚ù§Ô∏è ¬∑ Your data is stored locally in this browser
  </div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MAIN SCRIPT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FIREBASE SETUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const firebaseConfig = {
  apiKey: "AIzaSyDyjLVPEGhEeWxwqodCXaGGhcKhEh7GcG4",
  authDomain: "numiqube-a67f9.firebaseapp.com",
  projectId: "numiqube-a67f9",
  storageBucket: "numiqube-a67f9.firebasestorage.app",
  messagingSenderId: "91585910537",
  appId: "1:91585910537:web:1d1661c19c004570eea5d8"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const googleProvider = new firebase.auth.GoogleAuthProvider();

let currentUser = null;

function signInWithGoogle() {
  auth.signInWithPopup(googleProvider).catch(err => {
    console.error('Sign in error:', err);
    alert('Sign in failed. Make sure popups are allowed and try again.');
  });
}

function signOut() {
  auth.signOut().then(() => {
    currentUser = null;
    updateAuthUI(null);
  });
}

function updateAuthUI(user) {
  const bar = document.getElementById('nav-auth-bar');
  if (user) {
    bar.classList.add('show');
    document.getElementById('nav-auth-name').textContent = user.displayName || user.email;
    if (user.photoURL) {
      document.getElementById('nav-auth-avatar').src = user.photoURL;
      document.getElementById('nav-auth-avatar').style.display = 'block';
    } else {
      document.getElementById('nav-auth-avatar').style.display = 'none';
    }
  } else {
    bar.classList.remove('show');
  }
}

async function saveStateToFirebase() {
  if (!currentUser) return;
  try {
    const toSave = Object.assign({}, S);
    toSave.earned = [...S.earned];
    delete toSave.q; delete toSave.speedInterval; delete toSave.srQueue;
    await db.collection('users').doc(currentUser.uid).set(toSave, { merge: true });
  } catch(e) { console.error('Firebase save error:', e); }
}

async function loadStateFromFirebase() {
  if (!currentUser) return false;
  try {
    const doc = await db.collection('users').doc(currentUser.uid).get();
    if (doc.exists) {
      const d = doc.data();
      Object.assign(S, d);
      S.earned = new Set(S.earned || []);
      S.q = null; S.answered = false;
      S.streak = S.streak || 0; S.lastTime = 999; S.lastCorrect = false; S.qStart = 0;
      S.hintUsed = false; S.speedInterval = null; S.paused = false;
      S.mode = 'normal'; S.srMode = false; S.srQueue = [];
      S.sessionCorrect = 0; S.sessionXP = 0;
      return true;
    }
  } catch(e) { console.error('Firebase load error:', e); }
  return false;
}

// Listen for auth state changes
auth.onAuthStateChanged(async user => {
  currentUser = user;
  if (user) {
    updateAuthUI(user);
    const loaded = await loadStateFromFirebase();
    const isNewUser = !loaded || !S.onboardingDone;
    if (!loaded) {
      S.username = user.displayName || user.email.split('@')[0];
    }
    if (isNewUser) {
      showOnboarding(user);
    } else {
      showHomePage();
    }
  } else {
    updateAuthUI(null);
    showHomePage();
  }
});

const ONB_AVATARS = ['ü¶Å','ü¶ä','üêØ','üê¨','ü¶Ñ','üêâ','ü¶ã','ü¶Ö','üêß','ü¶à','ü¶ì','üê∏','üêº','ü¶â','ü¶ö','üê∫','ü¶ù','üêô'];
let _onbSelectedAvatar = '‚≠ê';
let _onbSelectedTopic = 'quadratics';

function showOnboarding(user) {
  document.getElementById('loader').classList.add('hidden');
  document.getElementById('page-home').style.display = 'none';
  document.getElementById('page-onboarding').classList.add('active');
  document.getElementById('nav').style.display = 'none';

  // Set avatar/name from Google
  if (user.photoURL) {
    const wrap = document.getElementById('onb-avatar-wrap');
    wrap.outerHTML = `<img id="onb-avatar-wrap" class="onb-google-avatar" src="${user.photoURL}" alt=""/>`;
  }
  const firstName = (user.displayName || S.username || '').split(' ')[0];
  document.getElementById('onb-welcome-title').textContent = `Welcome, ${firstName}! üëã`;
  document.getElementById('onb-name-input').value = user.displayName || S.username || '';

  // Build avatar grid
  const grid = document.getElementById('onb-avatar-grid');
  grid.innerHTML = ONB_AVATARS.map(a =>
    `<button class="avatar-opt${a===_onbSelectedAvatar?' selected':''}" onclick="selectOnbAvatar('${a}')">${a}</button>`
  ).join('');

  // Build topic grid
  const tgrid = document.getElementById('onb-topic-grid');
  tgrid.innerHTML = Object.entries(TL).map(([k,v]) =>
    `<button class="topic-onb-btn${k===_onbSelectedTopic?' selected':''}" onclick="selectOnbTopic('${k}',this)">
      <span class="t-icon">${TOPIC_ICONS[k]||'üìö'}</span>
      <span class="t-name">${v.replace(/[üçéüî¢üìêüîóüìèüé≤üìàüß©üìäüèÜüî•‚öñÔ∏èüî£]/g,'').trim()}</span>
    </button>`
  ).join('');
}

function onbNext(step) {
  document.querySelectorAll('.onb-step').forEach(s => s.classList.remove('active'));
  document.getElementById('onb-step-' + step).classList.add('active');
  // Update dots
  document.querySelectorAll('.onb-step-dot').forEach((d, i) => {
    d.classList.remove('active','done');
    if (i < step) d.classList.add('done');
    else if (i === step) d.classList.add('active');
  });
}

function onbSaveName() {
  const name = document.getElementById('onb-name-input').value.trim();
  if (!name) {
    const inp = document.getElementById('onb-name-input');
    inp.style.borderColor = 'var(--wrong)';
    inp.placeholder = 'Please enter your name!';
    setTimeout(() => { inp.style.borderColor=''; inp.placeholder='e.g. Alex'; }, 1800);
    return;
  }
  S.username = name.slice(0, 20);
  onbNext(2);
}

function selectOnbAvatar(a) {
  _onbSelectedAvatar = a;
  document.querySelectorAll('.avatar-opt').forEach(b => b.classList.remove('selected'));
  event.target.closest('.avatar-opt').classList.add('selected');
}

function selectOnbTopic(key, el) {
  _onbSelectedTopic = key;
  document.querySelectorAll('.topic-onb-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
}

function onbFinish() {
  // Save choices
  S.onboardingDone = true;
  S.currentTopic = _onbSelectedTopic;
  if (!S.shopEquipped) S.shopEquipped = {};
  S.shopEquipped.avatar = _onbSelectedAvatar;

  // Hide onboarding
  document.getElementById('page-onboarding').classList.remove('active');

  // Launch app to dashboard
  document.getElementById('nav').style.display = 'flex';
  updateDayStreak();
  restoreEquipped();
  isStudyPageActive = false;
  buildTopicTabs();
  startTimer();
  loadQ();
  showPage('dashboard');
  refreshDashboard();
  saveState();

  // Welcome XP
  S.xp += 25;
  updateLevel();
  saveState();
  setTimeout(() => spawnXP('+25 XP üéâ Welcome to Numiqube!', '#4cc9f0'), 600);
}



function showHomePage() {
  document.getElementById('loader').classList.add('hidden');
  document.getElementById('page-home').style.display = 'flex';
  document.getElementById('nav').style.display = 'none';
  // Pre-fill username input if we have a name
  if (S.username) {
    document.getElementById('username-input').value = S.username;
  }
  // If signed in with Google, show a welcome back message
  if (currentUser) {
    const firstName = (currentUser.displayName || S.username || '').split(' ')[0];
    document.querySelector('.home-motto').textContent = `Welcome back, ${firstName}! üëã`;
  }
}


const QB = {
  counting:[
    {text:"There are 3 apples and 2 oranges. How many fruits in total?",opts:["5","4","6","3"],ans:0,diff:"easy",type:"numpad",accepted:["5"],
      hint:"Count the apples, then count the oranges, then add them together.",
      steps:["Apples: 3","Oranges: 2","Total: 3 + 2 = 5"],exp:"3 + 2 = 5 fruits total."},
    {text:"You have 7 stickers and give away 3. How many do you have left?",opts:["4","3","5","10"],ans:0,diff:"easy",type:"numpad",accepted:["4"],
      hint:"Start with 7, then take away 3.",
      steps:["Start: 7","Take away: 3","7 ‚àí 3 = 4"],exp:"7 ‚àí 3 = 4 stickers left."},
    {text:"What number comes after 15?",opts:["16","14","17","15"],ans:0,diff:"easy",type:"numpad",accepted:["16"],
      hint:"Count up by 1 from 15.",
      steps:["...14, 15, 16, 17...","The next number is 16"],exp:"16 comes right after 15."},
    {text:"Double the number 6.",opts:["12","10","8","6"],ans:0,diff:"easy",type:"numpad",accepted:["12"],
      hint:"Doubling means adding the number to itself: 6 + 6.",
      steps:["Double 6 = 6 + 6","= 12"],exp:"6 + 6 = 12."},
    {text:"Count by 2s: 2, 4, 6, 8, __",opts:["10","9","12","11"],ans:0,diff:"easy",type:"numpad",accepted:["10"],
      hint:"Each number is 2 more than the last.",
      steps:["8 + 2 = 10"],exp:"The pattern adds 2 each time: next is 10."},
    {text:"There are 5 birds on a fence. 2 fly away. How many remain?",opts:["3","2","4","7"],ans:0,diff:"easy",type:"numpad",accepted:["3"],
      hint:"Start with 5, subtract 2.",
      steps:["5 ‚àí 2 = 3"],exp:"5 ‚àí 2 = 3 birds remain."},
    {text:"Which is bigger: 9 or 6?",opts:["9","6","They are equal","Can't tell"],ans:0,diff:"easy",
      hint:"Think of the number line ‚Äî which is further right?",
      steps:["On a number line: ...6...7...8...9...","9 is further right ‚Üí 9 is bigger"],exp:"9 > 6."},
    {text:"What is half of 10?",opts:["5","4","6","2"],ans:0,diff:"easy",type:"numpad",accepted:["5"],
      hint:"Half means splitting into 2 equal groups: 10 √∑ 2.",
      steps:["10 √∑ 2 = 5"],exp:"Half of 10 = 5."},
    {text:"A dozen eggs is how many?",opts:["12","10","6","24"],ans:0,diff:"easy",type:"numpad",accepted:["12"],
      hint:"A 'dozen' is a special word meaning a specific number.",
      steps:["A dozen = 12","This is a word to memorize!"],exp:"A dozen = 12."},
    {text:"3 √ó 4 = ?",opts:["12","7","10","9"],ans:0,diff:"easy",type:"numpad",accepted:["12"],
      hint:"3 groups of 4: 4 + 4 + 4.",
      steps:["3 √ó 4 = 4 + 4 + 4","= 8 + 4 = 12"],exp:"3 √ó 4 = 12."},
  
    {text:"How many sides does a triangle have?",opts:["3","4","5","6"],ans:0,diff:"easy",type:"numpad",accepted:["3"],hint:"Think about what 'tri' means.",steps:["Triangle has 3 sides"],exp:"3 sides."},
    {text:"What is 4 + 4?",opts:["8","6","9","7"],ans:0,diff:"easy",type:"numpad",accepted:["8"],hint:"Count 4 then 4 more.",steps:["4+4=8"],exp:"8."},
    {text:"What is 10 ‚àí 6?",opts:["4","5","3","6"],ans:0,diff:"easy",type:"numpad",accepted:["4"],hint:"Start at 10, count back 6.",steps:["10‚àí6=4"],exp:"4."},
    {text:"Count by 5s: 5, 10, 15, __",opts:["20","25","18","22"],ans:0,diff:"easy",type:"numpad",accepted:["20"],hint:"Add 5 to 15.",steps:["15+5=20"],exp:"20."},
    {text:"A box has 4 rows of 3 crayons. Total?",opts:["12","7","8","16"],ans:0,diff:"easy",type:"numpad",accepted:["12"],hint:"4√ó3.",steps:["4√ó3=12"],exp:"12."},
    {text:"What number is between 7 and 9?",opts:["8","6","10","7"],ans:0,diff:"easy",type:"numpad",accepted:["8"],hint:"7, __, 9.",steps:["8"],exp:"8."},
    {text:"What is 5 √ó 5?",opts:["25","20","30","10"],ans:0,diff:"easy",type:"numpad",accepted:["25"],hint:"5+5+5+5+5.",steps:["25"],exp:"25."},
    {text:"12 cookies shared equally among 4. How many each?",opts:["3","4","6","2"],ans:0,diff:"easy",type:"numpad",accepted:["3"],hint:"12√∑4.",steps:["12√∑4=3"],exp:"3."},
    {text:"What is one hundred minus one?",opts:["99","100","98","101"],ans:0,diff:"easy",type:"numpad",accepted:["99"],hint:"100‚àí1.",steps:["99"],exp:"99."},
    {text:"Smallest of: 42, 18, 35, 27?",opts:["18","27","35","42"],ans:0,diff:"easy",hint:"Look at tens digits.",steps:["Tens: 4,1,3,2 ‚Üí smallest is 1 ‚Üí 18"],exp:"18."},
    {text:"What is 9 + 7?",opts:["16","15","17","14"],ans:0,diff:"easy",type:"numpad",accepted:["16"],hint:"Make 10: 9+1+6=16.",steps:["16"],exp:"16."},
    {text:"Clock shows 3:00. Hours until 7:00?",opts:["4","3","5","6"],ans:0,diff:"easy",type:"numpad",accepted:["4"],hint:"Count from 3 to 7.",steps:["4 hours"],exp:"4."},
    {text:"What is 2 √ó 9?",opts:["18","16","20","19"],ans:0,diff:"easy",type:"numpad",accepted:["18"],hint:"9+9.",steps:["18"],exp:"18."},
    {text:"24 marbles, take out 8. How many left?",opts:["16","14","18","15"],ans:0,diff:"easy",type:"numpad",accepted:["16"],hint:"24‚àí8.",steps:["16"],exp:"16."},
    {text:"Even numbers between 1 and 10 (not including 1 and 10)?",opts:["4","3","5","6"],ans:0,diff:"easy",type:"numpad",accepted:["4"],hint:"2, 4, 6, 8.",steps:["2,4,6,8 ‚Üí 4 numbers"],exp:"4."},
],
  earlyMath:[
    {text:"What is 23 + 48?",opts:["71","61","81","70"],ans:0,diff:"easy",type:"numpad",accepted:["71"],
      hint:"Add the ones column first (3+8=11, carry the 1), then the tens.",
      steps:["Ones: 3 + 8 = 11, write 1 carry 1","Tens: 2 + 4 + 1(carry) = 7","Answer: 71"],exp:"23 + 48 = 71."},
    {text:"What is 100 ‚àí 37?",opts:["63","73","67","53"],ans:0,diff:"easy",type:"numpad",accepted:["63"],
      hint:"Think of it as: how many do you add to 37 to reach 100?",
      steps:["37 + 3 = 40","40 + 60 = 100","Total added: 3 + 60 = 63"],exp:"100 ‚àí 37 = 63."},
    {text:"A pencil costs $0.75. You pay $1.00. Change?",opts:["$0.25","$0.15","$0.35","$0.20"],ans:0,diff:"easy",
      hint:"Subtract: $1.00 ‚àí $0.75.",
      steps:["$1.00 ‚àí $0.75","= $0.25"],exp:"You get $0.25 back."},
    {text:"8 √ó 7 = ?",opts:["56","54","48","63"],ans:0,diff:"easy",type:"numpad",accepted:["56"],
      hint:"A multiplication table fact to memorize: 8 √ó 7.",
      steps:["8 √ó 7 = 56","Tip: 8√ó7 = 56 (5,6 ‚Äî consecutive digits!)"],exp:"8 √ó 7 = 56."},
    {text:"Order from least to greatest: 45, 12, 78, 33",opts:["12, 33, 45, 78","12, 45, 33, 78","33, 12, 45, 78","78, 45, 33, 12"],ans:0,diff:"easy",type:"sort",sortItems:["45","12","78","33"],sortAnswer:["12","33","45","78"],
      hint:"Compare the tens digits first.",
      steps:["Tens: 1(2), 3(3), 4(5), 7(8)","Smallest first: 12, 33, 45, 78"],exp:"12 < 33 < 45 < 78."},
    {text:"What is 6¬≤?",opts:["36","12","30","64"],ans:0,diff:"easy",type:"numpad",accepted:["36"],
      hint:"6¬≤ means 6 √ó 6.",
      steps:["6¬≤ = 6 √ó 6 = 36"],exp:"6 √ó 6 = 36."},
    {text:"A rectangle has sides 4 and 7. What is the perimeter?",opts:["22","28","11","18"],ans:0,diff:"easy",type:"numpad",accepted:["22"],
      hint:"Perimeter = add all four sides. A rectangle has two pairs of equal sides.",
      steps:["Sides: 4, 7, 4, 7","Perimeter: 4+7+4+7=22"],exp:"2(4+7) = 22."},
    {text:"What is 15% of 60?",opts:["9","6","12","15"],ans:0,diff:"medium",type:"numpad",accepted:["9"],
      hint:"10% of 60 = 6. Then 5% = half of that = 3. Add them.",
      steps:["10% of 60 = 6","5% of 60 = 3","15% = 6 + 3 = 9"],exp:"15% √ó 60 = 9."},
    {text:"Simplify the fraction: 12/16",opts:["3/4","2/3","4/5","6/8"],ans:0,diff:"medium",
      hint:"Divide top and bottom by their GCD (which is 4).",
      steps:["GCD(12,16)=4","12√∑4=3 ¬∑ 16√∑4=4","Answer: 3/4"],exp:"12/16 = 3/4."},
    {text:"A store sells 3 shirts for $24. Cost per shirt?",opts:["$8","$6","$9","$12"],ans:0,diff:"easy",type:"numpad",accepted:["8"],
      hint:"Divide total cost by number of shirts.",
      steps:["$24 √∑ 3 = $8 per shirt"],exp:"$24 √∑ 3 = $8."},
  
    {text:"144 √∑ 12?",opts:["12","11","13","14"],ans:0,diff:"easy",type:"numpad",accepted:["12"],hint:"12√ó12=144.",steps:["12"],exp:"12."},
    {text:"25% of 200?",opts:["50","25","75","100"],ans:0,diff:"easy",type:"numpad",accepted:["50"],hint:"25%=1/4. 200√∑4.",steps:["50"],exp:"50."},
    {text:"Round 3,847 to nearest hundred.",opts:["3800","3900","4000","3000"],ans:0,diff:"easy",hint:"Tens digit is 4 < 5 ‚Üí round down.",steps:["3800"],exp:"3800."},
    {text:"Perimeter of square with side 9?",opts:["36","18","27","81"],ans:0,diff:"easy",type:"numpad",accepted:["36"],hint:"4√ó9.",steps:["36"],exp:"36."},
    {text:"13 √ó 11?",opts:["143","131","133","144"],ans:0,diff:"easy",type:"numpad",accepted:["143"],hint:"13√ó10+13.",steps:["130+13=143"],exp:"143."},
    {text:"Pizza cut in 8 slices, eat 3. Fraction remaining?",opts:["5/8","3/8","1/2","3/5"],ans:0,diff:"easy",hint:"8‚àí3=5.",steps:["5/8"],exp:"5/8."},
    {text:"7¬≤ ‚àí 4¬≤?",opts:["33","45","24","15"],ans:0,diff:"medium",type:"numpad",accepted:["33"],hint:"49‚àí16.",steps:["33"],exp:"33."},
    {text:"0.75 as a fraction in lowest terms?",opts:["3/4","7/10","3/5","75/10"],ans:0,diff:"medium",hint:"75/100 √∑ 25.",steps:["3/4"],exp:"3/4."},
    {text:"Train at 60 mph for 2.5 hours. Distance?",opts:["150 miles","120 miles","125 miles","180 miles"],ans:0,diff:"medium",hint:"d=60√ó2.5.",steps:["150"],exp:"150 miles."},
    {text:"Area of triangle, base 10 height 6?",opts:["30","60","20","36"],ans:0,diff:"medium",type:"numpad",accepted:["30"],hint:"¬Ω√ó10√ó6.",steps:["30"],exp:"30."},
    {text:"Which is larger: 7/8 or 5/6?",opts:["7/8","5/6","Equal","Can't compare"],ans:0,diff:"medium",hint:"7/8=21/24, 5/6=20/24.",steps:["21>20 ‚Üí 7/8"],exp:"7/8."},
    {text:"30% off $50 item. What do you pay?",opts:["$35","$20","$30","$15"],ans:0,diff:"medium",hint:"70% of $50.",steps:["$35"],exp:"$35."},
    {text:"Simplify 18/24.",opts:["3/4","2/3","4/6","9/12"],ans:0,diff:"easy",hint:"GCD=6.",steps:["3/4"],exp:"3/4."},
    {text:"1,000 √ó 0.001?",opts:["1","10","0.1","100"],ans:0,diff:"medium",type:"numpad",accepted:["1"],hint:"Move decimal 3 places.",steps:["1"],exp:"1."},
    {text:"2.5 cups per batch √ó 3 batches?",opts:["7.5 cups","5.5 cups","6 cups","8 cups"],ans:0,diff:"medium",hint:"2.5√ó3.",steps:["7.5"],exp:"7.5 cups."},
    {text:"5! (five factorial)?",opts:["120","60","24","100"],ans:0,diff:"medium",type:"numpad",accepted:["120"],hint:"5√ó4√ó3√ó2√ó1.",steps:["120"],exp:"120."},
    {text:"3/5 as a percentage?",opts:["60%","35%","53%","75%"],ans:0,diff:"easy",hint:"3√∑5√ó100.",steps:["60%"],exp:"60%."},
    {text:"240 miles on 8 gallons. MPG?",opts:["30 mpg","28 mpg","32 mpg","25 mpg"],ans:0,diff:"medium",type:"numpad",accepted:["30"],hint:"240√∑8.",steps:["30"],exp:"30 mpg."},
    {text:"LCM of 4 and 6?",opts:["12","24","8","6"],ans:0,diff:"medium",type:"numpad",accepted:["12"],hint:"Multiples of 4: 4,8,12... and 6: 6,12...",steps:["12"],exp:"12."},
    {text:"If x=3, what is 4x+7?",opts:["19","16","22","13"],ans:0,diff:"medium",type:"numpad",accepted:["19"],hint:"4(3)+7.",steps:["12+7=19"],exp:"19."},
],
  quadratics:[
    {text:"Factor completely: x¬≤ + 5x + 6",opts:["(x+2)(x+3)","(x+1)(x+6)","(x‚àí2)(x‚àí3)","(x+6)(x‚àí1)"],ans:0,diff:"easy",
      hint:"Look for two numbers that MULTIPLY to 6 and ADD to 5.",
      steps:["Find two numbers: multiply to 6 and add to 5.","Try 2 and 3: 2√ó3=6 ‚úì and 2+3=5 ‚úì","So x¬≤+5x+6 = (x+2)(x+3) ‚úì"],
      exp:"(x+2)(x+3): 2√ó3=6 and 2+3=5."},
    {text:"Solve: x¬≤ ‚àí 7x + 12 = 0",opts:["x=3 or x=4","x=‚àí3 or x=‚àí4","x=2 or x=6","x=1 or x=12"],ans:0,diff:"easy",
      hint:"Factor by finding two numbers that multiply to 12 and add to ‚àí7.",
      steps:["We need two numbers: multiply to 12, add to ‚àí7.","‚àí3 √ó ‚àí4 = 12 ‚úì and ‚àí3 + (‚àí4) = ‚àí7 ‚úì","So (x‚àí3)(x‚àí4)=0","Set each factor to 0: x=3 or x=4"],
      exp:"(x‚àí3)(x‚àí4)=0 ‚Üí x=3 or x=4."},
    {text:"Solve: x¬≤ ‚àí 4 = 0",opts:["x=2 or x=‚àí2","x=4 or x=‚àí4","x=2 only","No real solutions"],ans:0,diff:"easy",
      hint:"This is a difference of squares! a¬≤‚àíb¬≤ = (a+b)(a‚àíb).",
      steps:["Recognize x¬≤‚àí4 = x¬≤‚àí2¬≤","Factor: (x+2)(x‚àí2)=0","x+2=0 ‚Üí x=‚àí2 ¬∑ x‚àí2=0 ‚Üí x=2","Answer: x=¬±2"],
      exp:"Difference of squares: (x+2)(x‚àí2)=0 ‚Üí x=¬±2."},
    {text:"Quadratic formula for 2x¬≤ + 5x ‚àí 3 = 0:",opts:["x=¬Ω or x=‚àí3","x=1 or x=‚àí3","x=‚àí¬Ω or x=3","x=2 or x=‚àí3"],ans:0,diff:"medium",
      hint:"Identify a=2, b=5, c=‚àí3. Discriminant = b¬≤‚àí4ac = 25+24 = 49.",
      steps:["a=2, b=5, c=‚àí3","Discriminant: 25‚àí4(2)(‚àí3)=25+24=49","‚àö49=7","x=(‚àí5¬±7)/4","x=(‚àí5+7)/4=2/4=¬Ω OR x=(‚àí5‚àí7)/4=‚àí3"],
      exp:"Disc=49. x=(‚àí5¬±7)/4 ‚Üí x=¬Ω or x=‚àí3."},
    {text:"The discriminant b¬≤‚àí4ac = ‚àí9. This means:",opts:["No real solutions","One repeated real root","Two distinct real roots","Two integer roots"],ans:0,diff:"medium",
      hint:"Negative discriminant ‚Üí square root of negative number ‚Üí no real solutions.",
      steps:["Discriminant < 0 ‚Üí ‚àö(negative) is not real","Therefore: no real solutions","The equation has complex/imaginary roots"],
      exp:"b¬≤‚àí4ac<0 means no real roots exist."},
    {text:"A parabola has vertex (2,‚àí1) and passes through (0,3). Its equation:",opts:["y=(x‚àí2)¬≤‚àí1","y=‚àí(x‚àí2)¬≤‚àí1","y=2(x‚àí2)¬≤‚àí1","y=(x+2)¬≤+1"],ans:0,diff:"hard",
      hint:"Start with vertex form: y=a(x‚àíh)¬≤+k where (h,k) is the vertex. Then find 'a'.",
      steps:["Vertex (2,‚àí1): y=a(x‚àí2)¬≤‚àí1","Plug in (0,3): 3=a(0‚àí2)¬≤‚àí1","3=4a‚àí1 ‚Üí 4a=4 ‚Üí a=1","Answer: y=(x‚àí2)¬≤‚àí1 = x¬≤‚àí4x+3"],
      exp:"Vertex form: y=a(x‚àí2)¬≤‚àí1. Plug (0,3): a=1."},
    {text:"For what k does x¬≤ + kx + 9 = 0 have exactly one solution?",opts:["k=6 or k=‚àí6","k=3 or k=‚àí3","k=9 only","k=0"],ans:0,diff:"hard",
      hint:"Exactly one solution ‚Üî discriminant = 0. Set b¬≤‚àí4ac=0.",
      steps:["Discriminant = k¬≤‚àí4(1)(9)=k¬≤‚àí36","For one solution: k¬≤‚àí36=0","k¬≤=36 ‚Üí k=¬±6"],
      exp:"k¬≤‚àí4(9)=0 ‚Üí k¬≤=36 ‚Üí k=¬±6."},
    {text:"Sum of roots of 3x¬≤ ‚àí 12x + 7 = 0?",opts:["4","‚àí4","7/3","12"],ans:0,diff:"medium",
      hint:"Vieta's Formula: sum of roots = ‚àíb/a. No need to solve!",
      steps:["Vieta's Formula: sum = ‚àíb/a","Here b=‚àí12, a=3","Sum = ‚àí(‚àí12)/3 = 12/3 = 4"],
      exp:"Vieta's: sum = ‚àíb/a = 12/3 = 4."},
    {text:"Product of roots of 2x¬≤ + 6x ‚àí 10 = 0?",opts:["‚àí5","5","‚àí3","3"],ans:0,diff:"medium",
      hint:"Vieta's Formula: product of roots = c/a.",
      steps:["Vieta's Formula: product = c/a","Here c=‚àí10, a=2","Product = ‚àí10/2 = ‚àí5"],
      exp:"Vieta's: product = c/a = ‚àí10/2 = ‚àí5."},
    {text:"Solve: x¬≤ + 6x + 9 = 0",opts:["x=‚àí3 (double)","x=3","x=3 or x=‚àí3","x=‚àí9"],ans:0,diff:"easy",
      hint:"This is a PERFECT SQUARE TRINOMIAL. (x + ?)¬≤ = x¬≤ + 2?x + ?¬≤",
      steps:["Recognize: 6=2√ó3 and 9=3¬≤","So x¬≤+6x+9 = (x+3)¬≤","(x+3)¬≤=0 ‚Üí x+3=0 ‚Üí x=‚àí3","This is a repeated (double) root"],
      exp:"(x+3)¬≤=0 ‚Üí x=‚àí3 (double root)."},
    {text:"If one root of x¬≤ ‚àí 5x + k = 0 is x=2, find k.",opts:["6","‚àí6","10","3"],ans:0,diff:"medium",
      hint:"If 2 is a root, substituting x=2 must make the equation true.",
      steps:["Substitute x=2: (2)¬≤‚àí5(2)+k=0","4‚àí10+k=0","‚àí6+k=0 ‚Üí k=6"],
      exp:"4‚àí10+k=0 ‚Üí k=6."},
    {text:"For which x is x¬≤ ‚àí 3x ‚àí 10 < 0?",opts:["‚àí2 < x < 5","x<‚àí2 or x>5","‚àí5<x<2","x>‚àí2 and x<5"],ans:0,diff:"hard",
      hint:"Factor first. Parabola opens UP (a>0), so it's negative BETWEEN the roots.",
      steps:["Factor: (x‚àí5)(x+2)=0 ‚Üí roots x=5 and x=‚àí2","Parabola opens up (a=1>0)","It's negative (below x-axis) BETWEEN the roots","Answer: ‚àí2 < x < 5"],
      exp:"(x‚àí5)(x+2)<0. Parabola up ‚Üí negative between roots: ‚àí2<x<5."},
  
    {text:"Discriminant of x¬≤‚àí4x+4=0?",opts:["0","16","8","‚àí4"],ans:0,diff:"easy",type:"numpad",accepted:["0"],hint:"b¬≤‚àí4ac=(‚àí4)¬≤‚àí4(1)(4).",steps:["16‚àí16=0"],exp:"0 ‚Üí one repeated root."},
    {text:"Solve (x‚àí5)(x+3)=0.",opts:["x=5 or x=‚àí3","x=‚àí5 or x=3","x=5 and x=3","x=‚àí5"],ans:0,diff:"easy",hint:"Zero product property.",steps:["x=5 or x=‚àí3"],exp:"x=5 or x=‚àí3."},
    {text:"Roots of x¬≤‚àí9=0?",opts:["x=¬±3","x=¬±9","x=3","x=9"],ans:0,diff:"easy",hint:"x¬≤=9.",steps:["x=¬±3"],exp:"¬±3."},
    {text:"Vertex of y=x¬≤‚àí6x+5?",opts:["(3,‚àí4)","(‚àí3,4)","(6,5)","(3,5)"],ans:0,diff:"medium",hint:"x=‚àíb/2a=3, then y.",steps:["x=3, y=‚àí4"],exp:"(3,‚àí4)."},
    {text:"Roots of 2x¬≤+5x‚àí3=0?",opts:["x=1/2 or x=‚àí3","x=3 or x=‚àí1/2","x=1 or x=‚àí3","x=2 or x=‚àí3"],ans:0,diff:"medium",hint:"a=2,b=5,c=‚àí3. Discriminant=49.",steps:["x=(‚àí5¬±7)/4 ‚Üí 1/2 or ‚àí3"],exp:"x=1/2 or x=‚àí3."},
    {text:"Sum of roots of x¬≤‚àí7x+10=0?",opts:["7","10","‚àí7","17"],ans:0,diff:"easy",type:"numpad",accepted:["7"],hint:"‚àíb/a.",steps:["7"],exp:"7."},
    {text:"Product of roots of x¬≤‚àí7x+10=0?",opts:["10","7","‚àí7","‚àí10"],ans:0,diff:"easy",type:"numpad",accepted:["10"],hint:"c/a.",steps:["10"],exp:"10."},
    {text:"Factor 2x¬≤+7x+3.",opts:["(2x+1)(x+3)","(2x+3)(x+1)","(x+3)(2x‚àí1)","(2x+6)(x+1)"],ans:0,diff:"medium",hint:"AC=6, split middle: 1 and 6.",steps:["(2x+1)(x+3)"],exp:"(2x+1)(x+3)."},
    {text:"Solve x¬≤+10x+25=0.",opts:["x=‚àí5","x=5","x=¬±5","x=5 or x=‚àí5"],ans:0,diff:"easy",hint:"Perfect square: (x+5)¬≤.",steps:["x=‚àí5"],exp:"x=‚àí5 (double root)."},
    {text:"Maximum of y=‚àíx¬≤+4?",opts:["4","‚àí4","0","2"],ans:0,diff:"medium",type:"numpad",accepted:["4"],hint:"Opens down, vertex at (0,4).",steps:["4"],exp:"4."},
    {text:"Which values satisfy x¬≤<9?",opts:["‚àí3<x<3","x>3 or x<‚àí3","x>3","x=¬±3"],ans:0,diff:"medium",hint:"|x|<3.",steps:["‚àí3<x<3"],exp:"‚àí3<x<3."},
    {text:"Complete the square: x¬≤+8x=?",opts:["(x+4)¬≤‚àí16","(x+4)¬≤","(x+8)¬≤‚àí64","(x+4)¬≤+16"],ans:0,diff:"medium",hint:"Add (8/2)¬≤=16.",steps:["(x+4)¬≤‚àí16"],exp:"(x+4)¬≤‚àí16."},
    {text:"Ball height h=‚àí16t¬≤+64t. When hits ground?",opts:["t=4 sec","t=2 sec","t=8 sec","t=64 sec"],ans:0,diff:"hard",hint:"Set h=0. ‚àí16t(t‚àí4)=0.",steps:["t=0 or t=4"],exp:"t=4 seconds."},
    {text:"Expand (x+3)¬≤.",opts:["x¬≤+6x+9","x¬≤+9","x¬≤+3x+9","x¬≤+6x+6"],ans:0,diff:"easy",hint:"(a+b)¬≤=a¬≤+2ab+b¬≤.",steps:["x¬≤+6x+9"],exp:"x¬≤+6x+9."},
    {text:"Axis of symmetry of y=3x¬≤‚àí12x+7?",opts:["x=2","x=‚àí2","x=4","x=7"],ans:0,diff:"medium",hint:"x=‚àíb/2a.",steps:["12/6=2"],exp:"x=2."},
    {text:"How many real roots does x¬≤+4=0 have?",opts:["0","1","2","4"],ans:0,diff:"easy",type:"numpad",accepted:["0"],hint:"Discriminant=‚àí16<0.",steps:["0"],exp:"0."},
    {text:"Solve 3x¬≤‚àí27=0.",opts:["x=¬±3","x=3","x=9","x=¬±9"],ans:0,diff:"easy",hint:"x¬≤=9.",steps:["x=¬±3"],exp:"x=¬±3."},
    {text:"f(0) where f(x)=x¬≤‚àí4x+3?",opts:["3","‚àí3","0","4"],ans:0,diff:"easy",type:"numpad",accepted:["3"],hint:"Substitute x=0.",steps:["3"],exp:"3."},
    {text:"Factor x¬≤‚àí2x‚àí15.",opts:["(x‚àí5)(x+3)","(x+5)(x‚àí3)","(x‚àí5)(x‚àí3)","(x+5)(x+3)"],ans:0,diff:"easy",hint:"Need: √ó=‚àí15, +=‚àí2.",steps:["(x‚àí5)(x+3)"],exp:"(x‚àí5)(x+3)."},
    {text:"Range of y=x¬≤+1?",opts:["y‚â•1","all real","y‚â§1","y>0"],ans:0,diff:"medium",hint:"x¬≤‚â•0 always, so x¬≤+1‚â•1.",steps:["y‚â•1"],exp:"y‚â•1."},
],
  systems:[
    {text:"Solve:\ny = 2x + 1\ny = ‚àíx + 7",opts:["(2,5)","(3,7)","(1,3)","(0,1)"],ans:0,diff:"easy",
      hint:"Set the right sides equal (both = y), then solve for x.",
      steps:["Set equal: 2x+1=‚àíx+7","3x=6 ‚Üí x=2","y=2(2)+1=5","Solution: (2, 5)"],
      exp:"2x+1=‚àíx+7 ‚Üí 3x=6 ‚Üí x=2, y=5."},
    {text:"Solve by elimination:\n2x + y = 10\n3x ‚àí y = 5",opts:["(3,4)","(2,6)","(4,2)","(5,0)"],ans:0,diff:"easy",
      hint:"Add the two equations. The y terms (+y and ‚àíy) cancel out!",
      steps:["Add equations: (2x+y)+(3x‚àíy)=10+5","5x=15 ‚Üí x=3","Sub back: 2(3)+y=10 ‚Üí y=4","Solution: (3, 4)"],
      exp:"Adding eliminates y: 5x=15 ‚Üí x=3, y=4."},
    {text:"How many solutions?\n2x ‚àí 4y = 8\nx ‚àí 2y = 4",opts:["Infinitely many","Exactly one","No solution","Two solutions"],ans:0,diff:"medium",
      hint:"Divide equation 1 by 2. What do you notice about both equations?",
      steps:["Divide eq1 by 2: x‚àí2y=4","This is IDENTICAL to eq2!","Both equations describe the SAME line","Same line ‚Üí infinitely many solutions"],
      exp:"Equations are identical ‚Üí same line ‚Üí infinitely many solutions."},
    {text:"Two numbers sum to 30 and differ by 8. Larger number:",type:"free",ans:"19",accepted:["19"],diff:"easy",
      hint:"Call the numbers x and y. Write: x+y=30 and x‚àíy=8. Then add both equations.",
      steps:["x+y=30 and x‚àíy=8","Add: 2x=38 ‚Üí x=19","Sub: y=30‚àí19=11","Check: 19+11=30 ‚úì and 19‚àí11=8 ‚úì"],
      exp:"x+y=30, x‚àíy=8. Add ‚Üí 2x=38 ‚Üí x=19, y=11."},
    {text:"Solve by substitution:\ny = 3x ‚àí 1\n2x + y = 9",opts:["(2,5)","(1,2)","(3,8)","(4,11)"],ans:0,diff:"easy",
      hint:"Substitute the first equation into the second wherever you see y.",
      steps:["Replace y with (3x‚àí1): 2x+(3x‚àí1)=9","5x‚àí1=9 ‚Üí 5x=10 ‚Üí x=2","y=3(2)‚àí1=5","Solution: (2, 5)"],
      exp:"2x+(3x‚àí1)=9 ‚Üí 5x=10 ‚Üí x=2, y=5."},
    {text:"System: no solution. Lines must be:",opts:["Parallel","Identical","Perpendicular","Intersecting"],ans:0,diff:"medium",
      hint:"When does a system have no solution? When lines never cross.",
      steps:["Two lines in a plane either: intersect (1 solution), are identical (infinite solutions), or never meet","Lines that never meet are PARALLEL","Parallel lines = same slope, different y-intercept"],
      exp:"Parallel lines never intersect ‚Üí no solution."},
    {text:"Solve the nonlinear system:\ny = x¬≤\ny = x + 2",opts:["(2,4) and (‚àí1,1)","(1,1) and (2,4)","(0,0) only","No solution"],ans:0,diff:"hard",
      hint:"Substitute y=x¬≤ into y=x+2 to create a quadratic equation.",
      steps:["x¬≤=x+2","x¬≤‚àíx‚àí2=0","(x‚àí2)(x+1)=0 ‚Üí x=2 or x=‚àí1","At x=2: y=4. At x=‚àí1: y=1"],
      exp:"x¬≤=x+2 ‚Üí (x‚àí2)(x+1)=0 ‚Üí (2,4) and (‚àí1,1)."},
    {text:"Tickets: $3 children, $7 adults. 50 tickets sold, $230 total. Adults:",opts:["20","30","25","15"],ans:0,diff:"medium",
      hint:"Write two equations: total tickets and total money.",
      steps:["c+a=50 and 3c+7a=230","From 1st: c=50‚àía","Sub: 3(50‚àía)+7a=230","150+4a=230 ‚Üí 4a=80 ‚Üí a=20"],
      exp:"c+a=50 and 3c+7a=230. ‚Üí 4a=80 ‚Üí a=20."},
    {text:"Car travels 300 miles: first 150 mi at 60 mph, last 150 mi at 40 mph. Total time?",opts:["6.25 hrs","7.5 hrs","5 hrs","6 hrs"],ans:0,diff:"medium",
      hint:"Time = distance √∑ speed. Calculate each leg separately, then add.",
      steps:["First half: 150√∑60=2.5 hrs","Second half: 150√∑40=3.75 hrs","Total: 2.5+3.75=6.25 hrs"],
      exp:"150/60 + 150/40 = 2.5+3.75 = 6.25 hrs."},
  
    {text:"Solve x+y=10, x‚àíy=4.",opts:["x=7,y=3","x=3,y=7","x=6,y=4","x=5,y=5"],ans:0,diff:"easy",hint:"Add equations.",steps:["2x=14‚Üíx=7,y=3"],exp:"x=7,y=3."},
    {text:"2x+y=11 and y=3. Find x.",opts:["4","5","3","8"],ans:0,diff:"easy",type:"numpad",accepted:["4"],hint:"Substitute y=3.",steps:["2x=8‚Üíx=4"],exp:"4."},
    {text:"Solve 3x‚àíy=7, x+y=5.",opts:["x=3,y=2","x=2,y=3","x=4,y=1","x=1,y=4"],ans:0,diff:"easy",hint:"Add to eliminate y.",steps:["4x=12‚Üíx=3,y=2"],exp:"x=3,y=2."},
    {text:"Two numbers add to 50, one is 4√ó the other. Larger?",opts:["40","10","30","20"],ans:0,diff:"medium",type:"numpad",accepted:["40"],hint:"x+4x=50.",steps:["5x=50‚Üíx=10, 4x=40"],exp:"40."},
    {text:"Solve y=2x, x+y=9.",opts:["x=3,y=6","x=4,y=5","x=2,y=7","x=6,y=3"],ans:0,diff:"easy",hint:"Substitute y=2x.",steps:["3x=9‚Üíx=3,y=6"],exp:"x=3,y=6."},
    {text:"Solve 4x+2y=20, 2x+2y=12.",opts:["x=4,y=2","x=2,y=4","x=4,y=4","x=3,y=3"],ans:0,diff:"medium",hint:"Subtract 2nd from 1st.",steps:["2x=8‚Üíx=4,y=2"],exp:"x=4,y=2."},
    {text:"No solution means lines are:",opts:["Parallel","Perpendicular","Identical","Intersecting"],ans:0,diff:"easy",hint:"Parallel lines never meet.",steps:["Parallel"],exp:"Parallel."},
    {text:"If x+y=12 and xy=35, find x¬≤+y¬≤.",opts:["74","144","70","34"],ans:0,diff:"hard",hint:"(x+y)¬≤=x¬≤+2xy+y¬≤.",steps:["144‚àí70=74"],exp:"74."},
    {text:"3 shirts+2 pants=$85. 1 shirt+4 pants=$95. Shirt cost?",opts:["$15","$20","$25","$10"],ans:0,diff:"hard",hint:"Substitute s=95‚àí4p.",steps:["s=$15"],exp:"$15."},
    {text:"Solve 2x+5=x+11.",opts:["x=6","x=8","x=3","x=16"],ans:0,diff:"easy",type:"numpad",accepted:["6"],hint:"x=11‚àí5.",steps:["x=6"],exp:"6."},
    {text:"Two angles of triangle sum to 110¬∞. Third?",opts:["70¬∞","90¬∞","80¬∞","110¬∞"],ans:0,diff:"easy",type:"numpad",accepted:["70"],hint:"180¬∞‚àí110¬∞.",steps:["70¬∞"],exp:"70¬∞."},
    {text:"Boat: 24mi downstream in 2h, 24mi upstream in 3h. Current speed?",opts:["2 mph","4 mph","6 mph","3 mph"],ans:0,diff:"hard",hint:"b+c=12, b‚àíc=8.",steps:["2b=20‚Üíb=10,c=2"],exp:"2 mph."},
],
  numberTheory:[
    {text:"LCM of 12 and 18?",opts:["36","6","216","72"],ans:0,diff:"easy",
      hint:"LCM = (a√ób)/GCD(a,b). First find GCD using Euclidean algorithm.",
      steps:["GCD(12,18): 18=12√ó1+6 ‚Üí GCD(12,6) ‚Üí 12=6√ó2+0 ‚Üí GCD=6","LCM=12√ó18/6=216/6=36"],
      exp:"GCD(12,18)=6. LCM=12√ó18/6=36."},
    {text:"Prime numbers between 1 and 30:",opts:["10","8","11","9"],ans:0,diff:"easy",
      hint:"List them systematically. Remember: 1 is NOT prime.",
      steps:["2,3,5,7 (under 10) = 4 primes","11,13,17,19 (10s) = 4 primes","23,29 (20s) = 2 primes","Total: 4+4+2=10 primes"],
      exp:"2,3,5,7,11,13,17,19,23,29 ‚Üí 10 primes."},
    {text:"3‚Åµ √ó 3‚Åª¬≤ = ?",opts:["27","81","9","243"],ans:0,diff:"easy",
      hint:"When multiplying same base: ADD the exponents. a·µê √ó a‚Åø = a·µê‚Å∫‚Åø",
      steps:["Same base (3): add exponents","3‚Åµ √ó 3‚Åª¬≤ = 3^(5+(‚àí2)) = 3^3","3¬≥=3√ó3√ó3=27"],
      exp:"3^(5‚àí2)=3¬≥=27."},
    {text:"GCD(48, 60)?",opts:["12","6","24","4"],ans:0,diff:"medium",
      hint:"Euclidean algorithm: GCD(a,b) = GCD(b, a mod b).",
      steps:["GCD(60,48): 60=48√ó1+12","GCD(48,12): 48=12√ó4+0","Remainder 0 ‚Üí GCD=12"],
      exp:"Euclidean algorithm: GCD(48,60)=12."},
    {text:"2^100 mod 3?",opts:["1","0","2","Cannot determine"],ans:0,diff:"hard",
      hint:"Find the pattern: 2^1 mod 3, 2^2 mod 3, 2^3 mod 3... It cycles with period 2!",
      steps:["2^1 mod 3 = 2","2^2 mod 3 = 4 mod 3 = 1","2^3 mod 3 = 8 mod 3 = 2 (pattern repeats!)","Period = 2. 100 is even ‚Üí same as 2^2 mod 3 = 1"],
      exp:"Pattern: 2,1,2,1... Period 2. 100 is even ‚Üí 1."},
    {text:"Smallest positive integer divisible by 2, 3, 5, and 7?",opts:["210","105","420","70"],ans:0,diff:"medium",
      hint:"Since 2, 3, 5, 7 are all prime, LCM = just multiply them all.",
      steps:["2,3,5,7 are all prime ‚Üí no common factors","LCM = 2√ó3√ó5√ó7","= 6√ó5√ó7 = 30√ó7 = 210"],
      exp:"LCM of primes = product = 210."},
    {text:"Trailing zeros in 25!?",opts:["6","5","7","4"],ans:0,diff:"hard",
      hint:"Trailing zeros come from factors of 10 = 2√ó5. Since 2s outnumber 5s, count factors of 5.",
      steps:["Count multiples of 5: ‚åä25/5‚åã=5","Count multiples of 25: ‚åä25/25‚åã=1","Total = 5+1 = 6 trailing zeros"],
      exp:"‚åä25/5‚åã+‚åä25/25‚åã=5+1=6."},
    {text:"Units digit of 7‚Åµ¬≥?",opts:["7","1","3","9"],ans:0,diff:"hard",
      hint:"Powers of 7 have a repeating units digit pattern with period 4: 7,9,3,1,7,9,3,1...",
      steps:["7¬π‚Üí7, 7¬≤‚Üí9, 7¬≥‚Üí3, 7‚Å¥‚Üí1, 7‚Åµ‚Üí7 (repeats!)","Pattern period = 4","53 mod 4 = 1 (since 53=13√ó4+1)","Position 1 in cycle ‚Üí units digit = 7"],
      exp:"Cycle period 4. 53 mod 4=1 ‚Üí units digit=7."},
    {text:"How many factors does 360 have?",opts:["24","18","12","36"],ans:0,diff:"hard",
      hint:"Prime factorize first! If n=p^a √ó q^b √ó r^c, then # of factors = (a+1)(b+1)(c+1).",
      steps:["360=8√ó45=8√ó9√ó5=2¬≥√ó3¬≤√ó5¬π","# factors=(3+1)(2+1)(1+1)","=4√ó3√ó2=24"],
      exp:"360=2¬≥√ó3¬≤√ó5. Factors=(3+1)(2+1)(1+1)=24."},
    {text:"If a‚â°2 (mod 5) and b‚â°4 (mod 5), find (a+b) mod 5.",opts:["1","6","0","3"],ans:0,diff:"hard",
      hint:"Just add the residues and reduce mod 5.",
      steps:["(a+b) mod 5 = (a mod 5 + b mod 5) mod 5","=(2+4) mod 5","=6 mod 5 = 1"],
      exp:"(2+4) mod 5 = 6 mod 5 = 1."},
  
    {text:"GCD(48,36)?",opts:["12","6","24","18"],ans:0,diff:"easy",type:"numpad",accepted:["12"],hint:"Largest shared factor.",steps:["12"],exp:"12."},
    {text:"Is 91 prime?",opts:["No","Yes","Maybe","Depends"],ans:0,diff:"medium",hint:"91=7√ó13.",steps:["Not prime"],exp:"No, 91=7√ó13."},
    {text:"Prime factorization of 60?",opts:["2¬≤√ó3√ó5","2√ó3√ó5√ó2","4√ó15","2¬≥√ó3√ó5"],ans:0,diff:"medium",hint:"60√∑2=30, 30√∑2=15, 15√∑3=5.",steps:["2¬≤√ó3√ó5"],exp:"2¬≤√ó3√ó5."},
    {text:"Number of factors of 36?",opts:["9","6","8","12"],ans:0,diff:"medium",type:"numpad",accepted:["9"],hint:"36=2¬≤√ó3¬≤. (2+1)(2+1).",steps:["9"],exp:"9."},
    {text:"17 mod 5?",opts:["2","3","1","4"],ans:0,diff:"easy",type:"numpad",accepted:["2"],hint:"17=5√ó3+2.",steps:["2"],exp:"2."},
    {text:"Smallest prime > 20?",opts:["23","21","22","25"],ans:0,diff:"easy",type:"numpad",accepted:["23"],hint:"21=3√ó7, 22=2√ó11, 23 is prime.",steps:["23"],exp:"23."},
    {text:"LCM(8,12)?",opts:["24","96","48","12"],ans:0,diff:"easy",type:"numpad",accepted:["24"],hint:"LCM=8√ó12/GCD=96/4.",steps:["24"],exp:"24."},
    {text:"2^10?",opts:["1024","512","2048","256"],ans:0,diff:"medium",type:"numpad",accepted:["1024"],hint:"2^10 is a famous CS number.",steps:["1024"],exp:"1024."},
    {text:"n‚â°3 (mod 7). Which could be n?",opts:["24","21","20","28"],ans:0,diff:"medium",hint:"n=7k+3.",steps:["24=7√ó3+3"],exp:"24."},
    {text:"How many primes between 10 and 30?",opts:["6","5","4","7"],ans:0,diff:"medium",type:"numpad",accepted:["6"],hint:"11,13,17,19,23,29.",steps:["6"],exp:"6."},
    {text:"Units digit of 7^4?",opts:["1","7","9","3"],ans:0,diff:"medium",type:"numpad",accepted:["1"],hint:"Cycle: 7,9,3,1.",steps:["7^4 ends in 1"],exp:"1."},
    {text:"n even, m odd. n+m is always:",opts:["Odd","Even","Both","Neither"],ans:0,diff:"medium",hint:"even+odd=odd.",steps:["Odd"],exp:"Odd."},
    {text:"Remainder when 100√∑7?",opts:["2","1","3","6"],ans:0,diff:"easy",type:"numpad",accepted:["2"],hint:"7√ó14=98.",steps:["2"],exp:"2."},
    {text:"Divisible by both 3 and 4?",opts:["24","18","16","21"],ans:0,diff:"easy",hint:"LCM(3,4)=12.",steps:["24√∑12=2"],exp:"24."},
    {text:"72 as prime factors?",opts:["2¬≥√ó3¬≤","2√ó36","8√ó9","2¬≥√ó9"],ans:0,diff:"medium",hint:"72=8√ó9.",steps:["2¬≥√ó3¬≤"],exp:"2¬≥√ó3¬≤."},
    {text:"(‚àí3)^4?",opts:["81","‚àí81","12","‚àí12"],ans:0,diff:"easy",type:"numpad",accepted:["81"],hint:"Even exponent ‚Üí positive.",steps:["81"],exp:"81."},
    {text:"Remainder: 100√∑7?",opts:["2","1","3","0"],ans:0,diff:"easy",type:"numpad",accepted:["2"],hint:"Same as above.",steps:["2"],exp:"2."},
    {text:"5^3 mod 4?",opts:["1","0","3","2"],ans:0,diff:"medium",type:"numpad",accepted:["1"],hint:"5‚â°1 mod 4.",steps:["1^3=1"],exp:"1."},
    {text:"Sum of 3 consecutive integers is 63. Middle one?",opts:["21","20","22","19"],ans:0,diff:"medium",type:"numpad",accepted:["21"],hint:"3n=63.",steps:["n=21"],exp:"21."},
    {text:"How many zeros does 20! end with?",opts:["4","5","3","20"],ans:0,diff:"hard",type:"numpad",accepted:["4"],hint:"‚åä20/5‚åã+‚åä20/25‚åã.",steps:["4+0=4"],exp:"4."},
],
  geometry:[
    {text:"Rectangle: length 12, width 5. Diagonal?",opts:["13","17","‚àö119","7"],ans:0,diff:"easy",
      hint:"The diagonal is the hypotenuse! Use Pythagorean theorem.",
      steps:["d¬≤=length¬≤+width¬≤=12¬≤+5¬≤","=144+25=169","d=‚àö169=13"],
      exp:"d¬≤=144+25=169 ‚Üí d=13."},
    {text:"Circle with circumference 10œÄ. Area?",opts:["25œÄ","10œÄ","100œÄ","5œÄ"],ans:0,diff:"medium",
      hint:"First find r from C=2œÄr, then use A=œÄr¬≤.",
      steps:["C=2œÄr=10œÄ ‚Üí r=5","A=œÄr¬≤=œÄ(5)¬≤=25œÄ"],
      exp:"r=5, Area=25œÄ."},
    {text:"Triangle angles 45¬∞ and 75¬∞. Third angle?",opts:["60¬∞","80¬∞","90¬∞","70¬∞"],ans:0,diff:"easy",
      hint:"Sum of angles in ANY triangle = 180¬∞.",
      steps:["Sum = 180¬∞","Third = 180‚àí45‚àí75=60¬∞"],
      exp:"180‚àí45‚àí75=60¬∞."},
    {text:"Right triangle legs 5 and 12. Hypotenuse?",opts:["13","15","‚àö119","17"],ans:0,diff:"easy",
      hint:"a¬≤+b¬≤=c¬≤. Recognize the 5-12-13 Pythagorean triple!",
      steps:["5¬≤+12¬≤=c¬≤","25+144=169","c=‚àö169=13","Pythagorean triple: 5-12-13"],
      exp:"5¬≤+12¬≤=169 ‚Üí c=13. (5-12-13 triple)"},
    {text:"Equilateral triangle with side 4. Area?",opts:["4‚àö3","8‚àö3","2‚àö3","16‚àö3"],ans:0,diff:"medium",
      hint:"Formula: A=(‚àö3/4)s¬≤. Equilateral means all sides equal.",
      steps:["A=(‚àö3/4)s¬≤=(‚àö3/4)(4)¬≤","=(‚àö3/4)(16)=4‚àö3"],
      exp:"A=(‚àö3/4)(16)=4‚àö3."},
    {text:"Similar triangles: areas 9 and 36. Perimeter ratio?",opts:["1:2","1:4","2:1","3:6"],ans:0,diff:"hard",
      hint:"Area scales as (side ratio)¬≤. So find the side ratio first, then perimeter ratio = side ratio.",
      steps:["Area ratio = 9:36 = 1:4","Area ratio = (side ratio)¬≤","So side ratio = ‚àö(1/4)=1/2","Perimeters scale the same as sides ‚Üí 1:2"],
      exp:"Area ratio 1:4 ‚Üí side ratio 1:2 ‚Üí perimeter ratio 1:2."},
    {text:"Circle inscribed in square with side 6. Circle area?",opts:["9œÄ","6œÄ","36œÄ","3œÄ"],ans:0,diff:"medium",
      hint:"The circle just touches all four sides. So diameter = side of square.",
      steps:["Diameter = side = 6 ‚Üí radius = 3","A=œÄr¬≤=œÄ(3)¬≤=9œÄ"],
      exp:"r=3 (diameter=side), A=9œÄ."},
    {text:"Cylinder: radius 3, height 5. Volume?",opts:["45œÄ","15œÄ","9œÄ","30œÄ"],ans:0,diff:"medium",
      hint:"V=œÄr¬≤h (pi times radius squared times height).",
      steps:["V=œÄr¬≤h=œÄ(3¬≤)(5)","=œÄ(9)(5)=45œÄ"],
      exp:"V=œÄ(9)(5)=45œÄ."},
    {text:"30-60-90 triangle with hypotenuse 10. Shorter leg?",opts:["5","5‚àö3","10/‚àö3","10‚àö3"],ans:0,diff:"medium",
      hint:"30-60-90 sides ratio: x : x‚àö3 : 2x. Hypotenuse = 2x.",
      steps:["Hypotenuse = 2x = 10 ‚Üí x=5","Shorter leg (opposite 30¬∞) = x = 5","Longer leg (opposite 60¬∞) = 5‚àö3"],
      exp:"2x=10 ‚Üí x=5. Shorter leg=5."},
    {text:"Interior angle sum of a regular octagon?",opts:["1080¬∞","720¬∞","1440¬∞","900¬∞"],ans:0,diff:"medium",
      hint:"Formula: (n‚àí2)√ó180¬∞ where n = number of sides.",
      steps:["n=8 sides","Sum=(8‚àí2)√ó180=6√ó180=1080¬∞"],
      exp:"(8‚àí2)√ó180=1080¬∞."},
    {text:"Sector of circle (radius 6, central angle 60¬∞). Arc length?",opts:["2œÄ","œÄ","6œÄ","3œÄ"],ans:0,diff:"hard",
      hint:"Arc length = (central angle / 360¬∞) √ó circumference.",
      steps:["Full circumference = 2œÄ(6) = 12œÄ","Fraction of circle = 60/360 = 1/6","Arc length = (1/6)(12œÄ) = 2œÄ"],
      exp:"(60/360)√ó2œÄ(6) = 2œÄ."},
  
    {text:"Area of circle radius 5? (œÄ‚âà3.14)",opts:["78.5","31.4","25","15.7"],ans:0,diff:"easy",hint:"œÄr¬≤.",steps:["3.14√ó25=78.5"],exp:"78.5."},
    {text:"Circumference of circle diameter 10? (œÄ‚âà3.14)",opts:["31.4","62.8","15.7","78.5"],ans:0,diff:"easy",hint:"œÄd.",steps:["31.4"],exp:"31.4."},
    {text:"Right triangle legs 5 and 12. Hypotenuse?",opts:["13","17","7","15"],ans:0,diff:"easy",type:"numpad",accepted:["13"],hint:"5-12-13 triple.",steps:["13"],exp:"13."},
    {text:"Volume of cube side 4?",opts:["64","48","16","96"],ans:0,diff:"easy",type:"numpad",accepted:["64"],hint:"s¬≥.",steps:["64"],exp:"64."},
    {text:"Triangle angles 45¬∞ and 65¬∞. Third?",opts:["70¬∞","80¬∞","90¬∞","75¬∞"],ans:0,diff:"easy",type:"numpad",accepted:["70"],hint:"180‚àí45‚àí65.",steps:["70¬∞"],exp:"70¬∞."},
    {text:"Area of trapezoid, parallel sides 6 and 10, height 4?",opts:["32","24","40","16"],ans:0,diff:"medium",type:"numpad",accepted:["32"],hint:"¬Ω(b‚ÇÅ+b‚ÇÇ)h.",steps:["¬Ω√ó16√ó4=32"],exp:"32."},
    {text:"Supplement of 130¬∞?",opts:["50¬∞","40¬∞","60¬∞","130¬∞"],ans:0,diff:"easy",type:"numpad",accepted:["50"],hint:"180‚àí130.",steps:["50¬∞"],exp:"50¬∞."},
    {text:"Sum of interior angles of hexagon?",opts:["720¬∞","540¬∞","900¬∞","360¬∞"],ans:0,diff:"medium",type:"numpad",accepted:["720"],hint:"(n‚àí2)√ó180, n=6.",steps:["720¬∞"],exp:"720¬∞."},
    {text:"Volume of cylinder radius 3, height 10? (œÄ‚âà3.14)",opts:["282.6","94.2","188.4","30œÄ"],ans:0,diff:"medium",hint:"œÄr¬≤h.",steps:["3.14√ó9√ó10=282.6"],exp:"282.6."},
    {text:"Alternate interior angles are:",opts:["Equal","Supplementary","Complementary","Perpendicular"],ans:0,diff:"medium",hint:"Parallel lines cut by transversal.",steps:["Equal"],exp:"Equal."},
    {text:"Diagonal of rectangle 3 by 4?",opts:["5","7","‚àö7","25"],ans:0,diff:"easy",type:"numpad",accepted:["5"],hint:"3-4-5 triangle.",steps:["5"],exp:"5."},
    {text:"Triangle angles in ratio 1:2:3. Largest?",opts:["90¬∞","60¬∞","120¬∞","45¬∞"],ans:0,diff:"medium",type:"numpad",accepted:["90"],hint:"6x=180.",steps:["3x=90¬∞"],exp:"90¬∞."},
    {text:"Exterior angle of regular pentagon?",opts:["72¬∞","108¬∞","60¬∞","90¬∞"],ans:0,diff:"medium",type:"numpad",accepted:["72"],hint:"360√∑5.",steps:["72¬∞"],exp:"72¬∞."},
    {text:"Surface area of cube side 3?",opts:["54","27","36","18"],ans:0,diff:"easy",type:"numpad",accepted:["54"],hint:"6s¬≤.",steps:["54"],exp:"54."},
    {text:"In right triangle, sin A=3/5. cos A?",opts:["4/5","3/4","5/3","1/5"],ans:0,diff:"hard",hint:"3-4-5 triangle.",steps:["4/5"],exp:"4/5."},
    {text:"Each interior angle of regular octagon?",opts:["135¬∞","120¬∞","150¬∞","90¬∞"],ans:0,diff:"medium",type:"numpad",accepted:["135"],hint:"(8‚àí2)√ó180√∑8.",steps:["135¬∞"],exp:"135¬∞."},
    {text:"Similar triangles scale 3:1. Smaller area 4. Larger?",opts:["36","12","9","16"],ans:0,diff:"hard",type:"numpad",accepted:["36"],hint:"Area scales as square.",steps:["4√ó9=36"],exp:"36."},
    {text:"Slant height of cone, radius 3, height 4?",opts:["5","7","‚àö7","4"],ans:0,diff:"medium",type:"numpad",accepted:["5"],hint:"l¬≤=r¬≤+h¬≤.",steps:["‚àö25=5"],exp:"5."},
    {text:"Complement of 35¬∞?",opts:["55¬∞","45¬∞","65¬∞","145¬∞"],ans:0,diff:"easy",type:"numpad",accepted:["55"],hint:"90‚àí35.",steps:["55¬∞"],exp:"55¬∞."},
    {text:"Arc length, 60¬∞ central angle, radius 6? (œÄ‚âà3.14)",opts:["6.28","18.84","3.14","12.56"],ans:0,diff:"hard",hint:"(60/360)√ó2œÄr.",steps:["(1/6)√ó37.68=6.28"],exp:"6.28."},
],
  probability:[
    {text:"Probability of rolling sum 7 with two dice?",opts:["1/6","7/36","1/7","6/25"],ans:0,diff:"easy",
      hint:"List all pairs that sum to 7. Total outcomes = 6√ó6=36.",
      steps:["Pairs summing to 7: (1,6),(2,5),(3,4),(4,3),(5,2),(6,1) = 6 pairs","Total outcomes: 6√ó6=36","P=6/36=1/6"],
      exp:"6 favorable / 36 total = 1/6."},
    {text:"Arrangements of letters in MATH?",opts:["24","16","12","48"],ans:0,diff:"easy",
      hint:"All 4 letters are distinct. Use 4! (4 factorial).",
      steps:["4 distinct letters: 4 choices for 1st, 3 for 2nd, 2 for 3rd, 1 for 4th","4!=4√ó3√ó2√ó1=24"],
      exp:"4!=24."},
    {text:"Bag: 3 red, 4 blue, 5 green. P(blue)?",opts:["1/3","4/12","1/4","5/12"],ans:0,diff:"easy",
      hint:"P = (favorable outcomes) / (total outcomes). Total = 3+4+5.",
      steps:["Total marbles = 3+4+5=12","Favorable (blue) = 4","P = 4/12 = 1/3"],
      exp:"4/12=1/3."},
    {text:"Choose 3 from 7 people (order doesn't matter)?",opts:["35","210","21","42"],ans:0,diff:"medium",
      hint:"Use combinations: C(n,r) = n!/[r!(n‚àír)!]. Order doesn't matter = combination.",
      steps:["C(7,3) = 7!/(3!√ó4!)","= (7√ó6√ó5)/(3√ó2√ó1)","= 210/6 = 35"],
      exp:"C(7,3)=35."},
    {text:"Two cards drawn without replacement. P(both aces)?",opts:["1/221","1/169","4/663","1/52"],ans:0,diff:"hard",
      hint:"P(1st ace) √ó P(2nd ace | 1st was ace). Multiply conditional probabilities.",
      steps:["P(1st ace) = 4/52 = 1/13","P(2nd ace | 1st ace removed) = 3/51","P(both) = (4/52)√ó(3/51) = 12/2652 = 1/221"],
      exp:"(4/52)√ó(3/51)=1/221."},
    {text:"Flip coin 3 times. P(exactly 2 heads)?",opts:["3/8","1/2","1/4","3/4"],ans:0,diff:"medium",
      hint:"Use binomial probability: C(3,2)√ó(¬Ω)¬≤√ó(¬Ω)¬π.",
      steps:["Need exactly 2 heads out of 3 flips","C(3,2)=3 ways to choose which 2 are heads","Each outcome has prob (¬Ω)¬≥=1/8","P=3√ó(1/8)=3/8"],
      exp:"C(3,2)√ó(¬Ω)¬≥=3/8."},
    {text:"3-digit numbers from {1,2,3,4,5} with no repetition?",opts:["60","120","24","100"],ans:0,diff:"medium",
      hint:"This is a permutation. How many choices for each digit position?",
      steps:["1st digit: 5 choices","2nd digit: 4 remaining choices","3rd digit: 3 remaining choices","Total: 5√ó4√ó3=60"],
      exp:"P(5,3)=5√ó4√ó3=60."},
    {text:"P(A)=0.3, P(B)=0.5, A and B independent. P(A and B)?",opts:["0.15","0.8","0.35","0.2"],ans:0,diff:"medium",
      hint:"For INDEPENDENT events: P(A‚à©B) = P(A)√óP(B).",
      steps:["Independent means one doesn't affect the other","P(A and B) = P(A)√óP(B)","=0.3√ó0.5=0.15"],
      exp:"Independent: P(A‚à©B)=0.3√ó0.5=0.15."},
    {text:"Seat 5 people in a circle (rotations same). How many ways?",opts:["24","120","12","60"],ans:0,diff:"hard",
      hint:"Circular permutations: fix one person, arrange the rest. Formula: (n‚àí1)!",
      steps:["Fix 1 person to eliminate equivalent rotations","Arrange remaining 4: 4!=24","Circular permutations = (5‚àí1)!=4!=24"],
      exp:"(n‚àí1)!=(5‚àí1)!=24."},
  
    {text:"Bag: 5 red, 3 blue, 2 green. P(not red)?",opts:["1/2","1/10","2/5","3/5"],ans:0,diff:"easy",hint:"1‚àíP(red)=1‚àí1/2.",steps:["1/2"],exp:"1/2."},
    {text:"Roll die twice. P(both even)?",opts:["1/4","1/2","1/3","1/6"],ans:0,diff:"medium",hint:"(1/2)√ó(1/2).",steps:["1/4"],exp:"1/4."},
    {text:"4 books arranged on shelf. How many ways?",opts:["24","16","12","4"],ans:0,diff:"easy",type:"numpad",accepted:["24"],hint:"4!",steps:["24"],exp:"24."},
    {text:"Choose 2 from 7 students?",opts:["21","42","14","35"],ans:0,diff:"medium",type:"numpad",accepted:["21"],hint:"C(7,2).",steps:["21"],exp:"21."},
    {text:"Flip coin 3 times. P(exactly 2 heads)?",opts:["3/8","1/2","1/4","1/8"],ans:0,diff:"medium",hint:"HHT,HTH,THH ‚Üí 3 of 8.",steps:["3/8"],exp:"3/8."},
    {text:"P(A)=0.4, P(B)=0.5, independent. P(A and B)?",opts:["0.2","0.9","0.1","0.45"],ans:0,diff:"medium",hint:"Multiply.",steps:["0.2"],exp:"0.2."},
    {text:"P(drawing a king from deck)?",opts:["1/13","4/52","1/52","4/13"],ans:0,diff:"easy",hint:"4/52.",steps:["1/13"],exp:"1/13."},
    {text:"P(A)=0.6, P(B)=0.5, P(A‚à©B)=0.3. P(A or B)?",opts:["0.8","1.1","0.3","0.9"],ans:0,diff:"medium",hint:"Addition rule.",steps:["0.6+0.5‚àí0.3=0.8"],exp:"0.8."},
    {text:"3-digit password, digits 0-9. How many unique?",opts:["1000","999","900","729"],ans:0,diff:"medium",type:"numpad",accepted:["1000"],hint:"10¬≥.",steps:["1000"],exp:"1000."},
    {text:"15 boys, 10 girls. P(boy selected)?",opts:["3/5","2/3","1/2","3/4"],ans:0,diff:"easy",hint:"15/25.",steps:["3/5"],exp:"3/5."},
    {text:"President and VP from 10 people. How many ways?",opts:["90","100","10","45"],ans:0,diff:"medium",type:"numpad",accepted:["90"],hint:"10√ó9.",steps:["90"],exp:"90."},
    {text:"Expected value: win $10 P=0.3, lose $5 P=0.7.",opts:["‚àí$0.50","$3","$10","‚àí$2"],ans:0,diff:"hard",hint:"10(0.3)+(‚àí5)(0.7).",steps:["3‚àí3.5=‚àí0.5"],exp:"‚àí$0.50."},
    {text:"P(A|B) means:",opts:["P(A given B)","P(A and B)","P(A)√óP(B)","P(B given A)"],ans:0,diff:"medium",hint:"Conditional probability.",steps:["P(A given B)"],exp:"P(A given B)."},
    {text:"P(rolling >4 on die)?",opts:["1/3","1/2","2/3","1/6"],ans:0,diff:"easy",hint:"5 and 6 ‚Üí 2/6.",steps:["1/3"],exp:"1/3."},
    {text:"4-letter arrangements of ABCD?",opts:["24","16","12","4"],ans:0,diff:"easy",type:"numpad",accepted:["24"],hint:"4!",steps:["24"],exp:"24."},
],
  algebra:[
    {text:"f(x)=3x‚àí2. What is f(f(4))?",opts:["28","10","30","34"],ans:0,diff:"easy",
      hint:"Compute from inside out: first f(4), then apply f to that result.",
      steps:["f(4) = 3(4)‚àí2 = 12‚àí2 = 10","f(f(4)) = f(10) = 3(10)‚àí2 = 28"],
      exp:"f(4)=10, f(10)=28."},
    {text:"Slope through (1,2) and (4,8)?",opts:["2","3","6","1/2"],ans:0,diff:"easy",
      hint:"Slope = rise/run = (y‚ÇÇ‚àíy‚ÇÅ)/(x‚ÇÇ‚àíx‚ÇÅ).",
      steps:["m = (8‚àí2)/(4‚àí1)","= 6/3 = 2"],
      exp:"m=(8‚àí2)/(4‚àí1)=6/3=2."},
    {text:"Slope-intercept form of 2y ‚àí 4x = 10?",opts:["y=2x+5","y=4x+10","y=2x+10","y=‚àí2x+5"],ans:0,diff:"easy",
      hint:"Solve for y: isolate y on the left side.",
      steps:["2y=4x+10","Divide both sides by 2: y=2x+5"],
      exp:"2y=4x+10 ‚Üí y=2x+5."},
    {text:"10th term of 3, 7, 11, 15, ...?",opts:["39","37","43","40"],ans:0,diff:"medium",
      hint:"Arithmetic sequence: a‚Çô=a‚ÇÅ+(n‚àí1)d. Find d (common difference).",
      steps:["d=7‚àí3=4 (common difference)","a‚Çô=a‚ÇÅ+(n‚àí1)d","a‚ÇÅ‚ÇÄ=3+(10‚àí1)(4)=3+36=39"],
      exp:"a‚ÇÅ‚ÇÄ=3+9√ó4=39."},
    {text:"Sum of first 8 terms of 2, 6, 18, 54, ...?",opts:["6560","3280","6558","13120"],ans:0,diff:"hard",
      hint:"Geometric series (r=3). Sum = a‚ÇÅ(r‚Åø‚àí1)/(r‚àí1).",
      steps:["r=6/2=3 (geometric with ratio 3)","S‚Çô=a‚ÇÅ(r‚Åø‚àí1)/(r‚àí1)","S‚Çà=2(3‚Å∏‚àí1)/(3‚àí1)","3‚Å∏=6561","S‚Çà=2(6560)/2=6560"],
      exp:"S‚Çà=2(3‚Å∏‚àí1)/2=6560."},
    {text:"g(x)=x¬≤‚àí4, h(x)=2x+1. Find g(h(1)).",opts:["5","‚àí1","8","3"],ans:0,diff:"medium",
      hint:"Compute h(1) first, then substitute that value into g(x).",
      steps:["h(1)=2(1)+1=3","g(h(1))=g(3)=3¬≤‚àí4=9‚àí4=5"],
      exp:"h(1)=3, g(3)=5."},
    {text:"Solve: |2x ‚àí 3| = 7",opts:["x=5 or x=‚àí2","x=5 or x=2","x=‚àí5 or x=2","x=5 only"],ans:0,diff:"medium",
      hint:"|expression|=k means: expression=k OR expression=‚àík. Two cases!",
      steps:["Case 1: 2x‚àí3=7 ‚Üí 2x=10 ‚Üí x=5","Case 2: 2x‚àí3=‚àí7 ‚Üí 2x=‚àí4 ‚Üí x=‚àí2","Answer: x=5 or x=‚àí2"],
      exp:"Two cases: 2x‚àí3=¬±7 ‚Üí x=5 or x=‚àí2."},
    {text:"Inverse of f(x)=2x+6?",opts:["f‚Åª¬π(x)=(x‚àí6)/2","f‚Åª¬π(x)=2x‚àí6","f‚Åª¬π(x)=(x+6)/2","f‚Åª¬π(x)=x/2+6"],ans:0,diff:"medium",
      hint:"To find inverse: replace f(x) with y, SWAP x and y, then solve for y.",
      steps:["y=2x+6","Swap x and y: x=2y+6","Solve for y: x‚àí6=2y ‚Üí y=(x‚àí6)/2","f‚Åª¬π(x)=(x‚àí6)/2"],
      exp:"Swap x,y: x=2y+6 ‚Üí y=(x‚àí6)/2."},
    {text:"If 2^x = 32, find x.",opts:["5","4","6","16"],ans:0,diff:"easy",
      hint:"Express 32 as a power of 2. What power of 2 equals 32?",
      steps:["2¬π=2, 2¬≤=4, 2¬≥=8, 2‚Å¥=16, 2‚Åµ=32","So 2^x=2‚Åµ ‚Üí x=5"],
      exp:"32=2‚Åµ ‚Üí x=5."},
    {text:"Simplify: (x¬≤‚àí9)/(x+3) for x‚â†‚àí3",opts:["x‚àí3","x+3","x¬≤‚àí3","x+3 again"],ans:0,diff:"medium",
      hint:"Factor the numerator first: x¬≤‚àí9 is a DIFFERENCE OF SQUARES.",
      steps:["x¬≤‚àí9=(x+3)(x‚àí3)","(x+3)(x‚àí3)/(x+3)","Cancel (x+3): result is x‚àí3"],
      exp:"x¬≤‚àí9=(x+3)(x‚àí3). Cancel (x+3) ‚Üí x‚àí3."},
  
    {text:"Simplify 3(x+4)‚àí2x.",opts:["x+12","x+7","5x+12","3x+12"],ans:0,diff:"easy",hint:"Distribute then combine.",steps:["3x+12‚àí2x=x+12"],exp:"x+12."},
    {text:"Solve 2(3x‚àí1)=4x+6.",opts:["x=4","x=2","x=3","x=8"],ans:0,diff:"easy",type:"numpad",accepted:["4"],hint:"Distribute left side.",steps:["6x‚àí2=4x+6‚Üíx=4"],exp:"4."},
    {text:"Slope of y=‚àí3x+7?",opts:["‚àí3","7","3","‚àí7"],ans:0,diff:"easy",hint:"y=mx+b, m is slope.",steps:["‚àí3"],exp:"‚àí3."},
    {text:"y-intercept of 2x+3y=12?",opts:["4","6","3","12"],ans:0,diff:"easy",type:"numpad",accepted:["4"],hint:"Set x=0.",steps:["y=4"],exp:"4."},
    {text:"Simplify (2x¬≥)(3x¬≤).",opts:["6x‚Åµ","5x‚Åµ","6x‚Å∂","6x^5"],ans:0,diff:"easy",hint:"Multiply coefficients, add exponents.",steps:["6x‚Åµ"],exp:"6x‚Åµ."},
    {text:"Solve |x‚àí3|=5.",opts:["x=8 or x=‚àí2","x=8 or x=2","x=8","x=‚àí2"],ans:0,diff:"medium",hint:"Two cases: x‚àí3=5 or x‚àí3=‚àí5.",steps:["x=8 or x=‚àí2"],exp:"x=8 or x=‚àí2."},
    {text:"Perpendicular slope to y=2x+1?",opts:["‚àí1/2","2","‚àí2","1/2"],ans:0,diff:"medium",hint:"Negative reciprocal.",steps:["‚àí1/2"],exp:"‚àí1/2."},
    {text:"Factor 3x¬≤‚àí12.",opts:["3(x+2)(x‚àí2)","3(x¬≤‚àí4)","3(x+4)(x‚àí1)","(3x+6)(x‚àí2)"],ans:0,diff:"medium",hint:"Factor 3, then diff of squares.",steps:["3(x+2)(x‚àí2)"],exp:"3(x+2)(x‚àí2)."},
    {text:"f(g(x)) where f(x)=x+2, g(x)=3x, at x=4?",opts:["14","18","10","24"],ans:0,diff:"medium",type:"numpad",accepted:["14"],hint:"g(4)=12, f(12)=14.",steps:["14"],exp:"14."},
    {text:"NOT a function: which one?",opts:["x=y¬≤","y=x¬≤","y=2x","y=|x|"],ans:0,diff:"medium",hint:"Fails vertical line test.",steps:["x=y¬≤: two y-values for x=4"],exp:"x=y¬≤."},
    {text:"Simplify (x+3)/(x¬≤‚àí9).",opts:["1/(x‚àí3)","1/(x+3)","x+3","(x+3)¬≤"],ans:0,diff:"medium",hint:"x¬≤‚àí9=(x+3)(x‚àí3).",steps:["1/(x‚àí3)"],exp:"1/(x‚àí3)."},
    {text:"Solve 3x/4=9.",opts:["x=12","x=9","x=4","x=3"],ans:0,diff:"easy",type:"numpad",accepted:["12"],hint:"Multiply by 4/3.",steps:["x=12"],exp:"12."},
    {text:"Domain of f(x)=1/(x‚àí2)?",opts:["All x except x=2","All x","x>2","x‚â•2"],ans:0,diff:"medium",hint:"Denominator ‚â† 0.",steps:["x‚â†2"],exp:"All x except 2."},
    {text:"Solve 2x‚àí3>7.",opts:["x>5","x<5","x>2","x<2"],ans:0,diff:"easy",hint:"2x>10.",steps:["x>5"],exp:"x>5."},
    {text:"Inverse of f(x)=2x+6?",opts:["(x‚àí6)/2","2x‚àí6","(x+6)/2","x/2+3"],ans:0,diff:"medium",hint:"Swap x and y, solve for y.",steps:["(x‚àí6)/2"],exp:"f‚Åª¬π(x)=(x‚àí6)/2."},
    {text:"Simplify 2^(‚àí3).",opts:["1/8","‚àí8","8","‚àí1/8"],ans:0,diff:"easy",hint:"Negative exponent = reciprocal.",steps:["1/8"],exp:"1/8."},
    {text:"g(f(3)) where f(x)=x¬≤, g(x)=x+1?",opts:["10","9","16","7"],ans:0,diff:"medium",type:"numpad",accepted:["10"],hint:"f(3)=9, g(9)=10.",steps:["10"],exp:"10."},
    {text:"log‚ÇÅ‚ÇÄ(x)=3. x=?",opts:["1000","30","10","300"],ans:0,diff:"hard",type:"numpad",accepted:["1000"],hint:"10¬≥=x.",steps:["1000"],exp:"1000."},
    {text:"Distance between (1,2) and (4,6)?",opts:["5","7","‚àö7","25"],ans:0,diff:"medium",type:"numpad",accepted:["5"],hint:"‚àö((3¬≤+4¬≤)).",steps:["5"],exp:"5."},
    {text:"Midpoint of (2,4) and (8,10)?",opts:["(5,7)","(6,8)","(3,4)","(10,14)"],ans:0,diff:"easy",hint:"Average each coordinate.",steps:["(5,7)"],exp:"(5,7)."},
    {text:"Simplify ‚àö50.",opts:["5‚àö2","10‚àö5","25‚àö2","‚àö50"],ans:0,diff:"medium",hint:"50=25√ó2.",steps:["5‚àö2"],exp:"5‚àö2."},
    {text:"Slope-intercept form of 3x‚àí2y=8?",opts:["y=3x/2‚àí4","y=3x‚àí8","y=‚àí3x/2+4","y=2x/3‚àí4"],ans:0,diff:"medium",hint:"Solve for y.",steps:["y=3x/2‚àí4"],exp:"y=(3/2)x‚àí4."},
    {text:"Smallest root of x¬≤‚àí4x+3=0?",opts:["1","3","‚àí1","2"],ans:0,diff:"medium",type:"numpad",accepted:["1"],hint:"Factor: (x‚àí1)(x‚àí3).",steps:["x=1"],exp:"1."},
    {text:"Solve (x+1)/(x‚àí1)=3.",opts:["x=2","x=4","x=‚àí1","x=1/2"],ans:0,diff:"medium",type:"numpad",accepted:["2"],hint:"Cross multiply.",steps:["x+1=3x‚àí3‚Üíx=2"],exp:"2."},
    {text:"0! (zero factorial)?",opts:["1","0","undefined","‚àí1"],ans:0,diff:"easy",type:"numpad",accepted:["1"],hint:"By convention, 0!=1.",steps:["1"],exp:"1."},
],
  logic:[
    {text:"Double a number, subtract 5, get 19. The number?",opts:["12","7","19","14"],ans:0,diff:"easy",
      hint:"Translate to an equation: 2√ón‚àí5=19. Solve for n.",
      steps:["2n‚àí5=19","2n=24","n=12","Check: 2(12)‚àí5=24‚àí5=19 ‚úì"],
      exp:"2n‚àí5=19 ‚Üí n=12."},
    {text:"Bat + ball = $1.10. Bat is $1 more than ball. Ball costs:",opts:["$0.05","$0.10","$0.15","$0.20"],ans:0,diff:"medium",
      hint:"This is a classic trick! Don't say $0.10. Let b=ball, (b+1)=bat. Set up equation.",
      steps:["ball=b, bat=b+1","b+(b+1)=1.10","2b+1=1.10","2b=0.10 ‚Üí b=$0.05 (not $0.10!)"],
      exp:"2b+$1=$1.10 ‚Üí b=$0.05. Common wrong answer: $0.10."},
    {text:"Next: 2, 6, 18, 54, ___",opts:["162","108","96","180"],ans:0,diff:"easy",
      hint:"What are you doing to get from one term to the next?",
      steps:["6/2=3, 18/6=3, 54/18=3","Multiply by 3 each time (geometric)","54√ó3=162"],
      exp:"Multiply by 3: 54√ó3=162."},
    {text:"Next prime after 23?",opts:["29","25","27","31"],ans:0,diff:"easy",
      hint:"Check each number after 23: is it divisible by any prime up to its square root?",
      steps:["24=2√ó12 (not prime)","25=5√ó5 (not prime)","26=2√ó13 (not prime)","27=3√ó9 (not prime)","28=4√ó7 (not prime)","29: not divisible by 2,3,5 ‚Üí PRIME!"],
      exp:"29 is the next prime after 23."},
    {text:"20 heads, 56 legs (chickens + cows). Cows?",opts:["8","12","10","6"],ans:0,diff:"medium",
      hint:"Chickens have 2 legs, cows have 4 legs. Write two equations.",
      steps:["c+k=20 (heads) and 4c+2k=56 (legs)","Multiply 1st by 2: 2c+2k=40","Subtract: 2c=16 ‚Üí c=8 cows","k=20‚àí8=12 chickens"],
      exp:"Elimination: 2c=16 ‚Üí c=8 cows."},
    {text:"1, 1, 2, 3, 5, 8, 13, ___",opts:["21","20","24","18"],ans:0,diff:"easy",
      hint:"This is the famous Fibonacci sequence. Each term = sum of previous two.",
      steps:["Rule: a‚Çô=a‚Çô‚Çã‚ÇÅ+a‚Çô‚Çã‚ÇÇ","8+13=21"],
      exp:"Fibonacci: 8+13=21."},
    {text:"If today is Wednesday, what day is 100 days from now?",opts:["Friday","Saturday","Thursday","Sunday"],ans:0,diff:"medium",
      hint:"Days of week cycle with period 7. Find 100 mod 7.",
      steps:["100 √∑ 7 = 14 remainder 2","So 100 days = 14 full weeks + 2 extra days","Wednesday + 2 days = Friday"],
      exp:"100 mod 7 = 2. Wednesday + 2 = Friday."},
    {text:"Clock shows 3:00. Angle between hands?",opts:["90¬∞","60¬∞","120¬∞","45¬∞"],ans:0,diff:"easy",
      hint:"Clock has 12 hours around 360¬∞. Each hour = 30¬∞. At 3:00, how many hours apart?",
      steps:["360¬∞ √∑ 12 hours = 30¬∞ per hour","At 3:00, hands are 3 hours apart","3 √ó 30¬∞ = 90¬∞"],
      exp:"3 hours √ó 30¬∞/hour = 90¬∞."},
    {text:"Pattern: 1, 4, 9, 16, 25, ___",opts:["36","30","35","49"],ans:0,diff:"easy",
      hint:"Look at each number: 1=1¬≤, 4=2¬≤, 9=3¬≤... What's the pattern?",
      steps:["1¬≤=1, 2¬≤=4, 3¬≤=9, 4¬≤=16, 5¬≤=25","Next: 6¬≤=36"],
      exp:"Perfect squares: 6¬≤=36."},
    {text:"How many 3-letter 'words' using A,B,C,D (letters can repeat)?",opts:["64","24","12","48"],ans:0,diff:"medium",
      hint:"If repetition IS allowed, each position has the same number of choices.",
      steps:["4 choices for 1st letter","4 choices for 2nd letter","4 choices for 3rd letter","Total=4√ó4√ó4=64"],
      exp:"With repetition: 4¬≥=64."},
  
    {text:"Next in Fibonacci: 1,1,2,3,5,8,__?",opts:["13","11","10","16"],ans:0,diff:"easy",type:"numpad",accepted:["13"],hint:"Sum of two previous.",steps:["5+8=13"],exp:"13."},
    {text:"All Bloops are Razzles, all Razzles are Lazzles. All Bloops are:",opts:["Lazzles","Razzles only","Neither","Sometimes Lazzles"],ans:0,diff:"easy",hint:"Transitive: A‚ÜíB‚ÜíC means A‚ÜíC.",steps:["Lazzles"],exp:"Lazzles."},
    {text:"Next in geometric: 2,6,18,54,__?",opts:["162","108","81","216"],ans:0,diff:"easy",type:"numpad",accepted:["162"],hint:"√ó3 each time.",steps:["54√ó3=162"],exp:"162."},
    {text:"30 people: pizza or tacos. 20 pizza, 18 tacos. Both?",opts:["8","10","12","6"],ans:0,diff:"medium",type:"numpad",accepted:["8"],hint:"Inclusion-exclusion.",steps:["20+18‚àí30=8"],exp:"8."},
    {text:"Sequence 3,7,11,15,... 10th term?",opts:["39","43","35","41"],ans:0,diff:"medium",type:"numpad",accepted:["39"],hint:"a‚ÇÅ‚ÇÄ=3+9√ó4.",steps:["39"],exp:"39."},
    {text:"Today is Wednesday. Day in 100 days?",opts:["Friday","Thursday","Saturday","Wednesday"],ans:0,diff:"medium",hint:"100 mod 7=2.",steps:["Wed+2=Friday"],exp:"Friday."},
    {text:"Circle:Sphere as Square:?",opts:["Cube","Rectangle","Pentagon","Triangle"],ans:0,diff:"easy",hint:"2D‚Üí3D.",steps:["Cube"],exp:"Cube."},
    {text:"3√ó3√ó3 cube painted and cut into 1√ó1√ó1. How many have exactly 1 face painted?",opts:["6","8","12","0"],ans:0,diff:"hard",type:"numpad",accepted:["6"],hint:"Face centers: 1 per face √ó 6 faces.",steps:["6"],exp:"6."},
    {text:"Pattern: 1,4,9,16,25,__?",opts:["36","30","35","49"],ans:0,diff:"easy",type:"numpad",accepted:["36"],hint:"Perfect squares: 6¬≤.",steps:["36"],exp:"36."},
    {text:"A‚ÜîB means:",opts:["Logically equivalent","Contradiction","Unrelated","A implies B only"],ans:0,diff:"medium",hint:"Both A‚ÜíB and B‚ÜíA.",steps:["Logically equivalent"],exp:"Logically equivalent."},
    {text:"Missing: 2,4,8,__,32,64?",opts:["16","12","10","24"],ans:0,diff:"easy",type:"numpad",accepted:["16"],hint:"Powers of 2.",steps:["16"],exp:"16."},
    {text:"5 people, each shakes hands with every other. Total?",opts:["10","20","5","25"],ans:0,diff:"medium",type:"numpad",accepted:["10"],hint:"C(5,2).",steps:["10"],exp:"10."},
    {text:"NOT(NOT P) equals?",opts:["P","NOT P","True","False"],ans:0,diff:"easy",hint:"Double negative cancels.",steps:["P"],exp:"P."},
    {text:"50th odd number?",opts:["99","101","100","98"],ans:0,diff:"medium",type:"numpad",accepted:["99"],hint:"nth odd=2n‚àí1.",steps:["2(50)‚àí1=99"],exp:"99."},
    {text:"Alice before Bob, Bob before Carol, Carol before Dave. Who finishes last?",opts:["Dave","Carol","Bob","Alice"],ans:0,diff:"easy",hint:"Follow the chain.",steps:["Dave"],exp:"Dave."},
],
  statistics:[
    {text:"Mean of 4, 8, 6, 10, 7?",opts:["7","7.5","6.5","8"],ans:0,diff:"easy",
      hint:"Mean = sum of all values √∑ count of values.",
      steps:["Sum=4+8+6+10+7=35","Count=5","Mean=35/5=7"],
      exp:"35/5=7."},
    {text:"Median of 3,1,4,1,5,9,2,6?",opts:["3.5","4","3","4.5"],ans:0,diff:"easy",
      hint:"SORT the numbers first, then find the middle. With even count: average the two middle values.",
      steps:["Sorted: 1,1,2,3,4,5,6,9 (8 values)","Middle two: 3rd=2... wait, 4th=3 and 5th=4","Median=(3+4)/2=3.5"],
      exp:"Sorted: 1,1,2,3,4,5,6,9. Median=(3+4)/2=3.5."},
    {text:"Mean of 5 numbers is 12. Add 18. New mean?",opts:["13","12","14","15"],ans:0,diff:"medium",
      hint:"Find the original sum first (mean √ó count), then add 18 and recalculate.",
      steps:["Original sum = 5√ó12 = 60","New sum = 60+18 = 78","New count = 6","New mean = 78/6 = 13"],
      exp:"(5√ó12+18)/6=78/6=13."},
    {text:"Mode of 2,5,3,2,7,5,2,8?",opts:["2","5","3","7"],ans:0,diff:"easy",
      hint:"Mode = most frequently occurring value. Count each value.",
      steps:["2 appears: 3 times","5 appears: 2 times","3,7,8 appear: 1 time each","Mode = 2"],
      exp:"2 appears 3 times ‚Äî most frequent."},
    {text:"Which is most affected by outlier 200 in {10,20,30,40,200}?",opts:["Mean","Median","Mode","Range"],ans:0,diff:"medium",
      hint:"Which statistic pulls ALL values into its calculation directly?",
      steps:["Mean=(10+20+30+40+200)/5=300/5=60 (dragged up by 200!)","Median of sorted list: 10,20,30,40,200 ‚Üí middle=30 (barely affected)","Mode: none","Range=200‚àí10=190 (also affected, but mean is more commonly cited)"],
      exp:"Mean = 60 vs expected ~25. The outlier 200 pulls the mean up dramatically."},
    {text:"Range of 4, 8, 2, 15, 6?",opts:["13","11","15","9"],ans:0,diff:"easy",
      hint:"Range = maximum value ‚àí minimum value.",
      steps:["Max=15, Min=2","Range=15‚àí2=13"],
      exp:"Range=max‚àímin=15‚àí2=13."},
    {text:"Dataset {5,5,5,5,5}. Standard deviation?",opts:["0","5","1","25"],ans:0,diff:"medium",
      hint:"Standard deviation measures spread. If all values are identical, how much do they spread?",
      steps:["Mean=5","Every value = mean ‚Üí deviation = 0 for all","Standard deviation = ‚àö(average of squared deviations) = ‚àö0 = 0"],
      exp:"All values equal the mean ‚Üí zero deviation ‚Üí SD=0."},
    {text:"Mean=50, Median=45. Distribution is likely:",opts:["Right-skewed","Left-skewed","Symmetric","Uniform"],ans:0,diff:"hard",
      hint:"If mean > median, extreme high values pull the mean right. Which direction is the tail?",
      steps:["Mean=50 > Median=45","High outliers pull mean UP (right)","So the tail is on the right","= right-skewed (positive skew)"],
      exp:"Mean > Median ‚Üí extreme high values ‚Üí right-skewed."},
  
    {text:"Mean of 4,7,13,2,9?",opts:["7","6","8","5"],ans:0,diff:"easy",type:"numpad",accepted:["7"],hint:"Sum√∑count.",steps:["35√∑5=7"],exp:"7."},
    {text:"Median of 3,7,1,9,5?",opts:["5","7","3","9"],ans:0,diff:"easy",type:"numpad",accepted:["5"],hint:"Sort: 1,3,5,7,9.",steps:["Middle=5"],exp:"5."},
    {text:"Mode of 2,5,3,5,7,2,5?",opts:["5","2","7","3"],ans:0,diff:"easy",type:"numpad",accepted:["5"],hint:"Most frequent.",steps:["5 appears 3 times"],exp:"5."},
    {text:"Range of 15,3,28,7,42,19?",opts:["39","27","42","15"],ans:0,diff:"easy",type:"numpad",accepted:["39"],hint:"Max‚àímin.",steps:["42‚àí3=39"],exp:"39."},
    {text:"Mean=50, n=5. Sum?",opts:["250","50","100","55"],ans:0,diff:"easy",type:"numpad",accepted:["250"],hint:"Sum=mean√ón.",steps:["250"],exp:"250."},
    {text:"Most affected by outliers?",opts:["Mean","Median","Mode","Range"],ans:0,diff:"medium",hint:"Outliers pull the average.",steps:["Mean"],exp:"Mean."},
    {text:"Mean of 1,2,3,4,5?",opts:["3","2.5","4","5"],ans:0,diff:"easy",type:"numpad",accepted:["3"],hint:"15√∑5.",steps:["3"],exp:"3."},
    {text:"Scores 80,90,70,100. Need mean 85 on 5th test?",opts:["85","80","90","75"],ans:0,diff:"medium",type:"numpad",accepted:["85"],hint:"Target total=425.",steps:["425‚àí340=85"],exp:"85."},
    {text:"Right-skewed distribution: mean vs median?",opts:["Mean>Median","Mean<Median","Equal","Varies"],ans:0,diff:"hard",hint:"Long right tail pulls mean up.",steps:["Mean>Median"],exp:"Mean is greater."},
    {text:"Normal dist: data within 1 SD of mean?",opts:["68%","95%","99.7%","50%"],ans:0,diff:"hard",hint:"68-95-99.7 rule.",steps:["68%"],exp:"‚âà68%."},
    {text:"Median of 10,20,30,40?",opts:["25","20","30","15"],ans:0,diff:"easy",hint:"Average of two middle values.",steps:["(20+30)/2=25"],exp:"25."},
    {text:"IQR if Q1=10 and Q3=25?",opts:["15","20","35","10"],ans:0,diff:"medium",type:"numpad",accepted:["15"],hint:"Q3‚àíQ1.",steps:["15"],exp:"15."},
    {text:"Mode of 6,7,7,8,8,8,9,9,10,10?",opts:["8","9","7","10"],ans:0,diff:"easy",type:"numpad",accepted:["8"],hint:"Most frequent.",steps:["8 appears 3 times"],exp:"8."},
    {text:"Values 1,2,3 with frequencies 4,6,2. Mean?",opts:["1.83","2","2.5","1.5"],ans:0,diff:"hard",hint:"Œ£(v√óf)/Œ£f.",steps:["22/12‚âà1.83"],exp:"‚âà1.83."},
    {text:"Remove a value equal to the mean. Mean changes?",opts:["Same","Increases","Decreases","Can't tell"],ans:0,diff:"medium",hint:"Removing the mean doesn't shift it.",steps:["Same"],exp:"Stays the same."},
],
  challenge:[
    {text:"Average of 5 numbers is 12. Remove one ‚Üí average becomes 10. Number removed?",opts:["20","18","22","16"],ans:0,diff:"competition",
      hint:"Sum of 5 = mean √ó count = 5√ó12. Sum of remaining 4 = 4√ó10. Difference = removed number.",
      steps:["Sum of 5: 5√ó12=60","Sum of remaining 4: 4√ó10=40","Removed: 60‚àí40=20"],
      exp:"60‚àí40=20."},
    {text:"Positive integers < 100 divisible by 3 or 5?",opts:["46","47","48","45"],ans:0,diff:"competition",
      hint:"Use Inclusion-Exclusion: |A‚à™B|=|A|+|B|‚àí|A‚à©B|. A‚à©B = divisible by both = by 15.",
      steps:["Divisible by 3: ‚åä99/3‚åã=33","Divisible by 5: ‚åä95/5‚åã=19","Divisible by 15: ‚åä90/15‚åã=6","Total: 33+19‚àí6=46"],
      exp:"Inclusion-Exclusion: 33+19‚àí6=46."},
    {text:"Train: 120 mi @60 mph then 120 mi @40 mph. Average speed?",opts:["48 mph","50 mph","45 mph","52 mph"],ans:0,diff:"competition",
      hint:"Average speed ‚â† average of speeds! Use total distance √∑ total time.",
      steps:["Time 1: 120/60=2 hours","Time 2: 120/40=3 hours","Total: 240 miles in 5 hours","Average: 240/5=48 mph"],
      exp:"Total distance/total time = 240/5 = 48 mph."},
    {text:"Sum of all integers 1 to 100?",opts:["5050","5000","5100","4950"],ans:0,diff:"competition",
      hint:"Gauss's trick: pair first and last (1+100=101, 2+99=101...). 50 pairs!",
      steps:["Gauss formula: n(n+1)/2","=100√ó101/2","=10100/2=5050","Or: 50 pairs of 101 = 5050"],
      exp:"n(n+1)/2=100√ó101/2=5050."},
    {text:"3√ó3√ó3 cube painted, cut into 27 unit cubes. Cubes with exactly 2 painted faces?",opts:["12","8","6","24"],ans:0,diff:"competition",
      hint:"Think about where unit cubes are located: corners? edges? face-centers? center?",
      steps:["Corners: 3 faces painted (8 cubes)","Edge non-corners: 2 faces painted","Face centers: 1 face painted","Complete center: 0 faces","A 3√ó3 cube has 12 edges, each with 1 middle unit","So 12 cubes have exactly 2 painted faces"],
      exp:"12 edge (non-corner) unit cubes have exactly 2 painted faces."},
    {text:"Boys:girls = 3:4. There are 28 girls. Total students?",opts:["49","28","21","42"],ans:0,diff:"competition",
      hint:"If ratio is 3:4, the girls represent 4 parts of the whole.",
      steps:["4 parts = 28 girls ‚Üí 1 part = 7","Boys = 3 parts = 21","Total = 7 parts = 49"],
      exp:"1 part=7. Boys=21. Total=49."},
    {text:"Apples $0.40, oranges $0.55. Maria: 15 fruits, $7.20. Oranges?",opts:["8","7","9","6"],ans:0,diff:"competition",
      hint:"Two equations: a+o=15 and 0.40a+0.55o=7.20. Use substitution.",
      steps:["a=15‚àío","0.40(15‚àío)+0.55o=7.20","6‚àí0.40o+0.55o=7.20","0.15o=1.20 ‚Üí o=8"],
      exp:"0.15o=1.20 ‚Üí o=8."},
    {text:"Smallest number leaving remainder 1 when divided by 2,3,4,5,6?",opts:["61","31","121","41"],ans:0,diff:"competition",
      hint:"Find LCM(2,3,4,5,6) first. Then what number satisfies all conditions?",
      steps:["LCM(2,3,4,5,6)=60","We need N‚â°1 (mod 2), mod 3, mod 4, mod 5, mod 6","N=LCM+1=60+1=61","Check: 61√∑2=30 R1 ‚úì, 61√∑3=20 R1 ‚úì..."],
      exp:"LCM(2,3,4,5,6)=60. Answer=61."},
    {text:"Diagonals in a regular hexagon?",opts:["9","6","12","15"],ans:0,diff:"competition",
      hint:"Formula: n(n‚àí3)/2 for an n-sided polygon.",
      steps:["n=6 sides","Diagonals = 6(6‚àí3)/2","=6(3)/2=18/2=9"],
      exp:"n(n‚àí3)/2=6√ó3/2=9."},
    {text:"Product=48, sum=14 for two positive integers. What are they?",type:"free",ans:"6 and 8",accepted:["6 and 8","8 and 6","6,8","8,6"],diff:"competition",
      hint:"x+y=14 and xy=48. Form quadratic: substitute y=14‚àíx into xy=48.",
      steps:["x(14‚àíx)=48","14x‚àíx¬≤=48","x¬≤‚àí14x+48=0","(x‚àí6)(x‚àí8)=0 ‚Üí x=6 or 8","The two numbers are 6 and 8"],
      exp:"x¬≤‚àí14x+48=0 ‚Üí 6 and 8."},
    {text:"Perfect squares strictly between 100 and 500?",opts:["12","11","13","10"],ans:0,diff:"competition",
      hint:"List the perfect squares. ‚àö100=10, ‚àö500‚âà22.4. Count 11¬≤ through 22¬≤.",
      steps:["‚àö100=10 (excluded), ‚àö500‚âà22.4","Perfect squares: 11¬≤=121 through 22¬≤=484","Count: 11,12,13,...,22 = 12 numbers"],
      exp:"11¬≤ through 22¬≤ ‚Üí 22‚àí11+1=12."},
    {text:"12 play chess, 8 play checkers, 5 play both. At least one?",opts:["15","20","25","10"],ans:0,diff:"competition",
      hint:"Inclusion-Exclusion: |chess ‚à™ checkers| = |chess| + |checkers| ‚àí |both|.",
      steps:["|Chess‚à™Checkers|=|Chess|+|Checkers|‚àí|Both|","=12+8‚àí5=15"],
      exp:"12+8‚àí5=15."},
    {text:"50th term of 7, 11, 15, 19, ...?",opts:["203","199","207","211"],ans:0,diff:"competition",
      hint:"Arithmetic sequence: a‚Çô=a‚ÇÅ+(n‚àí1)d. What is d?",
      steps:["d=11‚àí7=4","a‚ÇÖ‚ÇÄ=7+(50‚àí1)√ó4","=7+49√ó4=7+196=203"],
      exp:"a‚ÇÅ+(n‚àí1)d=7+49√ó4=203."},
    {text:"Rectangle: perimeter 28, area 45. Dimensions?",opts:["5 and 9","4 and 10","6 and 8","3 and 11"],ans:0,diff:"competition",
      hint:"2(l+w)=28 ‚Üí l+w=14. Also lw=45. These give a system ‚Üí quadratic.",
      steps:["l+w=14 and lw=45","Quadratic: l¬≤‚àí14l+45=0","(l‚àí5)(l‚àí9)=0 ‚Üí l=5 or 9","Dimensions: 5 and 9"],
      exp:"l+w=14, lw=45 ‚Üí (l‚àí5)(l‚àí9)=0 ‚Üí 5 and 9."},
  
    {text:"Units digit of 3^100?",opts:["1","3","9","7"],ans:0,diff:"competition",type:"numpad",accepted:["1"],hint:"Cycle: 3,9,7,1 length 4. 100 mod 4=0.",steps:["1"],exp:"1."},
    {text:"Diagonals in 12-sided polygon?",opts:["54","66","78","48"],ans:0,diff:"competition",type:"numpad",accepted:["54"],hint:"n(n‚àí3)/2.",steps:["12√ó9/2=54"],exp:"54."},
    {text:"Product of consecutive even integers is 168. Smaller?",opts:["12","14","10","8"],ans:0,diff:"competition",type:"numpad",accepted:["12"],hint:"n(n+2)=168.",steps:["12√ó14=168"],exp:"12."},
    {text:"Sum of 1+2+...+100?",opts:["5050","5000","10000","4950"],ans:0,diff:"competition",type:"numpad",accepted:["5050"],hint:"n(n+1)/2.",steps:["100√ó101/2=5050"],exp:"5050."},
    {text:"Ways to sit 3 people in 5 chairs?",opts:["60","10","20","120"],ans:0,diff:"competition",type:"numpad",accepted:["60"],hint:"P(5,3)=5√ó4√ó3.",steps:["60"],exp:"60."},
    {text:"Solve ‚àö(2x+1)=3.",opts:["x=4","x=5","x=3","x=8"],ans:0,diff:"competition",type:"numpad",accepted:["4"],hint:"Square both sides.",steps:["2x+1=9‚Üíx=4"],exp:"4."},
    {text:"Integers 1-100 divisible by 3 or 5?",opts:["47","33","40","50"],ans:0,diff:"competition",type:"numpad",accepted:["47"],hint:"Inclusion-exclusion: 33+20‚àí6.",steps:["47"],exp:"47."},
    {text:"Largest prime factor of 360?",opts:["5","3","2","6"],ans:0,diff:"competition",type:"numpad",accepted:["5"],hint:"360=2¬≥√ó3¬≤√ó5.",steps:["5"],exp:"5."},
    {text:"Sum 1¬≤+2¬≤+...+10¬≤?",opts:["385","285","450","330"],ans:0,diff:"competition",type:"numpad",accepted:["385"],hint:"n(n+1)(2n+1)/6.",steps:["385"],exp:"385."},
    {text:"P(two aces in a row, no replacement)?",opts:["1/221","1/169","4/663","1/52"],ans:0,diff:"competition",hint:"(4/52)√ó(3/51).",steps:["1/221"],exp:"1/221."},
    {text:"Number of divisors of 2‚Å¥√ó3¬≤√ó5?",opts:["30","15","20","24"],ans:0,diff:"competition",type:"numpad",accepted:["30"],hint:"(4+1)(2+1)(1+1).",steps:["5√ó3√ó2=30"],exp:"30."},
    {text:"If log‚ÇÇ(3)=a, find log‚ÇÑ(9).",opts:["a","2a","a/2","a¬≤"],ans:0,diff:"competition",hint:"log‚ÇÑ(9)=log‚ÇÇ(9)/log‚ÇÇ(4).",steps:["2a/2=a"],exp:"a."},
    {text:"Sum of infinite geometric: 1/2+1/4+1/8+...?",opts:["1","2","1/2","‚àû"],ans:0,diff:"competition",type:"numpad",accepted:["1"],hint:"S=a/(1‚àír)=(1/2)/(1/2).",steps:["1"],exp:"1."},
    {text:"Squares of any size in 10√ó10 grid?",opts:["385","100","200","400"],ans:0,diff:"competition",type:"numpad",accepted:["385"],hint:"Œ£k¬≤ from k=1 to 10.",steps:["n(n+1)(2n+1)/6=385"],exp:"385."},
],
  hardProblems:[
    {text:"If f(x) = 2x¬≤ ‚àí 3x + 1, find f(‚àí2).",opts:["15","11","7","‚àí1"],ans:0,diff:"hard",
      hint:"Substitute x=‚àí2. Remember (‚àí2)¬≤=4.",
      steps:["f(‚àí2)=2(4)+6+1=15"],exp:"f(‚àí2)=15."},
    {text:"Find remainder when 2‚Åµ‚Å∞ is divided by 7.",opts:["4","1","2","6"],ans:0,diff:"hard",
      hint:"2 mod 7 cycle: 2,4,1 (length 3). 50 mod 3=2.",
      steps:["2¬π=2,2¬≤=4,2¬≥=1 mod 7","50 mod 3=2 ‚Üí 2¬≤=4"],exp:"4."},
    {text:"How many ways to arrange LEVEL?",opts:["30","120","60","20"],ans:0,diff:"hard",
      hint:"5!/(2!√ó2!) ‚Äî two L's, two E's.",
      steps:["5!/(2!√ó2!)=120/4=30"],exp:"30."},
    {text:"The sum of first n odd numbers equals?",opts:["n¬≤","n(n+1)/2","2n","n¬≤+1"],ans:0,diff:"hard",
      hint:"1=1¬≤, 1+3=4=2¬≤, 1+3+5=9=3¬≤",
      steps:["Pattern: sum = n¬≤"],exp:"n¬≤."},
    {text:"Geometric sequence 3,6,12,... 8th term?",opts:["384","192","768","256"],ans:0,diff:"hard",
      hint:"r=2, a‚Çô=3√ó2^(n‚àí1).",
      steps:["a‚Çà=3√ó2‚Å∑=384"],exp:"384."},
    {text:"If log‚ÇÇ(x)=5, find x.",opts:["32","25","10","16"],ans:0,diff:"hard",
      hint:"2‚Åµ=x.",
      steps:["2‚Åµ=32"],exp:"32."},
    {text:"Circle x¬≤+y¬≤‚àí6x+4y=12. What is its radius?",opts:["5","25","‚àö12","7"],ans:0,diff:"hard",
      hint:"Complete the square.",
      steps:["(x‚àí3)¬≤+(y+2)¬≤=25, r=5"],exp:"5."},
    {text:"How many diagonals in a 10-gon?",opts:["35","45","54","40"],ans:0,diff:"hard",
      hint:"n(n‚àí3)/2.",
      steps:["10√ó7/2=35"],exp:"35."},
    {text:"Value of ‚àö(6+‚àö(6+‚àö(6+...)))?",opts:["3","‚àö6","4","2+‚àö6"],ans:0,diff:"hard",
      hint:"Let x=‚àö(6+x). Solve x¬≤=6+x.",
      steps:["x¬≤‚àíx‚àí6=0","(x‚àí3)(x+2)=0","x=3"],exp:"3."},
    {text:"Coefficient of x¬≥ in (1+x)‚Å∂?",opts:["20","15","6","10"],ans:0,diff:"hard",
      hint:"C(6,3).",
      steps:["C(6,3)=20"],exp:"20."},
    {text:"Solve 2^(x+1)=32.",opts:["x=4","x=5","x=3","x=16"],ans:0,diff:"hard",type:"numpad",accepted:["4"],
      hint:"32=2‚Åµ ‚Üí x+1=5.",
      steps:["x=4"],exp:"4."},
    {text:"Product of roots of 2x¬≤‚àí8x+6=0?",opts:["3","4","‚àí3","6"],ans:0,diff:"hard",type:"numpad",accepted:["3"],
      hint:"c/a=6/2.",
      steps:["c/a=3"],exp:"3."},
    {text:"How many trailing zeros does 30! have?",opts:["7","6","5","8"],ans:0,diff:"hard",type:"numpad",accepted:["7"],
      hint:"‚åä30/5‚åã+‚åä30/25‚åã.",
      steps:["6+1=7"],exp:"7."},
    {text:"Find all x: |2x‚àí1|<5.",opts:["‚àí2<x<3","x<3","x>‚àí2","‚àí5<x<5"],ans:0,diff:"hard",
      hint:"‚àí5<2x‚àí1<5.",
      steps:["‚àí4<2x<6","‚àí2<x<3"],exp:"‚àí2<x<3."},
    {text:"If a+b=5 and a¬≤+b¬≤=17, find ab.",opts:["4","8","3","6"],ans:0,diff:"hard",type:"numpad",accepted:["4"],
      hint:"(a+b)¬≤=a¬≤+2ab+b¬≤.",
      steps:["25=17+2ab","ab=4"],exp:"4."},
    {text:"Sum of integers from ‚àí50 to 50?",opts:["0","50","2550","‚àí50"],ans:0,diff:"hard",type:"numpad",accepted:["0"],
      hint:"Symmetric: every positive cancels its negative.",
      steps:["Sum=0"],exp:"0."},
    {text:"Expand (x+y)‚Å¥ ‚Äî coefficient of x¬≤y¬≤?",opts:["6","4","12","3"],ans:0,diff:"hard",type:"numpad",accepted:["6"],
      hint:"C(4,2).",
      steps:["C(4,2)=6"],exp:"6."},
    {text:"Derivative of x¬≥ at x=2?",opts:["12","6","8","3"],ans:0,diff:"hard",type:"numpad",accepted:["12"],
      hint:"f'(x)=3x¬≤. At x=2: 3√ó4.",
      steps:["3(4)=12"],exp:"12."},
    {text:"Solve 4^x=8.",opts:["x=3/2","x=2","x=3","x=1"],ans:0,diff:"hard",
      hint:"4=2¬≤, 8=2¬≥. So 2^(2x)=2¬≥.",
      steps:["2x=3","x=3/2"],exp:"x=3/2."},
    {text:"Sum of infinite series: 4+2+1+1/2+...?",opts:["8","6","16","4"],ans:0,diff:"hard",type:"numpad",accepted:["8"],
      hint:"S=a/(1‚àír), a=4, r=1/2.",
      steps:["4/(1‚àí1/2)=8"],exp:"8."},
  ],
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ACHIEVEMENTS (20 total)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ACHIEVEMENTS = [
  {id:'first',     icon:'‚ö°', name:'First Strike',      desc:'Answer your first question',           check:s=>s.total>=1},
  {id:'streak3',   icon:'üî•', name:'On Fire',           desc:'3-question streak',                    check:s=>s.streak>=3},
  {id:'streak5',   icon:'üåã', name:'Unstoppable',       desc:'5-question streak',                    check:s=>s.streak>=5},
  {id:'streak10',  icon:'üí•', name:'Legendary Streak',  desc:'10-question streak!!',                 check:s=>s.streak>=10},
  {id:'ten',       icon:'üéØ', name:'Sharp Shooter',     desc:'10 correct answers',                   check:s=>s.correct>=10},
  {id:'twenty',    icon:'üí™', name:'Grinder',           desc:'25 correct answers',                   check:s=>s.correct>=25},
  {id:'fifty',     icon:'üî±', name:'Elite',             desc:'50 correct answers',                   check:s=>s.correct>=50},
  {id:'speed',     icon:'‚ö°', name:'Speed Demon',       desc:'Correct in under 6 seconds',           check:s=>s.lastTime<6&&s.lastCorrect},
  {id:'allTopics', icon:'üåê', name:'Renaissance',       desc:'Attempt all 12 topics',                check:s=>Object.keys(s.tAttempt).length>=12},
  {id:'xp500',     icon:'üíé', name:'Diamond',           desc:'Earn 500 total XP',                    check:s=>s.xp>=500},
  {id:'xp1000',    icon:'üëë', name:'XP King',           desc:'Earn 1000 total XP',                   check:s=>s.xp>=1000},
  {id:'comp',      icon:'üèÜ', name:'Challenge Ready', desc:'5 Challenge Round problems',           check:s=>(s.tCount.challenge||0)>=5},
  {id:'lv5',       icon:'üöÄ', name:'Level 5',           desc:'Reach level 5',                        check:s=>s.level>=5},
  {id:'daily',     icon:'üåü', name:'Daily Challenger',  desc:'Complete 10 correct in one session',   check:s=>s.sessionCorrect>=10},
  {id:'nohint',    icon:'üß†', name:'Brain Power',       desc:'10 correct without using a hint',      check:s=>s.noHintStreak>=10},
  {id:'comeback',  icon:'üîÑ', name:'Comeback Kid',      desc:'Get 3 correct after getting 3 wrong',  check:s=>s.comingBack>=3},
  {id:'perfect5',  icon:'‚ú®', name:'Perfect 5',         desc:'5 correct in a row, all under 10s',    check:s=>s.speedStreak>=5},
  {id:'mathcounts_mastery', icon:'ü•á', name:'Challenge Master', desc:'80%+ accuracy in Challenge Round', check:s=>(s.tCount.challenge||0)>=5&&((s.tCorrect.challenge||0)/(s.tCount.challenge||1))>=0.8},
  {id:'goal_complete', icon:'üéØ', name:'Goal Getter',   desc:'Complete your first goal',             check:s=>s.goalsCompleted>=1},
  {id:'week_streak',  icon:'üìÖ', name:'Week Warrior',   desc:'7-day study streak',                   check:s=>s.dayStreak>=7},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DAILY TIPS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TIPS = [
  "For competition math, always check: is there a shortcut? Top competitors solve 30 problems in 30 minutes.",
  "The quadratic formula always works ‚Äî even when factoring fails. Memorize: x=(‚àíb¬±‚àö(b¬≤‚àí4ac))/2a",
  "In system of equations problems, look for the easier method: substitution (if one variable is isolated) or elimination (if coefficients line up).",
  "Divisibility tricks: a number is divisible by 3 if its digits sum to a multiple of 3.",
  "For probability problems, drawing a tree diagram or listing outcomes systematically prevents mistakes.",
  "Pythagorean triples to memorize: 3-4-5, 5-12-13, 8-15-17, 7-24-25. They appear constantly in math problems!",
  "Vieta's formulas are a secret weapon: sum of roots = ‚àíb/a, product = c/a. No solving needed!",
  "For counting problems, ask yourself: does ORDER matter? Yes = permutation. No = combination.",
  "Practice doing problems WITHOUT a calculator ‚Äî many competitions are calculator-free!",
  "When you get something wrong, don't just check the answer. Re-do the problem from scratch to build real understanding.",
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE & PERSISTENCE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const STORAGE_KEY = 'numiqube_v1';

function defaultState() {
  return {
    username: '',
    xp: 0, level: 1,
    correct: 0, wrong: 0, total: 0,
    streak: 0, bestStreak: 0,
    dayStreak: 0, lastStudyDate: '',
    sessionCorrect: 0, sessionXP: 0,
    noHintStreak: 0, comingBack: 0, speedStreak: 0,
    goalsCompleted: 0,
    tAttempt: {}, tCount: {}, tCorrect: {},
    tAvgTime: {}, tTimes: {},
    earned: [],
    goals: [],
    history: [],
    wrongLog: [],
    activityLog: {},
    shopOwned: [],
    shopEquipped: {},
    shopSpent: 0,
    emailSignedUp: false,
    onboardingDone: false,
    settings: { lightMode:false, sessionGoal:20, speedTimer:15, sound:true, confetti:true },
    // runtime only (not saved)
    currentTopic: 'quadratics',
    q: null, answered: false, qIdx: 0,
    streak: 0, lastTime: 999, lastCorrect: false, qStart: 0,
    hintUsed: false, speedInterval: null, paused: false,
    mode: 'normal', srMode: false,
    srQueue: [],
  };
}

let S = defaultState();

function loadState() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      const d = JSON.parse(saved);
      Object.assign(S, d);
      S.earned = new Set(S.earned || []);
      // re-init runtime
      S.q = null; S.answered = false; S.currentTopic = S.currentTopic || 'quadratics';
      S.streak = S.streak || 0; S.lastTime = 999; S.lastCorrect = false; S.qStart = 0;
      S.hintUsed = false; S.speedInterval = null; S.paused = false;
      S.mode = 'normal'; S.srMode = false; S.srQueue = [];
      S.sessionCorrect = 0; S.sessionXP = 0;
    } else {
      S.earned = new Set();
    }
  } catch(e) { S.earned = new Set(); }
}

function saveState() {
  try {
    const toSave = Object.assign({}, S);
    toSave.earned = [...S.earned];
    delete toSave.q; delete toSave.speedInterval; delete toSave.srQueue;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(toSave));
    // Also save to Firebase if signed in
    saveStateToFirebase();
  } catch(e) {}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  INITIALIZATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function init() {
  loadState();
  buildStars();
  // Always show home page ‚Äî auth state listener handles the rest
  // (Don't auto-skip to study page anymore)
  Object.keys(QB).forEach(t => {
    if (!S.tCount[t]) S.tCount[t]=0;
    if (!S.tCorrect[t]) S.tCorrect[t]=0;
    if (!S.tTimes[t]) S.tTimes[t]=[];
  });
}

function buildStars() {
  const bg = document.getElementById('stars-bg');
  for (let i=0; i<80; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const size = Math.random()<0.7 ? 1 : Math.random()<0.7 ? 2 : 3;
    s.style.cssText = `width:${size}px;height:${size}px;left:${Math.random()*100}%;top:${Math.random()*100}%;--d:${2+Math.random()*4}s;--delay:${Math.random()*4}s;--lo:${0.05+Math.random()*0.15};--hi:${0.4+Math.random()*0.5};`;
    bg.appendChild(s);
  }
}

function beginApp(returning=false) {
  const input = document.getElementById('username-input');
  if (!returning) {
    const name = input.value.trim();
    if (!name) { input.style.borderColor='var(--wrong)'; input.placeholder='Please enter your name!'; setTimeout(()=>{input.style.borderColor='';input.placeholder='Your name (e.g. Alex)';},1800); return; }
    S.username = name.slice(0,20);
  }
  document.getElementById('page-home').style.display = 'none';
  document.getElementById('nav').style.display = 'flex';
  updateDayStreak();
  restoreEquipped();
  isStudyPageActive = true;
  showPage('study');
  buildTopicTabs();
  startTimer();
  loadQ();
  refreshDashboard();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PAGE ROUTING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  const page = document.getElementById('page-'+name);
  if (page) page.classList.add('active');
  document.querySelectorAll('.nav-tab').forEach((t,i) => {
    const names = ['study','dashboard','progress','goals','settings'];
    t.classList.toggle('active', names[i] === name);
  });
  isStudyPageActive = (name === 'study');
  if (name==='dashboard') refreshDashboard();
  if (name==='progress') refreshProgress();
  if (name==='goals') refreshGoals();
  if (name==='settings') refreshSettings();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TIMER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let timerInterval = null;
let sessionSecs = 0;
let isStudyPageActive = false;

function startTimer() {
  if (timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    if (S.paused) return;
    if (!isStudyPageActive) return;
    sessionSecs++;
    const m = String(Math.floor(sessionSecs/60)).padStart(2,'0');
    const s = String(sessionSecs%60).padStart(2,'0');
    document.getElementById('nav-timer').textContent = `${m}:${s}`;
  }, 1000);
}

function togglePause() {
  S.paused = !S.paused;
  const btn = document.getElementById('pause-btn');
  btn.textContent = S.paused ? '‚ñ∂ Resume' : '‚è∏ Pause';
  btn.classList.toggle('active-tool', S.paused);
  const panelBtn = document.getElementById('panel-pause-btn');
  if(panelBtn){ panelBtn.textContent = S.paused ? '‚ñ∂ Resume' : '‚è∏ Pause'; panelBtn.classList.toggle('active-tool', S.paused); }
  if (S.paused && S.speedInterval) { clearInterval(S.speedInterval); S.speedInterval = null; }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DAY STREAK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateDayStreak() {
  const today = new Date().toDateString();
  const yest = new Date(Date.now()-86400000).toDateString();
  if (S.lastStudyDate === today) return;
  if (S.lastStudyDate === yest) S.dayStreak++;
  else if (S.lastStudyDate === '') S.dayStreak = 1;
  else S.dayStreak = 1;
  S.lastStudyDate = today;
  // Log activity
  const key = new Date().toISOString().slice(0,10);
  S.activityLog[key] = (S.activityLog[key]||0)+1;
  saveState();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOPIC TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TL = {
  counting:'üçé Counting Basics',
  earlyMath:'üî¢ Early Math',
  quadratics:'üìê Quadratics',
  systems:'üîó Systems',
  numberTheory:'üî¢ Number Theory',
  geometry:'üìè Geometry',
  probability:'üé≤ Probability',
  algebra:'üìà Algebra',
  logic:'üß© Logic',
  statistics:'üìä Statistics',
  challenge:'üèÜ Challenge Round',
  hardProblems:'üî• Extreme Math',
};
const TC = {counting:'#06d6a0',earlyMath:'#ffd166',quadratics:'#ff6b35',systems:'#118ab2',numberTheory:'#ffd166',geometry:'#06d6a0',probability:'#ef476f',algebra:'#c77dff',logic:'#ff9a3c',statistics:'#4cc9f0',challenge:'#f72585',hardProblems:'#ff6b35'};

const usedQ = {};
Object.keys(QB).forEach(t=>usedQ[t]=[]);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOPIC ICONS MAP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const TOPIC_ICONS = {
  counting:'üçé', earlyMath:'üî¢', quadratics:'üìê', systems:'‚öñÔ∏è',
  numberTheory:'üî¢', geometry:'üìè', probability:'üé≤', algebra:'üî£',
  logic:'üß©', statistics:'üìä', challenge:'üèÜ', hardProblems:'üî•'
};

// Selected topics ‚Äî multi-topic support
let _selectedTopics = null; // null means all

function buildTopicTabs() {
  if (!_selectedTopics) _selectedTopics = new Set(Object.keys(QB));
  updateTopicPickerBtn();
}

function updateTopicPickerBtn() {
  const all = Object.keys(QB);
  const sel = _selectedTopics ? [..._selectedTopics] : all;
  const btn = document.getElementById('topic-pick-btn');
  if (sel.length === 1) {
    document.getElementById('topic-pick-icon').textContent = TOPIC_ICONS[sel[0]]||'üìö';
    document.getElementById('topic-pick-name').textContent = TL[sel[0]];
    S.currentTopic = sel[0];
  } else if (sel.length === all.length) {
    document.getElementById('topic-pick-icon').textContent = 'üåê';
    document.getElementById('topic-pick-name').textContent = 'All Topics';
  } else {
    document.getElementById('topic-pick-icon').textContent = 'üìö';
    document.getElementById('topic-pick-name').textContent = `${sel.length} Topics Mixed`;
  }
  const cnt = sel.reduce((a,t)=>a+(S.tCount[t]||0),0);
  const cor = sel.reduce((a,t)=>a+(S.tCorrect[t]||0),0);
  const acc = cnt>0 ? Math.round(cor/cnt*100)+'% accuracy' : 'Not started yet';
  document.getElementById('topic-pick-acc').textContent = acc;
}

function openTopicModal() {
  const all = Object.keys(QB);
  const sel = _selectedTopics || new Set(all);
  const grid = document.getElementById('topic-card-grid');
  grid.innerHTML = '';

  all.forEach(k => {
    const v = TL[k];
    const cnt = S.tCount[k]||0, cor = S.tCorrect[k]||0;
    const acc = cnt>0 ? Math.round(cor/cnt*100) : null;
    const icon = TOPIC_ICONS[k]||'üìö';
    const isSelected = sel.has(k);

    const card = document.createElement('div');
    card.className = 'topic-card-item'+(isSelected?' selected':'');
    card.dataset.topic = k;
    card.innerHTML = `
      <div class="tci-check">${isSelected?'‚úì':''}</div>
      <span class="tci-icon">${icon}</span>
      <span class="tci-name">${v}</span>
      <span class="tci-acc">${acc!==null?acc+'% acc':'Not tried yet'}</span>
      <div class="tci-bar"><div class="tci-bar-fill" style="width:${acc||0}%;background:${acc>=80?'var(--correct)':acc>=50?'var(--a2)':'var(--accent)'}"></div></div>
    `;
    card.onclick = () => toggleTopicCard(card, k);
    grid.appendChild(card);
  });

  updateSelectedCountLabel();
  openModal('topic-modal');
}

function toggleTopicCard(card, k) {
  const all = Object.keys(QB);
  if (!_selectedTopics) _selectedTopics = new Set(all);

  if (_selectedTopics.has(k)) {
    // Don't allow deselecting the last one
    if (_selectedTopics.size <= 1) { spawnXP('Pick at least 1!','var(--wrong)'); return; }
    _selectedTopics.delete(k);
    card.classList.remove('selected');
    card.querySelector('.tci-check').textContent = '';
  } else {
    _selectedTopics.add(k);
    card.classList.add('selected');
    card.querySelector('.tci-check').textContent = '‚úì';
  }
  updateSelectedCountLabel();
  updateToggleAllBtn();
}

function updateSelectedCountLabel() {
  const all = Object.keys(QB);
  const sel = _selectedTopics ? _selectedTopics.size : all.length;
  document.getElementById('selected-count-label').textContent =
    sel === all.length ? `All ${all.length} selected` : `${sel} of ${all.length} selected`;
}

function updateToggleAllBtn() {
  const all = Object.keys(QB);
  const allSelected = _selectedTopics && _selectedTopics.size === all.length;
  const btn = document.getElementById('toggle-all-btn');
  btn.textContent = allSelected ? 'Deselect All' : 'Select All';
  btn.style.background = allSelected ? 'var(--accent)' : 'var(--card3)';
  btn.style.color = allSelected ? 'white' : 'var(--muted)';
}

function toggleAllTopics() {
  const all = Object.keys(QB);
  const allSelected = _selectedTopics && _selectedTopics.size === all.length;

  if (allSelected) {
    // Deselect all ‚Äî keep first one so we always have at least one
    _selectedTopics = new Set([all[0]]);
  } else {
    _selectedTopics = new Set(all);
  }

  // Refresh the cards
  document.querySelectorAll('.topic-card-item').forEach(card => {
    const k = card.dataset.topic;
    const isSelected = _selectedTopics.has(k);
    card.classList.toggle('selected', isSelected);
    card.querySelector('.tci-check').textContent = isSelected ? '‚úì' : '';
  });

  updateSelectedCountLabel();
  updateToggleAllBtn();
}

function confirmTopicSelection() {
  closeModal('topic-modal');
  updateTopicPickerBtn();
  loadQ();
}

function switchTopic(t) {
  _selectedTopics = new Set([t]);
  S.currentTopic = t;
  updateTopicPickerBtn();
  loadQ();
}

function shuffleTopic() {
  const topics = Object.keys(QB);
  const t = topics[Math.floor(Math.random()*topics.length)];
  switchTopic(t);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STUDY MODE vs TEST MODE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _isTestMode = false;
let _testResults = [];

function toggleStudyMode() {
  _isTestMode = !_isTestMode;
  const btn = document.getElementById('studymode-btn');
  const panelBtn = document.getElementById('panel-studymode-btn');
  const banner = document.getElementById('mode-banner');

  if (_isTestMode) {
    btn.textContent = 'üìù Test Mode';
    btn.classList.add('active-tool');
    if(panelBtn){ panelBtn.textContent='üìù Test Mode: On'; panelBtn.classList.add('active-tool'); }
    banner.classList.add('visible');
    _testResults = [];
    spawnXP('üìù Test Mode ON','var(--a4)');
  } else {
    btn.textContent = 'üìö Study Mode';
    btn.classList.remove('active-tool');
    if(panelBtn){ panelBtn.textContent='üìö Study Mode: Off'; panelBtn.classList.remove('active-tool'); }
    banner.classList.remove('visible');
    if (_testResults.length > 0) showTestSummary();
    _testResults = [];
  }
  loadQ();
}

function showTestSummary() {
  const total = _testResults.length;
  const correct = _testResults.filter(r=>r).length;
  const pct = Math.round(correct/total*100);
  const grade = pct>=90?'A+':pct>=80?'A':pct>=70?'B':pct>=60?'C':'Keep practicing';
  alert(`üìù Test Results\n\n${correct}/${total} correct ‚Äî ${pct}%\nGrade: ${grade}\n\n${pct>=80?'Great work! üéâ':'Review the explanations for the ones you missed.'}`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONCEPTS ‚Äî per-topic explainer
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CONCEPTS = {
  counting: {
    title: 'üçé Counting Basics',
    body: `<p style="margin-bottom:12px;">Counting is the foundation of all math. Before anything else, you need to be comfortable with numbers and basic operations.</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a3);">
  <strong>Addition</strong> ‚Äî combining two groups. 3 + 4 = 7 means "3 things and 4 more things = 7 things total."
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a2);">
  <strong>Subtraction</strong> ‚Äî taking away. 9 ‚àí 5 = 4 means "start with 9, remove 5, you have 4 left."
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a5);">
  <strong>Sequences</strong> ‚Äî a pattern of numbers. Count by 2s: 2, 4, 6, 8... Each number follows a rule.
</div>
<p style="color:var(--muted);font-size:0.8rem;">Tip: Use your fingers, draw pictures, or use objects to count. There's no shame in that at any age.</p>`
  },
  earlyMath: {
    title: 'üî¢ Early Math',
    body: `<p style="margin-bottom:12px;">Early math is where arithmetic gets real. You're moving from counting to calculating.</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a3);">
  <strong>Multiplication</strong> ‚Äî repeated addition. 6 √ó 4 = 24 means "six groups of four." Know your times tables up to 12!
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a2);">
  <strong>Division</strong> ‚Äî splitting into equal groups. 20 √∑ 4 = 5 means "how many groups of 4 fit in 20?"
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--accent);">
  <strong>Fractions</strong> ‚Äî parts of a whole. 3/4 means 3 out of 4 equal parts. Numerator (top) √∑ Denominator (bottom).
</div>
<p style="color:var(--muted);font-size:0.8rem;">Tip: For percentages, remember that "percent" means "per hundred." So 40% = 40/100 = 0.4.</p>`
  },
  quadratics: {
    title: 'üìê Quadratics',
    body: `<p style="margin-bottom:12px;">A quadratic is any equation with an x¬≤ term. They appear everywhere in physics, engineering, and competition math.</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a5);">
  <strong>Standard form:</strong> ax¬≤ + bx + c = 0
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a3);">
  <strong>Factoring</strong> ‚Äî find two numbers that multiply to c and add to b.<br>Example: x¬≤ + 5x + 6 = (x+2)(x+3) because 2√ó3=6 and 2+3=5.
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a2);">
  <strong>Quadratic Formula</strong> ‚Äî works when factoring fails:<br>x = (‚àíb ¬± ‚àö(b¬≤‚àí4ac)) / 2a
</div>
<p style="color:var(--muted);font-size:0.8rem;">Tip: Always check if the equation equals 0 before solving. And check your answers by plugging back in.</p>`
  },
  systems: {
    title: '‚öñÔ∏è Systems of Equations',
    body: `<p style="margin-bottom:12px;">A system is two or more equations with the same variables. You need to find values that satisfy all of them at once.</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a3);">
  <strong>Substitution</strong> ‚Äî solve one equation for one variable, plug it into the other.<br>Best when one variable is already isolated.
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a4);">
  <strong>Elimination</strong> ‚Äî add or subtract equations to cancel a variable.<br>Best when coefficients line up.
</div>
<p style="color:var(--muted);font-size:0.8rem;">Tip: Always solve for both variables and check your answer in BOTH original equations.</p>`
  },
  numberTheory: {
    title: 'üî¢ Number Theory',
    body: `<p style="margin-bottom:12px;">Number theory is the study of integers and their properties. It's a huge part of competition math.</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a2);">
  <strong>GCD & LCM</strong> ‚Äî Greatest Common Divisor and Least Common Multiple. GCD(12,8)=4. LCM(4,6)=12.
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a5);">
  <strong>Primes</strong> ‚Äî numbers divisible only by 1 and themselves: 2, 3, 5, 7, 11, 13...
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a3);">
  <strong>Modular arithmetic</strong> ‚Äî remainder after division. 17 mod 5 = 2 because 17 = 5√ó3 + 2.
</div>
<p style="color:var(--muted);font-size:0.8rem;">Divisibility tricks: div by 3 if digits sum to multiple of 3. Div by 9 if digits sum to multiple of 9.</p>`
  },
  geometry: {
    title: 'üìè Geometry',
    body: `<p style="margin-bottom:12px;">Geometry is about shapes, sizes, and the relationships between them.</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a3);">
  <strong>Key formulas:</strong><br>
  Circle: Area = œÄr¬≤, Circumference = 2œÄr<br>
  Triangle: Area = ¬Ω √ó base √ó height<br>
  Rectangle: Area = l √ó w, Perimeter = 2(l+w)
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a2);">
  <strong>Pythagorean theorem</strong> ‚Äî for right triangles: a¬≤ + b¬≤ = c¬≤<br>
  Common triples: 3-4-5, 5-12-13, 8-15-17
</div>
<p style="color:var(--muted);font-size:0.8rem;">Tip: Draw diagrams! Label what you know. Geometry problems become way easier when you can see them.</p>`
  },
  probability: {
    title: 'üé≤ Probability',
    body: `<p style="margin-bottom:12px;">Probability measures how likely something is to happen, from 0 (impossible) to 1 (certain).</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a3);">
  <strong>Basic probability:</strong> P(event) = favorable outcomes √∑ total outcomes<br>
  P(rolling a 3 on a die) = 1/6
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a5);">
  <strong>Complementary:</strong> P(not A) = 1 ‚àí P(A)<br>
  P(not rolling a 3) = 1 ‚àí 1/6 = 5/6
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a2);">
  <strong>Counting methods:</strong> Combinations C(n,r) = n!/(r!(n-r)!), Permutations P(n,r) = n!/(n-r)!
</div>
<p style="color:var(--muted);font-size:0.8rem;">Tip: When in doubt, list all outcomes. Tree diagrams and sample spaces prevent mistakes.</p>`
  },
  algebra: {
    title: 'üî£ Algebra',
    body: `<p style="margin-bottom:12px;">Algebra is about using variables (letters) to represent unknown numbers and finding their values.</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a3);">
  <strong>Solving equations:</strong> Whatever you do to one side, do to the other.<br>
  2x + 5 = 13 ‚Üí 2x = 8 ‚Üí x = 4
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a4);">
  <strong>Functions:</strong> f(x) is a rule that turns x into an output.<br>
  f(x) = 2x + 1 ‚Üí f(3) = 7
</div>
<p style="color:var(--muted);font-size:0.8rem;">Tip: Always simplify both sides before solving. And check your answer ‚Äî plug it back in!</p>`
  },
  logic: {
    title: 'üß© Logic & Puzzles',
    body: `<p style="margin-bottom:12px;">Logic problems test your reasoning, not your formulas. They're about thinking clearly and systematically.</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a5);">
  <strong>Pattern recognition</strong> ‚Äî find the rule, apply it. What comes next in 1, 4, 9, 16...? (Perfect squares: 25)
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a3);">
  <strong>Deductive reasoning</strong> ‚Äî use given facts to eliminate wrong answers. Work backwards from the conclusion.
</div>
<p style="color:var(--muted);font-size:0.8rem;">Tip: Read carefully. Logic problems often have one piece of info that unlocks everything else. Find it first.</p>`
  },
  statistics: {
    title: 'üìä Statistics',
    body: `<p style="margin-bottom:12px;">Statistics is about collecting, analyzing, and interpreting data.</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a2);">
  <strong>Mean</strong> ‚Äî the average. Add all values, divide by count.<br>
  Mean of 2,4,6,8 = 20/4 = 5
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a3);">
  <strong>Median</strong> ‚Äî the middle value when sorted. For 2,4,6,8,10 ‚Üí median = 6.
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a5);">
  <strong>Mode</strong> ‚Äî the most frequent value. In 1,2,2,3,4 ‚Üí mode = 2.
</div>
<p style="color:var(--muted);font-size:0.8rem;">Range = max ‚àí min. Outliers affect the mean a lot but barely affect the median.</p>`
  },
  challenge: {
    title: 'üèÜ Challenge Round',
    body: `<p style="margin-bottom:12px;">Challenge Round problems are competition-level. These are the kinds of questions that appear on AMC, MATHCOUNTS, and similar contests.</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a2);">
  <strong>Strategy:</strong> Always look for shortcuts. If brute force takes more than 2 minutes, there's a smarter way.
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a5);">
  <strong>Common patterns:</strong> Inclusion-exclusion, complementary counting, Pigeonhole principle, modular arithmetic cycles.
</div>
<p style="color:var(--muted);font-size:0.8rem;">These are hard. Getting 3 out of 5 right is great. Read every explanation carefully ‚Äî that's where the real learning happens.</p>`
  },
  hardProblems: {
    title: 'üî• Extreme Math',
    body: `<p style="margin-bottom:12px;">These are the hardest problems on the app ‚Äî designed to really push you.</p>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--wrong);">
  <strong>Topics covered:</strong> logarithms, function composition, modular arithmetic, combinatorics, geometric sequences, completing the square.
</div>
<div style="background:var(--card2);border-radius:10px;padding:12px;margin-bottom:10px;border-left:3px solid var(--a5);">
  <strong>Approach:</strong> Read the question twice. Identify what type of problem it is. Recall the relevant formula or technique. Work step by step.
</div>
<p style="color:var(--muted);font-size:0.8rem;">If you can handle these consistently, you're genuinely ready for advanced competitions. Be patient with yourself.</p>`
  }
};

function loadConcept() {
  const sel = _selectedTopics ? [..._selectedTopics] : Object.keys(QB);
  const topic = sel.length===1 ? sel[0] : (S.currentTopic||'quadratics');
  const c = CONCEPTS[topic] || CONCEPTS.quadratics;
  document.getElementById('concepts-content').innerHTML = `
    <h2 style="font-size:1.2rem;font-weight:900;margin-bottom:4px;">${c.title}</h2>
    <p style="font-size:0.75rem;color:var(--muted);margin-bottom:16px;">Quick concept review before you start</p>
    ${c.body}
    <button class="btn-primary" style="width:100%;margin-top:16px;font-size:0.9rem;" onclick="closeModal('concepts-modal')">Got it ‚Äî let's study! ‚Üí</button>
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  QUESTION REPORTING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openReportModal() {
  if (!S.q) return;
  const preview = document.getElementById('report-q-preview');
  preview.textContent = S.q.text.slice(0,120)+(S.q.text.length>120?'...':'');
  document.getElementById('report-details').value = '';
  openModal('report-modal');
}

let _pendingEmail = '';

function submitEmail(source) {
  const inputId = source === 'home' ? 'home-email-input' : 'settings-email-input';
  const input = document.getElementById(inputId);
  const email = input.value.trim();

  if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    input.style.borderColor = 'var(--wrong)';
    setTimeout(() => input.style.borderColor = '', 1500);
    return;
  }

  const btn = input.nextElementSibling;
  btn.textContent = 'Sending...';
  btn.disabled = true;

  fetch('https://formspree.io/f/mbdazzzp', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
    body: JSON.stringify({ email, type: 'newsletter_signup', source, username: S.username || 'unknown' })
  })
  .then(res => {
    if (res.ok) {
      _pendingEmail = email;
      // Hide email step, show name step
      document.getElementById(source + '-step-email').style.display = 'none';
      const nameStep = document.getElementById(source + '-step-name');
      nameStep.style.display = 'block';
      setTimeout(() => document.getElementById(source + '-first-name').focus(), 80);
    } else {
      btn.textContent = 'Failed ‚Äî try again';
      btn.disabled = false;
    }
  })
  .catch(() => {
    btn.textContent = 'Failed ‚Äî try again';
    btn.disabled = false;
  });
}

function submitName(source) {
  const firstName = document.getElementById(source + '-first-name').value.trim();
  const lastName = document.getElementById(source + '-last-name').value.trim();

  if (!firstName) {
    const inp = document.getElementById(source + '-first-name');
    inp.style.borderColor = 'var(--wrong)';
    inp.placeholder = 'Please enter your first name!';
    setTimeout(() => { inp.style.borderColor = ''; inp.placeholder = 'First name'; }, 1800);
    return;
  }

  const fullName = lastName ? `${firstName} ${lastName}` : firstName;

  // Update app display name
  S.username = fullName;
  const nameDisp = document.getElementById('current-name-display');
  if (nameDisp) nameDisp.textContent = 'Currently: ' + S.username;
  refreshDashboard();

  // Send name to Formspree
  fetch('https://formspree.io/f/mbdazzzp', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
    body: JSON.stringify({ email: _pendingEmail, type: 'name_update', first_name: firstName, last_name: lastName || '(not provided)', full_name: fullName, source })
  }).catch(() => {});

  _finishSignup(source, firstName);
}

function skipName(source) {
  _finishSignup(source, S.username || 'there');
}

function _finishSignup(source, firstName) {
  if (!S.emailSignedUp) {
    S.emailSignedUp = true;
    S.xp += 50;
    updateLevel();
    spawnXP(`+50 XP üì¨ Welcome, ${firstName}!`, '#4cc9f0');
  }
  saveState();
  document.getElementById(source + '-step-name').style.display = 'none';
  document.getElementById(source + '-email-success').style.display = 'block';
}


function submitReport() {
  const type = document.getElementById('report-type').value;
  const details = document.getElementById('report-details').value;
  const q = S.q;
  if (!q) return;

  const btn = document.querySelector('#report-modal .btn-primary');
  btn.textContent = 'Sending...';
  btn.disabled = true;

  fetch('https://formspree.io/f/mbdazzzp', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
    body: JSON.stringify({
      issue_type: type,
      topic: S.currentTopic,
      question: q.text,
      correct_answer: q.opts ? q.opts[q.ans] : q.ans,
      details: details || 'None provided',
      source: 'Numiqube Report'
    })
  })
  .then(res => {
    if (res.ok) {
      closeModal('report-modal');
      spawnXP('Report sent! üôè', 'var(--a3)');
    } else {
      btn.textContent = 'Failed ‚Äî try again';
      btn.disabled = false;
    }
  })
  .catch(() => {
    btn.textContent = 'Failed ‚Äî try again';
    btn.disabled = false;
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GO HOME
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function goHome() {
  if (!confirm('Go back to the home screen? Your progress is saved.')) return;
  document.getElementById('page-home').style.display='flex';
  document.getElementById('nav').style.display='none';
  isStudyPageActive = false;
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PRINT WORKSHEET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openPrintModal() {
  // Populate topic select
  const sel = document.getElementById('print-topic-sel');
  sel.innerHTML = Object.entries(TL).map(([k,v])=>
    `<option value="${k}"${k===S.currentTopic?' selected':''}>${TOPIC_ICONS[k]||'üìö'} ${v}</option>`
  ).join('');
  openModal('print-modal');
}

function generateWorksheet() {
  const topic = document.getElementById('print-topic-sel').value;
  const count = parseInt(document.getElementById('print-count-sel').value);
  const diff = document.getElementById('print-diff-sel').value;
  const topicName = TL[topic];
  const icon = TOPIC_ICONS[topic] || 'üìö';

  // Build sections
  const diffs = diff === 'all' ? ['easy','medium','hard'] : [diff];
  let sections = [];
  let qNum = 1;
  let answerKey = [];

  diffs.forEach(d => {
    let pool = QB[topic].filter(q => q.diff === d);
    if (pool.length === 0) return;
    pool = [...pool].sort(() => Math.random() - 0.5).slice(0, Math.ceil(count / diffs.length));
    const label = d === 'easy' ? '‚≠ê Section A ‚Äî Easy' : d === 'medium' ? '‚≠ê‚≠ê Section B ‚Äî Medium' : '‚≠ê‚≠ê‚≠ê Section C ‚Äî Hard';
    sections.push({ label, questions: pool });
    pool.forEach(q => {
      const ans = q.opts ? `${['A','B','C','D'][q.ans]}. ${q.opts[q.ans]}` : q.ans;
      answerKey.push({ num: qNum++, ans, exp: q.exp });
    });
  });

  if (sections.length === 0) { alert('No questions match that difficulty for this topic.'); return; }

  const questionsHTML = sections.map(sec => `
    <div class="section-header">${sec.label}</div>
    ${sec.questions.map((q, i) => `
    <div class="q-block">
      <div class="q-num">Question ${answerKey.findIndex(a => a.num === (sections[0].questions.indexOf(q) !== -1 && sections[0].label === sec.label ? i+1 : -1)) + 1 || i+1}</div>
      <div class="q-text">${q.text.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>
      ${q.opts
        ? `<div class="opts">${q.opts.map((o,oi)=>`<div class="opt">${['A','B','C','D'][oi]}. ${o}</div>`).join('')}</div>`
        : `<div style="margin-top:8px;">Answer: <span class="ans-line" style="width:200px"></span></div>`}
    </div>`).join('')}
  `).join('');

  // Recount properly
  let trueNum = 0;
  const properQHTML = sections.map(sec => `
    <div class="section-header">${sec.label}</div>
    ${sec.questions.map(q => {
      trueNum++;
      return `
      <div class="q-block">
        <div class="q-num">Question ${trueNum}</div>
        <div class="q-text">${q.text.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>
        ${q.opts
          ? `<div class="opts">${q.opts.map((o,oi)=>`<div class="opt">${['A','B','C','D'][oi]}. ${o}</div>`).join('')}</div>`
          : `<div style="margin-top:8px;">Answer: <span class="ans-line" style="width:200px"></span></div>`}
      </div>`;
    }).join('')}
  `).join('');

  const html = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Numiqube ‚Äî ${topicName} Worksheet</title>
<style>
  *{box-sizing:border-box;}
  body{font-family:Arial,sans-serif;max-width:680px;margin:40px auto;padding:0 24px;color:#111;}
  .header-bar{display:flex;justify-content:space-between;align-items:flex-start;border-bottom:3px solid #111;padding-bottom:12px;margin-bottom:20px;}
  .header-left h1{font-size:1.5rem;margin:0 0 2px;}
  .header-left .sub{font-size:0.82rem;color:#555;}
  .name-line{display:flex;gap:24px;margin-top:8px;font-size:0.85rem;}
  .name-field{border-bottom:1px solid #999;min-width:160px;display:inline-block;height:18px;}
  .score-box{border:2px solid #111;padding:8px 18px;text-align:center;font-size:0.88rem;min-width:90px;}
  .score-box strong{display:block;font-size:1.4rem;margin-top:4px;}
  .section-header{background:#f0f0f0;border-left:4px solid #111;padding:6px 12px;font-size:0.82rem;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;margin:20px 0 12px;page-break-after:avoid;}
  .q-block{margin-bottom:20px;padding-bottom:14px;border-bottom:1px solid #e8e8e8;page-break-inside:avoid;}
  .q-num{font-size:0.72rem;font-weight:700;color:#888;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px;}
  .q-text{font-size:0.98rem;font-weight:600;margin-bottom:10px;line-height:1.55;}
  .opts{display:grid;grid-template-columns:1fr 1fr;gap:4px 24px;}
  .opt{font-size:0.88rem;padding:3px 0;}
  .ans-line{border-bottom:1px solid #ccc;display:inline-block;height:18px;margin-left:6px;}
  .answer-key{page-break-before:always;padding-top:20px;}
  .ak-header{border-bottom:3px solid #111;padding-bottom:10px;margin-bottom:16px;}
  .ak-header h2{font-size:1.2rem;margin:0;}
  .ak-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:8px;}
  .ak-item{background:#f8f8f8;border-radius:6px;padding:8px 10px;font-size:0.82rem;}
  .ak-item strong{color:#111;}
  .ak-exp{color:#555;font-size:0.75rem;margin-top:2px;}
  .footer{margin-top:30px;font-size:0.68rem;color:#bbb;text-align:center;border-top:1px solid #eee;padding-top:10px;}
  @media print{body{margin:16px;}.footer{position:fixed;bottom:0;left:0;right:0;}}
</style>
</head>
<body>

<div class="header-bar">
  <div class="header-left">
    <h1>${icon} ${topicName} Worksheet</h1>
    <div class="sub">Numiqube ¬∑ ${diff === 'all' ? 'Mixed difficulties' : diff.charAt(0).toUpperCase()+diff.slice(1)} ¬∑ ${trueNum || answerKey.length} questions</div>
    <div class="name-line">
      <span>Name: <span class="name-field"></span></span>
      <span>Date: <span class="name-field" style="min-width:100px"></span></span>
    </div>
  </div>
  <div class="score-box">Score<strong>___ / ${answerKey.length}</strong></div>
</div>

${properQHTML}

<div class="answer-key">
  <div class="ak-header">
    <h2>üìã Answer Key</h2>
    <p style="font-size:0.78rem;color:#555;margin:4px 0 0;">For teacher/parent use.</p>
  </div>
  <div class="ak-grid">
    ${answerKey.map(a=>`
    <div class="ak-item">
      <strong>Q${a.num}:</strong> ${a.ans.replace(/</g,'&lt;')}
      <div class="ak-exp">${a.exp.replace(/</g,'&lt;').slice(0,80)}</div>
    </div>`).join('')}
  </div>
</div>

<div class="footer">Generated by Numiqube ¬∑ Free math practice for everyone ¬∑ numiqube.com</div>
</body></html>`;

  const win = window.open('','_blank');
  win.document.write(html);
  win.document.close();
  setTimeout(()=>win.print(), 400);
  closeModal('print-modal');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  XP SHOP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SHOP_ITEMS = [
  // Themes
  {id:'theme_ocean',  type:'theme',  icon:'üåä', name:'Ocean Night',   cost:150, desc:'Deep blue theme', vars:{'--bg':'#05070f','--card':'#091428','--a4':'#0ea5e9','--accent':'#0ea5e9'}},
  {id:'theme_forest', type:'theme',  icon:'üåø', name:'Forest Mode',   cost:150, desc:'Calm green theme', vars:{'--accent':'#22c55e','--a3':'#16a34a'}},
  {id:'theme_candy',  type:'theme',  icon:'üç¨', name:'Candy Pop',     cost:200, desc:'Pink & sweet', vars:{'--accent':'#f472b6','--a2':'#fb7185','--a5':'#a855f7'}},
  {id:'theme_gold',   type:'theme',  icon:'‚ú®', name:'Gold Rush',     cost:300, desc:'Premium gold', vars:{'--accent':'#f59e0b','--a2':'#fbbf24','--a3':'#fcd34d'}},
  {id:'theme_void',   type:'theme',  icon:'üåë', name:'Deep Void',     cost:400, desc:'Ultra dark', vars:{'--bg':'#000000','--bg2':'#050505','--card':'#0a0a0a','--card2':'#0f0f0f'}},
  // Titles (shown on leaderboard)
  {id:'title_grinder',  type:'title', icon:'üí™', name:'"The Grinder"',  cost:100, desc:'For leaderboard'},
  {id:'title_wizard',   type:'title', icon:'üßô', name:'"Math Wizard"',  cost:200, desc:'Earned by the best'},
  {id:'title_speedy',   type:'title', icon:'‚ö°', name:'"Speed Demon"',  cost:150, desc:'Fast and correct'},
  {id:'title_curious',  type:'title', icon:'üîç', name:'"The Curious"',  cost:100, desc:'For explorers'},
  {id:'title_legend',   type:'title', icon:'üëë', name:'"Legend"',       cost:500, desc:'For the elite only'},
  // Avatars
  {id:'avatar_fire',  type:'avatar', icon:'üî•', name:'Fire Avatar',    cost:75,  desc:'Ablaze'},
  {id:'avatar_robot', type:'avatar', icon:'ü§ñ', name:'Robot Avatar',   cost:75,  desc:'Beep boop'},
  {id:'avatar_star',  type:'avatar', icon:'‚≠ê', name:'Star Avatar',    cost:100, desc:'Shine bright'},
  {id:'avatar_alien', type:'avatar', icon:'üëæ', name:'Alien Avatar',   cost:125, desc:'From another world'},
  {id:'avatar_crown', type:'avatar', icon:'üëë', name:'Crown Avatar',   cost:250, desc:'Royalty only'},
  {id:'avatar_cube',  type:'avatar', icon:'üßä', name:'Cube Avatar',    cost:200, desc:'Official Numiqube'},
];

function openShop() {
  document.getElementById('shop-xp-display').textContent = S.xp+' XP';
  const grid = document.getElementById('shop-items-grid');
  grid.innerHTML = '';

  // Group by type
  const types = [['avatar','üôÇ Avatars'],['title','üìõ Titles'],['theme','üé® Themes']];
  types.forEach(([type, label]) => {
    const heading = document.createElement('div');
    heading.style.cssText='grid-column:1/-1;font-size:0.72rem;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-top:8px;';
    heading.textContent = label;
    grid.appendChild(heading);

    SHOP_ITEMS.filter(i=>i.type===type).forEach(item => {
      const owned = S.shopOwned && S.shopOwned.includes(item.id);
      const equipped = S.shopEquipped && S.shopEquipped[item.type]===item.id;
      const canAfford = S.xp >= item.cost;

      const card = document.createElement('div');
      card.className = 'shop-item'+(owned?' owned':'')+(equipped?' equipped':'')+((!owned&&!canAfford)?' locked':'');
      card.innerHTML = `
        <span class="shop-icon">${item.icon}</span>
        <span class="shop-name">${item.name}</span>
        <span class="shop-cost">${owned?'Owned':item.cost+' XP'}</span>
        <div class="shop-status" style="color:${equipped?'var(--a5)':owned?'var(--a3)':canAfford?'var(--muted)':'var(--wrong)'}">${equipped?'‚úì Equipped':owned?'Tap to equip':canAfford?'Tap to buy':'Need more XP'}</div>
      `;
      card.onclick = () => shopAction(item);
      grid.appendChild(card);
    });
  });

  openModal('shop-modal');
}

function shopAction(item) {
  if (!S.shopOwned) S.shopOwned = [];
  if (!S.shopEquipped) S.shopEquipped = {};

  const owned = S.shopOwned.includes(item.id);

  if (!owned) {
    if (S.xp < item.cost) { spawnXP('Not enough XP!','var(--wrong)'); return; }
    S.xp -= item.cost;
    if (!S.shopSpent) S.shopSpent=0;
    S.shopSpent += item.cost;
    S.shopOwned.push(item.id);
    document.getElementById('shop-xp-display').textContent = S.xp+' XP';
    document.getElementById('nav-xp').textContent = S.xp+' XP';
    spawnXP(`üéâ ${item.icon} Unlocked!`,'#c77dff');
  }

  // Equip it
  if (S.shopEquipped[item.type]===item.id) {
    // Unequip
    delete S.shopEquipped[item.type];
    if (item.type==='theme') unequipTheme();
  } else {
    S.shopEquipped[item.type] = item.id;
    if (item.type==='theme') applyTheme(item);
    if (item.type==='avatar') document.getElementById('nav-streak').textContent = item.icon+(S.dayStreak||0);
  }

  saveState();
  openShop(); // refresh
}

function applyTheme(item) {
  const root = document.documentElement;
  if (item.vars) Object.entries(item.vars).forEach(([k,v])=>root.style.setProperty(k,v));
}

function unequipTheme() {
  // Reset to defaults
  const defaults = {'--bg':'#0f0e17','--bg2':'#13121f','--card':'#1a1830','--card2':'#201e38',
    '--accent':'#ff6b35','--a2':'#ffd166','--a3':'#06d6a0','--a4':'#118ab2','--a5':'#c77dff','--a6':'#f72585'};
  Object.entries(defaults).forEach(([k,v])=>document.documentElement.style.setProperty(k,v));
}

function restoreEquipped() {
  if (!S.shopEquipped) return;
  Object.entries(S.shopEquipped).forEach(([type, id]) => {
    const item = SHOP_ITEMS.find(i=>i.id===id);
    if (!item) return;
    if (type==='theme') applyTheme(item);
    if (type==='avatar') document.getElementById('nav-streak').textContent = item.icon+(S.dayStreak||0);
  });
}



// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SPACED REPETITION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleSR() {
  S.srMode = !S.srMode;
  document.getElementById('sr-btn').textContent = `üß† Spaced Rep: ${S.srMode?'ON':'Off'}`;
  document.getElementById('sr-btn').classList.toggle('active-tool', S.srMode);
  const pb = document.getElementById('panel-sr-btn');
  if(pb){ pb.textContent=`üß† Spaced Rep: ${S.srMode?'ON':'Off'}`; pb.classList.toggle('active-tool',S.srMode); }
  if (S.srMode) buildSRQueue();
}

function buildSRQueue() {
  // Put wrong questions back in queue
  S.srQueue = [...S.wrongLog].slice(-20);
}

function getNextQ() {
  if (S.srMode && S.srQueue.length > 0 && Math.random() < 0.4) {
    const item = S.srQueue.splice(0,1)[0];
    if (item) return item;
  }
  // Multi-topic support
  const activeTops = _selectedTopics ? [..._selectedTopics] : Object.keys(QB);
  // Pick a random topic from selection
  const topic = activeTops[Math.floor(Math.random()*activeTops.length)];
  S.currentTopic = topic;
  const pool = QB[topic], used = usedQ[topic];
  if (!used) usedQ[topic] = [];
  const avail = pool.map((_,i)=>i).filter(i=>!usedQ[topic].includes(i));
  if (avail.length===0) { usedQ[topic]=[]; return pool[Math.floor(Math.random()*pool.length)]; }
  const idx = avail[Math.floor(Math.random()*avail.length)];
  usedQ[topic].push(idx);
  return pool[idx];
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MATH RENDERING ‚Äî converts ^, _, fractions
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderMath(str) {
  if (!str) return str;
  // Fractions: a/b surrounded by spaces or at start/end ‚Üí make fraction
  // Handle explicit fraction notation like ¬Ω, ¬º etc already in text
  str = String(str);

  // Superscripts: x^2 ‚Üí x<sup>2</sup>, handles multi-char like x^(n+1)
  str = str.replace(/\^(\([^)]+\))/g, (_, exp) => `<sup>${exp.replace(/[()]/g,'')}</sup>`);
  str = str.replace(/\^(-?\d+)/g, (_, exp) => `<sup>${exp}</sup>`);
  str = str.replace(/\^([a-zA-Z])/g, (_, exp) => `<sup>${exp}</sup>`);

  // Subscripts: x_1 ‚Üí x<sub>1</sub>
  str = str.replace(/_(\d+)/g, (_, sub) => `<sub>${sub}</sub>`);
  str = str.replace(/_([a-zA-Z])/g, (_, sub) => `<sub>${sub}</sub>`);

  // Simple inline fractions like (a/b) ‚Üí proper fraction display when surrounded by spaces
  // Pattern: number/number not inside a word context
  str = str.replace(/(\b\d+)\/(\d+\b)/g, (_, n, d) => 
    `<span class="inline-frac"><sup>${n}</sup>‚ÅÑ<sub>${d}</sub></span>`);

  // Square root: ‚àö(expr) or ‚àön
  str = str.replace(/‚àö\(([^)]+)\)/g, (_, inner) => `<span class="sqrt-wrap">‚àö<span class="sqrt-inner">${inner}</span></span>`);

  // ¬± ‚Üí proper symbol (already in some questions but make sure)
  str = str.replace(/\+\/-/g, '¬±');

  // ‚Üí already fine
  // √ó already fine
  // √∑ already fine

  return str;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ANSWER SHUFFLING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Store the shuffled correct index globally for current question
let _shuffledCorrectIdx = 0;
let _shuffledOpts = [];

function shuffleAnswers(opts, correctIdx) {
  // Create indexed array, shuffle, track where correct ended up
  const indexed = opts.map((o, i) => ({text: o, isCorrect: i === correctIdx}));
  // Fisher-Yates shuffle
  for (let i = indexed.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [indexed[i], indexed[j]] = [indexed[j], indexed[i]];
  }
  _shuffledOpts = indexed.map(o => o.text);
  _shuffledCorrectIdx = indexed.findIndex(o => o.isCorrect);
  return _shuffledOpts;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  QUESTION LOADING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadQ() {
  if (S.paused) return;
  if (S.speedInterval) { clearInterval(S.speedInterval); S.speedInterval = null; }
  S.answered = false; S.hintUsed = false;
  S.q = getNextQ(); S.qIdx++; S.qStart = Date.now();
  document.getElementById('hint-text').style.display='none';
  document.getElementById('hint-btn').textContent='üí° Hint';
  document.getElementById('feedback-box').style.display='none';
  document.getElementById('next-btn').style.display='none';
  document.getElementById('review-section').style.display='none';

  const q = S.q;
  const dt = document.getElementById('diff-tag');
  dt.textContent = q.diff==='competition'?'üèÜ Challenge':q.diff[0].toUpperCase()+q.diff.slice(1);
  dt.className = 'd-'+(q.diff==='competition'?'competition':q.diff);
  document.getElementById('topic-badge').textContent = TL[S.currentTopic];
  document.getElementById('q-counter').textContent = `Q ${S.qIdx}`;
  document.getElementById('question-text').innerHTML = renderMath(q.text.replace(/\n/g,'<br>'));
  document.getElementById('hint-text').innerHTML = renderMath(q.hint);

  // Progress bar
  const sg = S.settings.sessionGoal;
  const pct = Math.min(S.sessionCorrect/sg*100,100);
  document.getElementById('session-prog-fill').style.width = pct+'%';
  document.getElementById('session-prog-text').textContent = `Session Goal: ${S.sessionCorrect} / ${sg}`;
  document.getElementById('session-goal-badge').textContent = pct>=100?'üèÜ Done! Seriously nice session.':pct>=50?'üí™ More than halfway there.':'Keep going, you got this.';

  // Daily progress
  const dpct = Math.min(S.sessionCorrect/10*100,100);
  document.getElementById('daily-compact-bar').style.width = dpct+'%';
  document.getElementById('daily-compact-count').textContent = (S.sessionCorrect>=10?'‚úÖ':S.sessionCorrect+'/10');
  document.getElementById('daily-compact-label').textContent = S.sessionCorrect>=10 ? '‚úÖ Daily done!' : '‚ö° Daily';

  const og = document.getElementById('options-grid');
  const fw = document.getElementById('free-wrap');
  const nw = document.getElementById('numpad-wrap');
  const sw = document.getElementById('sort-wrap');
  og.innerHTML='';
  og.style.display='none';
  fw.style.display='none';
  nw.style.display='none';
  sw.style.display='none';

  if (q.type==='free') {
    fw.style.display='block';
    document.getElementById('free-input').value='';
    document.getElementById('free-input').disabled=false;
    document.getElementById('submit-free').disabled=false;
    setTimeout(()=>document.getElementById('free-input').focus(),80);
  } else if (q.type==='numpad') {
    nw.style.display='block';
    document.getElementById('numpad-display').textContent='_';
    _numpadVal = '';
  } else if (q.type==='sort') {
    sw.style.display='block';
    buildSortList(q.sortItems.slice());
  } else {
    // Regular multiple choice with shuffled answers
    const shuffled = shuffleAnswers(q.opts, q.ans);
    og.style.display='grid';
    ['A','B','C','D'].forEach((lbl,i)=>{
      const b=document.createElement('button'); b.className='opt-btn';
      b.innerHTML=`<span class="opt-lbl">${lbl}</span><span>${renderMath(shuffled[i])}</span>`;
      b.onclick=()=>checkAns(i); og.appendChild(b);
    });
  }

  // Speed mode
  const speedWrap = document.getElementById('speed-ring-wrap');
  if (S.mode==='speed') {
    speedWrap.style.display='block';
    startSpeedTimer();
  } else {
    speedWrap.style.display='none';
  }

  const card=document.getElementById('question-card');
  card.style.animation='none'; card.offsetHeight; card.style.animation='slideIn 0.3s ease';
}

function startSpeedTimer() {
  const limit = S.settings.speedTimer;
  let remaining = limit;
  const arc = document.getElementById('speed-arc');
  const num = document.getElementById('speed-num');
  const circum = 125.6;
  arc.style.stroke = 'var(--a2)';

  S.speedInterval = setInterval(() => {
    if (S.paused || S.answered) { clearInterval(S.speedInterval); return; }
    remaining--;
    num.textContent = remaining;
    const offset = circum * (1 - remaining/limit);
    arc.style.strokeDashoffset = offset;
    if (remaining <= 3) arc.style.stroke = 'var(--wrong)';
    if (remaining <= 0) {
      clearInterval(S.speedInterval);
      if (!S.answered) autoWrong();
    }
  },1000);
}

function autoWrong() {
  S.answered=true;
  document.querySelectorAll('.opt-btn').forEach((b,i)=>{
    b.disabled=true;
    if(i===_shuffledCorrectIdx)b.classList.add('correct');
  });
  showFeedback(false, S.q.exp, S.settings.speedTimer);
  updateScore(false);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ANSWER CHECKING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function checkAns(sel) {
  if (S.answered || S.paused) return;
  S.answered = true;
  if (S.speedInterval) { clearInterval(S.speedInterval); S.speedInterval = null; }
  const elapsed = (Date.now()-S.qStart)/1000;
  S.lastTime = elapsed;
  // Use _shuffledCorrectIdx ‚Äî the correct answer's position after shuffling
  S.lastCorrect = sel === _shuffledCorrectIdx;
  document.querySelectorAll('.opt-btn').forEach((b,i)=>{
    b.disabled=true;
    if(i===_shuffledCorrectIdx)b.classList.add('correct');
    else if(i===sel&&!S.lastCorrect)b.classList.add('wrong');
  });
  showFeedback(S.lastCorrect, S.q.exp, elapsed);
  updateScore(S.lastCorrect);
}

function submitFree() {
  if (S.answered || S.paused) return;
  S.answered=true;
  const elapsed=(Date.now()-S.qStart)/1000;
  S.lastTime=elapsed;
  const inp=document.getElementById('free-input').value.trim().toLowerCase();
  const acc=S.q.accepted.map(a=>a.toLowerCase());
  S.lastCorrect=acc.some(a=>inp===a||inp.replace(/\s/g,'')===a.replace(/\s/g,''));
  document.getElementById('free-input').disabled=true;
  document.getElementById('submit-free').disabled=true;
  showFeedback(S.lastCorrect,S.q.exp,elapsed);
  updateScore(S.lastCorrect);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NUMPAD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _numpadVal = '';

function numpadPress(digit) {
  if (S.answered) return;
  if (_numpadVal.length >= 6) return;
  _numpadVal += digit;
  document.getElementById('numpad-display').textContent = _numpadVal;
}

function numpadClear() {
  if (S.answered) return;
  _numpadVal = _numpadVal.slice(0,-1);
  document.getElementById('numpad-display').textContent = _numpadVal || '_';
}

function submitNumpad() {
  if (S.answered || S.paused || !_numpadVal) return;
  S.answered = true;
  const elapsed = (Date.now()-S.qStart)/1000;
  S.lastTime = elapsed;
  const acc = S.q.accepted.map(a => a.toString().toLowerCase().replace(/\$/g,''));
  const inp = _numpadVal.toLowerCase().replace(/\$/g,'');
  S.lastCorrect = acc.includes(inp);
  // Disable all numpad buttons
  document.querySelectorAll('.numpad-btn').forEach(b=>b.disabled=true);
  // Flash display
  const disp = document.getElementById('numpad-display');
  disp.style.borderColor = S.lastCorrect ? 'var(--correct)' : 'var(--wrong)';
  disp.style.color = S.lastCorrect ? 'var(--correct)' : 'var(--wrong)';
  showFeedback(S.lastCorrect, S.q.exp, elapsed);
  updateScore(S.lastCorrect);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SORT / DRAG-TO-ORDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let _dragSrcIdx = null;

function buildSortList(items) {
  // Shuffle the items so they don't start in order
  for (let i = items.length-1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [items[i],items[j]] = [items[j],items[i]];
  }
  const list = document.getElementById('sort-list');
  list.innerHTML = '';
  items.forEach((item, idx) => {
    const el = document.createElement('div');
    el.className = 'sort-item';
    el.draggable = true;
    el.dataset.idx = idx;
    el.innerHTML = `<span class="sort-handle">‚†ø</span><span>${renderMath(item)}</span>`;
    // Drag events
    el.addEventListener('dragstart', e => {
      _dragSrcIdx = idx;
      setTimeout(() => el.style.opacity = '0.4', 0);
    });
    el.addEventListener('dragend', () => {
      el.style.opacity = '1';
      document.querySelectorAll('.sort-item').forEach(i=>i.classList.remove('drag-over'));
    });
    el.addEventListener('dragover', e => { e.preventDefault(); el.classList.add('drag-over'); });
    el.addEventListener('dragleave', () => el.classList.remove('drag-over'));
    el.addEventListener('drop', e => {
      e.preventDefault();
      el.classList.remove('drag-over');
      const children = [...list.children];
      const srcEl = children[_dragSrcIdx];
      const tgtEl = children[idx];
      if (srcEl && tgtEl && srcEl !== tgtEl) {
        const srcNext = srcEl.nextSibling;
        const tgtNext = tgtEl.nextSibling;
        list.insertBefore(srcEl, tgtNext);
        list.insertBefore(tgtEl, srcNext);
      }
    });
    // Touch/tap: tap to select then tap destination to swap
    el.addEventListener('click', () => {
      if (S.answered) return;
      const selected = list.querySelector('.sort-item.selected');
      if (!selected || selected === el) {
        document.querySelectorAll('.sort-item').forEach(i=>i.classList.remove('selected'));
        el.classList.toggle('selected');
        if (el.classList.contains('selected')) el.style.borderColor = 'var(--accent)';
        else el.style.borderColor = '';
      } else {
        // Swap
        const children = [...list.children];
        const ai = children.indexOf(selected), bi = children.indexOf(el);
        const aNext = selected.nextSibling, bNext = el.nextSibling;
        list.insertBefore(selected, bNext);
        list.insertBefore(el, aNext);
        selected.classList.remove('selected');
        selected.style.borderColor = '';
      }
    });
    list.appendChild(el);
  });
}

function submitSort() {
  if (S.answered || S.paused) return;
  S.answered = true;
  const elapsed = (Date.now()-S.qStart)/1000;
  S.lastTime = elapsed;
  const list = document.getElementById('sort-list');
  const currentOrder = [...list.children].map(el => el.querySelector('span:last-child').textContent.trim());
  const correctOrder = S.q.sortAnswer;
  S.lastCorrect = currentOrder.join(',') === correctOrder.join(',');
  // Color the items
  [...list.children].forEach((el, i) => {
    el.style.borderColor = S.lastCorrect ? 'var(--correct)' : (el.querySelector('span:last-child').textContent.trim()===correctOrder[i]?'var(--correct)':'var(--wrong)');
    el.draggable = false;
  });
  document.querySelector('#sort-wrap .numpad-submit').disabled = true;
  showFeedback(S.lastCorrect, S.q.exp, elapsed);
  updateScore(S.lastCorrect);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HUMAN-SOUNDING FEEDBACK MESSAGES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CORRECT_MSGS = [
  "Nailed it! üéâ",
  "Yep, that's right!",
  "Let's go!! ‚úÖ",
  "You got it.",
  "That's correct ‚Äî nice work.",
  "Easy for you, huh? üòè",
  "Boom. ‚úÖ",
  "On a roll! Keep going.",
  "That's the one. üôå",
  "Clean. Really clean.",
  "Didn't even hesitate. üî•",
  "One step closer to calculus. üò§",
];
const WRONG_MSGS = [
  "Not quite ‚Äî but now you know.",
  "Ah, close! Check the steps below.",
  "Nope, but don't stress it. Look at why.",
  "That one trips people up a lot. Read the breakdown.",
  "Wrong answer, right attitude for looking at it.",
  "Mistakes are literally how you get better. No cap.",
  "Ooh, not that one. Here's what happened:",
  "That's a common mix-up. Here's the fix:",
  "Even good students miss this. Read the steps.",
  "It happens. Look at the explanation and move on.",
];

function randMsg(arr) { return arr[Math.floor(Math.random()*arr.length)]; }

function showFeedback(correct, exp, elapsed) {
  const box=document.getElementById('feedback-box');
  box.style.display='block';
  box.className=correct?'fb-correct':'fb-wrong';
  const ts=elapsed<120?` <span style="color:var(--muted);font-size:0.75rem;">(${elapsed.toFixed(1)}s)</span>`:'';
  const headline = correct ? randMsg(CORRECT_MSGS) : randMsg(WRONG_MSGS);

  // Test mode: hide explanation until they're done, just show correct/wrong
  if (_isTestMode) {
    box.innerHTML = `<strong>${headline}</strong>${ts}
      <div style="margin-top:5px;font-size:0.75rem;color:var(--muted);">${correct?'Keep going!':'The explanation will be available when you exit test mode.'}</div>`;
    _testResults.push(correct);
    const t = _testResults.length;
    const c = _testResults.filter(r=>r).length;
    document.getElementById('test-score-live').textContent = `${c}/${t} correct`;
  } else {
    const stepsHTML = S.q.steps ? S.q.steps.map((s,i)=>`<div class="fb-step"><strong>Step ${i+1}</strong>${renderMath(s)}</div>`).join(''):'';
    box.innerHTML = `<strong>${headline}</strong>${ts}
      <div style="margin-top:6px;font-size:0.83rem;color:var(--muted);">${renderMath(exp)}</div>
      ${stepsHTML}`;
  }
  document.getElementById('next-btn').style.display='block';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SCORE UPDATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateScore(correct) {
  S.total++; S.tCount[S.currentTopic]=(S.tCount[S.currentTopic]||0)+1;
  S.tAttempt[S.currentTopic]=true;
  // Track time per topic
  if (!S.tTimes[S.currentTopic]) S.tTimes[S.currentTopic]=[];
  S.tTimes[S.currentTopic].push(S.lastTime);

  if (correct) {
    S.correct++; S.sessionCorrect++; S.streak++;
    S.tCorrect[S.currentTopic]=(S.tCorrect[S.currentTopic]||0)+1;
    if(S.streak>S.bestStreak)S.bestStreak=S.streak;
    if(!S.hintUsed)S.noHintStreak++;else S.noHintStreak=0;
    if(S.lastTime<10)S.speedStreak++;else S.speedStreak=0;
    // comeback tracking
    if(S.comingBack<0)S.comingBack++;
    else if(S.comingBack<0&&correct)S.comingBack++;

    const base={competition:30,hard:20,medium:15,easy:10}[S.q.diff]||10;
    const streakBonus=S.streak>=10?Math.floor(base):S.streak>=5?Math.floor(base*0.75):S.streak>=3?Math.floor(base*0.5):0;
    const speedBonus=S.lastTime<6?8:S.lastTime<10?4:0;
    const noHintBonus=!S.hintUsed?3:0;
    const gained=base+streakBonus+speedBonus+noHintBonus;
    S.xp+=gained; S.sessionXP+=gained;

    // Daily challenge bonus
    if(S.sessionCorrect===10){S.xp+=100;S.sessionXP+=100;spawnXP('+100 XP üåü Daily Challenge!','#ffd166');}

    spawnXP(`+${gained} XP${streakBonus>0?' üî•':''}${speedBonus>0?' ‚ö°':''}${noHintBonus>0?' üß†':''}`)
    updateLevel();

    // Update goals
    updateGoalProgress();
  } else {
    S.streak=0; S.wrong++; S.noHintStreak=0; S.speedStreak=0;
    if(S.comingBack>=0)S.comingBack=-3;else S.comingBack++;
    // Log wrong question for review
    S.wrongLog = [...S.wrongLog.slice(-49), {q:S.q, topic:S.currentTopic, date:new Date().toISOString()}];
  }

  // Activity log
  const key = new Date().toISOString().slice(0,10);
  S.activityLog[key] = (S.activityLog[key]||0)+1;

  // Update session history periodically
  if (S.total % 5 === 0) {
    S.history.unshift({date:new Date().toLocaleString(),topic:TL[S.currentTopic],correct:S.correct,total:S.total,xp:S.xp});
    S.history = S.history.slice(0,50);
  }

  // UI updates
  document.getElementById('score-display').textContent=`${S.correct}/${S.total}`;
  document.getElementById('nav-streak').textContent=`üî•${S.dayStreak}`;
  document.getElementById('nav-xp').textContent=`${S.xp} XP`;
  document.getElementById('st-correct').textContent=S.correct;
  document.getElementById('st-wrong').textContent=S.wrong;
  document.getElementById('st-streak').textContent=S.bestStreak;
  document.getElementById('st-acc').textContent=S.total>0?Math.round(S.correct/S.total*100)+'%':'--%';
  const avgTimes=S.tTimes[S.currentTopic]||[];
  const avg=avgTimes.length>0?avgTimes.reduce((a,b)=>a+b,0)/avgTimes.length:0;
  document.getElementById('st-time').textContent=avg>0?avg.toFixed(1)+'s':'--s';
  document.getElementById('st-xp').textContent=S.sessionXP;

  // Question streak banner
  const banner = document.getElementById('q-streak-banner');
  const qsNum = document.getElementById('q-streak-num');
  const qsSub = document.getElementById('q-streak-sub');
  const navQS = document.getElementById('nav-qstreak');
  if (S.streak >= 2) {
    banner.classList.add('show');
    qsNum.textContent = S.streak;
    const milestones = {3:'Nice!',5:'Hot streak! üî•',10:'Unstoppable!! ü§Ø',20:'LEGENDARY üèÜ'};
    const milestone = Object.keys(milestones).reverse().find(k => S.streak >= k);
    qsSub.textContent = milestone ? milestones[milestone] : 'in a row!';
    navQS.textContent = `‚ö°${S.streak}`;
    navQS.style.display = 'inline';
  } else {
    banner.classList.remove('show');
    navQS.style.display = 'none';
  }

  // Sound
  if(S.settings.sound)playSound(correct);

  checkAchievements();
  updateWrongReview();
  saveState();
}

function updateLevel() {
  const nl=Math.floor(S.xp/100)+1;
  if(nl>S.level){S.level=nl;spawnXP(`üéâ LEVEL ${S.level}!`,'#c77dff');}
  document.getElementById('nav-lvl').textContent=`LVL ${S.level}`;
  document.getElementById('xp-bar-fill')&&(document.getElementById('xp-bar-fill').style.width=Math.min((S.xp%100),100)+'%');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SOUND (Web Audio API)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let audioCtx = null;
function playSound(correct) {
  try {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    if (correct) { osc.frequency.setValueAtTime(523,audioCtx.currentTime); osc.frequency.setValueAtTime(659,audioCtx.currentTime+0.1); }
    else { osc.frequency.setValueAtTime(220,audioCtx.currentTime); }
    gain.gain.setValueAtTime(0.15,audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.3);
    osc.start(audioCtx.currentTime); osc.stop(audioCtx.currentTime+0.3);
  } catch(e){}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  XP POPUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function spawnXP(txt, color='#06d6a0') {
  const el=document.createElement('div'); el.className='xp-pop';
  el.textContent=txt; el.style.color=color;
  el.style.left=(Math.random()*50+25)+'%'; el.style.top='80px';
  document.body.appendChild(el); setTimeout(()=>el.remove(),1400);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ACHIEVEMENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function checkAchievements() {
  for (const a of ACHIEVEMENTS) {
    if (!S.earned.has(a.id) && a.check(S)) {
      S.earned.add(a.id);
      document.getElementById('toast-name2').textContent=a.icon+' '+a.name;
      document.getElementById('toast-desc2').textContent=a.desc;
      const t=document.getElementById('ach-toast');
      t.classList.add('show');
      spawnXP('+50 XP üèÖ Achievement!','#c77dff'); S.xp+=50; S.sessionXP+=50;
      if(S.settings.confetti)launchConfetti();
      setTimeout(()=>t.classList.remove('show'),3500);
      saveState();
    }
  }
}

function launchConfetti() {
  for (let i=0; i<30; i++) {
    const el=document.createElement('div');
    const colors=['#ff6b35','#ffd166','#06d6a0','#118ab2','#c77dff','#f72585'];
    el.style.cssText=`position:fixed;width:8px;height:8px;border-radius:2px;background:${colors[Math.floor(Math.random()*colors.length)]};left:${Math.random()*100}%;top:60px;z-index:999;pointer-events:none;animation:confettiFall ${0.8+Math.random()*1.2}s ease forwards;`;
    document.body.appendChild(el);
    setTimeout(()=>el.remove(),2500);
  }
}
// Add confetti keyframes dynamically
const confettiStyle=document.createElement('style');
confettiStyle.textContent='@keyframes confettiFall{0%{transform:translateY(0) rotate(0);opacity:1}100%{transform:translateY(80vh) rotate(720deg);opacity:0}}';
document.head.appendChild(confettiStyle);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HINT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showHint() {
  S.hintUsed=true;
  const ht=document.getElementById('hint-text'), btn=document.getElementById('hint-btn');
  if(ht.style.display==='none'||ht.style.display===''){ht.style.display='block';btn.textContent='üôà Hide Hint';}
  else{ht.style.display='none';btn.textContent='üí° Hint';}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function nextQ() { loadQ(); }
function skipQ() { if(!S.answered){S.total++;S.wrong++;updateScore(false);}else loadQ(); }

function toggleMode() {
  S.mode=S.mode==='normal'?'speed':'normal';
  document.getElementById('mode-btn').textContent=S.mode==='speed'?'‚ö° Speed Mode':'üéØ Normal Mode';
  document.getElementById('mode-btn').classList.toggle('active-tool',S.mode==='speed');
  const pb=document.getElementById('panel-mode-btn');
  if(pb){ pb.textContent=S.mode==='speed'?'‚ö° Speed Mode':'üéØ Normal Mode'; pb.classList.toggle('active-tool',S.mode==='speed'); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  WRONG REVIEW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateWrongReview() {
  if (S.wrongLog.length===0) return;
  const sec=document.getElementById('review-section'), list=document.getElementById('wrong-list');
  sec.style.display='block'; list.innerHTML='';
  const recent=S.wrongLog.slice(-5);
  recent.reverse().forEach(item=>{
    const d=document.createElement('div'); d.className='wrong-item';
    d.innerHTML=`<div class="wrong-q">${item.q.text.replace(/\n/g,' ').slice(0,80)}...</div>
      <div class="wrong-a">‚úÖ Correct answer: <span class="wrong-correct">${item.q.type==='free'?item.q.ans:item.q.opts[item.q.ans]}</span></div>
      <div style="font-size:0.72rem;color:var(--muted);margin-top:4px;">${item.q.hint}</div>`;
    list.appendChild(d);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(id) { document.getElementById(id).style.display='block'; }
function closeModal(id) { document.getElementById(id).style.display='none'; }
function openMorePanel() {
  document.getElementById('more-panel').classList.add('open');
  document.getElementById('more-panel-overlay').classList.add('open');
}
function closeMorePanel() {
  document.getElementById('more-panel').classList.remove('open');
  document.getElementById('more-panel-overlay').classList.remove('open');
}
function openProModal() { document.getElementById('pro-modal').classList.add('show'); }
function closeProModal() { document.getElementById('pro-modal').classList.remove('show'); }
function showComingSoon() {
  closeProModal();
  alert('üí≥ Payments are coming soon! Pro features are in development. Thank you for your interest!');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function refreshDashboard() {
  document.getElementById('dash-name').textContent = S.username||'Student';
  document.getElementById('dash-level-badge').textContent = `LVL ${S.level}`;
  const acc = S.total>0?Math.round(S.correct/S.total*100):0;
  document.getElementById('dash-subtitle').textContent = `Level ${S.level} ¬∑ ${acc}% accuracy ¬∑ ${S.dayStreak} day streak`;
  document.getElementById('daily-tip').textContent = TIPS[new Date().getDate()%TIPS.length];

  const grid=document.getElementById('dash-stats-grid');
  const stats=[
    {icon:'‚≠ê',num:S.xp,label:'Total XP',color:'#ffd166'},
    {icon:'‚úÖ',num:S.correct,label:'Correct',color:'#06d6a0'},
    {icon:'üéØ',num:acc+'%',label:'Accuracy',color:'#c77dff'},
    {icon:'üî•',num:S.dayStreak,label:'Day Streak',color:'#ff6b35'},
    {icon:'‚ö°',num:S.bestStreak,label:'Best Streak',color:'#118ab2'},
    {icon:'üìö',num:S.total,label:'Total Solved',color:'#f72585'},
  ];
  grid.innerHTML=stats.map(s=>`<div class="dash-card"><span class="dc-icon">${s.icon}</span><div class="dc-num" style="color:${s.color}">${s.num}</div><div class="dc-label">${s.label}</div></div>`).join('');

  // Activity grid (last 28 days)
  const agrid=document.getElementById('activity-grid');
  agrid.innerHTML='';
  for(let i=27;i>=0;i--){
    const d=new Date(Date.now()-i*86400000).toISOString().slice(0,10);
    const count=S.activityLog[d]||0;
    const cls=count===0?'act-0':count<5?'act-1':count<10?'act-2':count<20?'act-3':'act-4';
    const cell=document.createElement('div'); cell.className=`act-cell ${cls}`;
    cell.title=`${d}: ${count} questions`;
    // Show count directly on the cell ‚Äî visible without hover
    if(count>0) cell.textContent = count>99?'99+':count;
    agrid.appendChild(cell);
  }

  // Week row
  const week=document.getElementById('week-row');
  const days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  const today=new Date().getDay();
  week.innerHTML='';
  for(let i=6;i>=0;i--){
    const d=new Date(Date.now()-i*86400000);
    const key=d.toISOString().slice(0,10);
    const isToday=i===0;
    const hasDone=(S.activityLog[key]||0)>0;
    const dot=document.createElement('div');
    dot.className='day-dot '+(isToday?'day-today':hasDone?'day-done':'day-missed');
    dot.textContent=days[d.getDay()];
    week.appendChild(dot);
  }
  const streakMessages = [
    `üî• ${S.dayStreak} days in a row. Don't stop now.`,
    `üî• ${S.dayStreak}-day streak. You're actually doing it.`,
    `üî• ${S.dayStreak} days straight. Respect.`,
  ];
  document.getElementById('streak-msg').textContent = S.dayStreak>0
    ? streakMessages[S.dayStreak % streakMessages.length]
    : "Open the app today to start your streak. It's worth it.";

  // Goals preview
  const dg=document.getElementById('dash-goals');
  dg.innerHTML='';
  const active=S.goals.filter(g=>!g.done).slice(0,3);
  if(active.length===0){dg.innerHTML='<p style="color:var(--muted);font-size:0.8rem;">No active goals. <button onclick="showPage(\'goals\')" style="background:none;border:none;color:var(--accent);cursor:pointer;font-family:Nunito,sans-serif;font-weight:700;">Set one now ‚Üí</button></p>';}
  active.forEach(g=>{
    const pct=Math.min(getGoalProgress(g)/g.target*100,100).toFixed(0);
    const div=document.createElement('div'); div.className='goal-card';
    div.innerHTML=`<div class="goal-header"><div class="goal-title">${g.title}</div><div class="goal-pct">${pct}%</div></div>
      <div class="goal-bar-wrap"><div class="goal-bar-fill" style="width:${pct}%;background:${TC[g.type]||'var(--accent)'}"></div></div>
      <div class="goal-sub">${getGoalProgress(g)} / ${g.target} ${g.type}</div>`;
    dg.appendChild(div);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PROGRESS PAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function progressTab(el,id) {
  ['prog-accuracy','prog-history','prog-review','prog-ach'].forEach(i=>document.getElementById(i).style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('.tab-pill').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  if(id==='prog-accuracy')buildAccuracyBars();
  if(id==='prog-history')buildHistory();
  if(id==='prog-review')buildWrongReview();
  if(id==='prog-ach')buildAchGrid();
}

function refreshProgress() { buildAccuracyBars(); }

function buildAccuracyBars() {
  const bars=document.getElementById('topic-acc-bars');
  bars.innerHTML='';
  for(const[k,v]of Object.entries(TL)){
    const att=S.tCount[k]||0,cor=S.tCorrect[k]||0;
    const pct=att>0?Math.round(cor/att*100):0;
    const row=document.createElement('div'); row.className='topic-bar-row';
    row.innerHTML=`<div class="tb-label">${v}</div>
      <div class="tb-bar-wrap"><div class="tb-bar-fill" style="width:${pct}%;background:${TC[k]}"></div></div>
      <div class="tb-pct">${att>0?pct+'%':'--'}</div>`;
    bars.appendChild(row);
  }

  const speed=document.getElementById('speed-analysis');
  speed.innerHTML='';
  for(const[k,v]of Object.entries(TL)){
    const times=S.tTimes[k]||[];
    const avg=times.length>0?(times.reduce((a,b)=>a+b,0)/times.length).toFixed(1):'--';
    const div=document.createElement('div'); div.style.cssText='display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--border);font-size:0.8rem;';
    div.innerHTML=`<span>${v}</span><span style="font-family:Space Mono,monospace;color:var(--a2);">${avg==='--'?'Not attempted':avg+'s avg'}</span>`;
    speed.appendChild(div);
  }
}

function buildHistory() {
  const list=document.getElementById('history-list'); list.innerHTML='';
  if(S.history.length===0){list.innerHTML='<p style="color:var(--muted);font-size:0.8rem;">No session history yet. Keep studying!</p>';return;}
  S.history.slice(0,20).forEach(h=>{
    const item=document.createElement('div'); item.className='hist-item';
    const acc=h.total>0?Math.round(h.correct/h.total*100):0;
    item.innerHTML=`<div><div style="font-weight:700;font-size:0.82rem;">${h.topic}</div><div style="color:var(--muted);font-size:0.7rem;">${h.date}</div></div>
      <div class="hist-correct">${h.correct}/${h.total} (${acc}%)</div>
      <div style="color:var(--a5);font-size:0.72rem;font-family:Space Mono,monospace;">+${h.xp||0} XP</div>`;
    list.appendChild(item);
  });
}

function buildWrongReview() {
  const list=document.getElementById('prog-wrong-list'); list.innerHTML='';
  if(S.wrongLog.length===0){list.innerHTML='<p style="color:var(--muted);">No wrong answers logged yet! üéâ</p>';return;}
  [...S.wrongLog].reverse().slice(0,20).forEach(item=>{
    const d=document.createElement('div'); d.className='wrong-item';
    d.innerHTML=`<div class="wrong-q">${item.q.text.replace(/\n/g,' ')}</div>
      <div class="wrong-a">‚úÖ Answer: <span class="wrong-correct">${item.q.type==='free'?item.q.ans:item.q.opts[item.q.ans]}</span></div>
      <div style="font-size:0.72rem;color:var(--muted);margin-top:4px;">üí° ${item.q.hint}</div>
      <div style="font-size:0.72rem;margin-top:4px;color:var(--a3);">${(item.q.steps||[]).slice(0,2).join(' ‚Üí ')}</div>`;
    d.onclick=()=>d.querySelector('.wrong-a').style.display='block';
    list.appendChild(d);
  });
}

function buildAchGrid() {
  const grid=document.getElementById('ach-grid'); grid.innerHTML='';
  document.getElementById('ach-count').textContent=[...S.earned].length;
  document.getElementById('ach-total').textContent=ACHIEVEMENTS.length;
  ACHIEVEMENTS.forEach(a=>{
    const earned=S.earned.has(a.id);
    const c=document.createElement('div'); c.className='ach-card'+(earned?' earned':'');
    c.innerHTML=`<div class="ach-icon" style="${earned?'':'filter:grayscale(1) opacity(0.3)'}">${a.icon}</div><div class="ach-name">${a.name}</div><div class="ach-desc">${a.desc}</div>`;
    grid.appendChild(c);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  GOALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getGoalProgress(g) {
  switch(g.type){
    case 'questions': return S.total;
    case 'correct': return S.correct;
    case 'xp': return S.xp;
    case 'streak': return S.dayStreak;
    case 'topic': {
      let best=0;
      for(const k of Object.keys(S.tCount)){
        const att=S.tCount[k]||0,cor=S.tCorrect[k]||0;
        if(att>=5)best=Math.max(best,Math.round(cor/att*100));
      }
      return best;
    }
    default: return 0;
  }
}

function updateGoalProgress() {
  let changed=false;
  S.goals.forEach(g=>{
    if(g.done)return;
    const prog=getGoalProgress(g);
    if(prog>=g.target){
      g.done=true; S.goalsCompleted++;
      spawnXP('+200 XP üéØ Goal Complete!','#ffd166');
      S.xp+=200; changed=true;
      checkAchievements();
    }
  });
  if(changed)saveState();
}

function addGoal() {
  const title=document.getElementById('goal-title-in').value.trim();
  const type=document.getElementById('goal-type-in').value;
  const target=parseInt(document.getElementById('goal-target-in').value);
  if(!title||!target||target<1)return alert('Please fill in all fields!');
  S.goals.push({id:Date.now(),title,type,target,done:false,created:new Date().toISOString()});
  document.getElementById('goal-title-in').value='';
  document.getElementById('goal-target-in').value='';
  saveState(); refreshGoals();
}

function refreshGoals() {
  const active=document.getElementById('goals-list'), done=document.getElementById('goals-done');
  active.innerHTML=''; done.innerHTML='';
  const activeg=S.goals.filter(g=>!g.done), doneg=S.goals.filter(g=>g.done);
  if(activeg.length===0)active.innerHTML='<p style="color:var(--muted);font-size:0.8rem;">No active goals. Add one above!</p>';
  activeg.forEach(g=>{
    const pct=Math.min(Math.round(getGoalProgress(g)/g.target*100),100);
    const div=document.createElement('div'); div.className='goal-item';
    div.innerHTML=`<button class="goal-del" onclick="deleteGoal(${g.id})">‚úï</button>
      <div class="goal-item-header"><div class="goal-item-title">${g.title}</div><span class="goal-badge gb-active">Active</span></div>
      <div class="goal-bar-wrap"><div class="goal-bar-fill" style="width:${pct}%;background:var(--accent)"></div></div>
      <div class="goal-sub">${getGoalProgress(g)} / ${g.target} ¬∑ ${g.type} ¬∑ ${pct}% complete</div>`;
    active.appendChild(div);
  });
  if(doneg.length===0)done.innerHTML='<p style="color:var(--muted);font-size:0.8rem;">Complete a goal to see it here!</p>';
  doneg.forEach(g=>{
    const div=document.createElement('div'); div.className='goal-item';
    div.innerHTML=`<div class="goal-item-header"><div class="goal-item-title">‚úÖ ${g.title}</div><span class="goal-badge gb-done">Done!</span></div>
      <div class="goal-sub">${g.type} ¬∑ Completed</div>`;
    done.appendChild(div);
  });
}

function deleteGoal(id) {
  S.goals=S.goals.filter(g=>g.id!==id);
  saveState(); refreshGoals();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  LEADERBOARD (simulated)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildLeaderboard() {
  const fakeUsers=[
    {name:'Aria K.',     xp:2840, icon:'ü¶Å'},
    {name:'Marcus T.',   xp:2310, icon:'ü¶ä'},
    {name:'Priya S.',    xp:1980, icon:'üêØ'},
    {name:'Ethan R.',    xp:1640, icon:'üê¨'},
    {name:'Sofia M.',    xp:1420, icon:'ü¶Ñ'},
    {name:'James L.',    xp:1100, icon:'üêâ'},
    {name:'Nadia B.',    xp:890,  icon:'ü¶ã'},
    {name:'Tyler H.',    xp:650,  icon:'ü¶Ö'},
  ];
  const all=[...fakeUsers,{name:S.username||'You',xp:S.xp,icon:'‚≠ê',isMe:true}];
  all.sort((a,b)=>b.xp-a.xp);
  const list=document.getElementById('lb-list'); list.innerHTML='';
  all.forEach((u,i)=>{
    const row=document.createElement('div');
    row.className='lb-row'+(u.isMe?' lb-me':'');
    const rankCls=i===0?'gold':i===1?'silver':i===2?'bronze':'';
    const rankIcon=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':i+1;
    row.innerHTML=`<div class="lb-rank ${rankCls}">${rankIcon}</div>
      <div class="lb-avatar" style="background:${['#ff6b35','#ffd166','#06d6a0','#118ab2','#c77dff','#f72585'][i%6]}22;">${u.icon}</div>
      <div class="lb-name">${u.name}${u.isMe?' (You)':''}</div>
      <div class="lb-xp">${u.xp} XP</div>`;
    list.appendChild(row);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function refreshSettings() {
  const s=S.settings;
  document.getElementById('light-toggle').className='toggle'+(s.lightMode?' on':'');
  document.getElementById('sound-toggle').className='toggle'+(s.sound?' on':'');
  document.getElementById('confetti-toggle').className='toggle'+(s.confetti?' on':'');
  document.getElementById('goal-select').value=s.sessionGoal;
  document.getElementById('speed-timer-select').value=s.speedTimer;
  document.getElementById('current-name-display').textContent='Currently: '+S.username;
}

function toggleLight() {
  S.settings.lightMode=!S.settings.lightMode;
  document.body.classList.toggle('light-mode',S.settings.lightMode);
  document.getElementById('theme-btn').textContent=S.settings.lightMode?'üåô':'‚òÄÔ∏è';
  document.getElementById('light-toggle').className='toggle'+(S.settings.lightMode?' on':'');
  saveState();
}

function toggleSetting(key) {
  S.settings[key]=!S.settings[key];
  document.getElementById(key+'-toggle').className='toggle'+(S.settings[key]?' on':'');
  saveState();
}

function updateSessionGoal() {
  S.settings.sessionGoal=parseInt(document.getElementById('goal-select').value);
  saveState();
}

function saveSettings() {
  S.settings.speedTimer=parseInt(document.getElementById('speed-timer-select').value);
  saveState();
}

function changeName() {
  const n=prompt('Enter your new display name:', S.username);
  if(n&&n.trim())S.username=n.trim().slice(0,20);
  document.getElementById('current-name-display').textContent='Currently: '+S.username;
  refreshDashboard(); saveState();
}

function exportData() {
  const data=JSON.stringify({username:S.username,xp:S.xp,correct:S.correct,total:S.total,level:S.level,achievements:[...S.earned],exportDate:new Date().toISOString()},null,2);
  const a=document.createElement('a');
  a.href='data:application/json,'+encodeURIComponent(data);
  a.download='numiqube_progress.json'; a.click();
}

function resetData() {
  if(confirm('Really delete ALL progress? This cannot be undone!')){
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  KEYBOARD SHORTCUTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('keydown',e=>{
  if(document.getElementById('page-study').style.display==='none'&&!document.getElementById('page-study').classList.contains('active'))return;
  if(document.activeElement===document.getElementById('free-input'))return;
  if(e.target.tagName==='INPUT'||e.target.tagName==='SELECT'||e.target.tagName==='TEXTAREA')return;
  const map={'1':0,'2':1,'3':2,'4':3,'a':0,'b':1,'c':2,'d':3};
  if(map[e.key.toLowerCase()]!==undefined&&!S.answered){
    const btns=document.querySelectorAll('.opt-btn');
    if(btns[map[e.key.toLowerCase()]])btns[map[e.key.toLowerCase()]].click();
  }
  if((e.key==='Enter'||e.key===' ')&&S.answered){e.preventDefault();const nb=document.getElementById('next-btn');if(nb.style.display!=='none')nb.click();}
  if(e.key.toLowerCase()==='h')showHint();
  if(e.key.toLowerCase()==='r')shuffleTopic();
  if(e.key==='Escape'){document.querySelectorAll('.modal-overlay').forEach(m=>m.style.display='none');}
});

// Close modals on outside click
document.querySelectorAll('.modal-overlay').forEach(m=>{
  m.addEventListener('click',e=>{if(e.target===m)m.style.display='none';});
});
document.getElementById('pro-modal').addEventListener('click',e=>{
  if(e.target===document.getElementById('pro-modal'))closeProModal();
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
init();
// Apply saved settings immediately
if(S.settings&&S.settings.lightMode){document.body.classList.add('light-mode');document.getElementById('theme-btn').textContent='üåô';}
// Fallback: if Firebase auth doesn't respond in 3s, show home anyway
setTimeout(() => {
  if(document.getElementById('loader') && !document.getElementById('loader').classList.contains('hidden')) {
    document.getElementById('loader').classList.add('hidden');
    document.getElementById('page-home').style.display = 'flex';
  }
}, 3000);
</script>
</body>
</html>
